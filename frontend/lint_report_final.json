[{"filePath":"D:\\Software\\Create\\Shop\\frontend\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\App.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\components\\CategoryManagementModal.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":120,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":120,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport api from '../utils/api';\r\nimport {\r\n    X,\r\n    Plus,\r\n    ChevronRight,\r\n    ChevronDown,\r\n    Edit2,\r\n    Trash2,\r\n    FolderTree,\r\n    ChevronUp,\r\n    FolderPlus\r\n} from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst CategoryManagementModal = ({ onClose }) => {\r\n    const [categories, setCategories] = useState([]);\r\n    const [expandedCategories, setExpandedCategories] = useState(new Set());\r\n    const [loading, setLoading] = useState(true);\r\n    const [newCategory, setNewCategory] = useState({ name: '', description: '' });\r\n    const [editingCategory, setEditingCategory] = useState(null);\r\n    const [isCreatingNew, setIsCreatingNew] = useState(false);\r\n    const [selectedParent, setSelectedParent] = useState(null);\r\n    const [editParentId, setEditParentId] = useState(null);\r\n    const [deleteConfirm, setDeleteConfirm] = useState({\r\n        isOpen: false,\r\n        categoryId: null,\r\n        categoryName: '',\r\n        hasSubCategories: false,\r\n        subCount: 0,\r\n        isSubCategory: false\r\n    });\r\n    const [subInputs, setSubInputs] = useState({});\r\n\r\n    const loadCategories = useCallback(async () => {\r\n        try {\r\n            setLoading(true);\r\n            const { data } = await api.get('/categories?parent=null');\r\n\r\n            const categoriesWithSubs = await Promise.all(\r\n                data.map(async (cat) => {\r\n                    const { data: details } = await api.get(`/categories/${cat._id}`);\r\n                    return details;\r\n                })\r\n            );\r\n\r\n            setCategories(categoriesWithSubs);\r\n\r\n            // Sync selectedParent if it exists\r\n            if (selectedParent) {\r\n                const updatedParent = categoriesWithSubs.find(c => c._id === selectedParent._id);\r\n                if (updatedParent) {\r\n                    setSelectedParent(updatedParent);\r\n                }\r\n            }\r\n\r\n            setLoading(false);\r\n        } catch (error) {\r\n            console.error('Failed to load categories:', error);\r\n            toast.error('Failed to load categories');\r\n            setLoading(false);\r\n        }\r\n    }, [selectedParent]);\r\n\r\n    useEffect(() => {\r\n        loadCategories();\r\n    }, [loadCategories]);\r\n\r\n    const handleSaveCategory = async (e) => {\r\n        if (e) e.preventDefault();\r\n\r\n        if (!newCategory.name.trim()) {\r\n            toast.error('Category name is required');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            if (editingCategory) {\r\n                await api.put(`/categories/${editingCategory._id}`, {\r\n                    name: newCategory.name,\r\n                    description: newCategory.description,\r\n                    parentCategory: editParentId\r\n                });\r\n                toast.success('Category updated successfully');\r\n            } else {\r\n                await api.post('/categories', {\r\n                    name: newCategory.name,\r\n                    description: newCategory.description,\r\n                    parentCategory: selectedParent?._id,\r\n                });\r\n                toast.success(\r\n                    selectedParent\r\n                        ? 'Sub-category created successfully'\r\n                        : 'Category created successfully'\r\n                );\r\n            }\r\n\r\n            setNewCategory({ name: '', description: '' });\r\n            setEditingCategory(null);\r\n            setIsCreatingNew(false);\r\n            // We keep selectedParent if we just added a sub-category under it\r\n            loadCategories();\r\n        } catch (error) {\r\n            toast.error(error.response?.data?.message || 'Failed to save category');\r\n        }\r\n    };\r\n\r\n    const handleAddSubCategory = async (parentId) => {\r\n        const name = subInputs[parentId]?.trim();\r\n        if (!name) return;\r\n\r\n        try {\r\n            await api.post('/categories', {\r\n                name,\r\n                parentCategory: parentId\r\n            });\r\n            toast.success('Sub-category added');\r\n            setSubInputs({ ...subInputs, [parentId]: '' });\r\n            loadCategories();\r\n        } catch (error) {\r\n            toast.error('Failed to add sub-category');\r\n        }\r\n    };\r\n\r\n    const handleEditClick = (category, parentId) => {\r\n        setEditingCategory(category);\r\n        setEditParentId(parentId);\r\n        setIsCreatingNew(false);\r\n        setNewCategory({\r\n            name: category.name,\r\n            description: category.description || ''\r\n        });\r\n    };\r\n\r\n    const handleCancelEdit = () => {\r\n        setEditingCategory(null);\r\n        setIsCreatingNew(false);\r\n        setNewCategory({ name: '', description: '' });\r\n        setEditParentId(null);\r\n    };\r\n\r\n    const initiateDelete = (cat, isSubCategory = false) => {\r\n        setDeleteConfirm({\r\n            isOpen: true,\r\n            categoryId: cat._id,\r\n            categoryName: cat.name,\r\n            hasSubCategories: cat.subCategories?.length > 0,\r\n            subCount: cat.subCategories?.length || 0,\r\n            isSubCategory\r\n        });\r\n    };\r\n\r\n    const confirmDelete = async () => {\r\n        const { categoryId } = deleteConfirm;\r\n        if (!categoryId) return;\r\n\r\n        try {\r\n            const { data } = await api.delete(`/categories/${categoryId}`);\r\n\r\n            if (data.subCategoriesDeleted > 0) {\r\n                toast.success(`Category and ${data.subCategoriesDeleted} sub-categor${data.subCategoriesDeleted === 1 ? 'y' : 'ies'} deleted successfully`);\r\n            } else {\r\n                toast.success(deleteConfirm.isSubCategory ? 'Sub-category deleted successfully' : 'Category deleted successfully');\r\n            }\r\n\r\n            if (selectedParent?._id === categoryId) {\r\n                setSelectedParent(null);\r\n            }\r\n            loadCategories();\r\n        } catch (error) {\r\n            toast.error(error.response?.data?.message || 'Failed to delete category');\r\n        } finally {\r\n            setDeleteConfirm({ isOpen: false, categoryId: null, categoryName: '', hasSubCategories: false, subCount: 0, isSubCategory: false });\r\n        }\r\n    };\r\n\r\n    const handleCategoryClick = (cat) => {\r\n        const newExpanded = new Set(expandedCategories);\r\n        if (newExpanded.has(cat._id)) {\r\n            newExpanded.delete(cat._id);\r\n        } else {\r\n            newExpanded.add(cat._id);\r\n        }\r\n        setExpandedCategories(newExpanded);\r\n\r\n        // Select it for management\r\n        setSelectedParent(cat);\r\n        setIsCreatingNew(false);\r\n        setEditingCategory(null);\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 backdrop-blur-sm\">\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col animate-in fade-in zoom-in duration-200\">\r\n\r\n                {/* Header */}\r\n                <div className=\"px-6 py-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-800/50 rounded-t-xl\">\r\n                    <div>\r\n                        <h2 className=\"text-xl font-bold text-gray-800 dark:text-white flex items-center gap-2\">\r\n                            <FolderTree className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\r\n                            Manage Categories\r\n                        </h2>\r\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">Organize your product inventory structure</p>\r\n                    </div>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-colors text-gray-500 dark:text-gray-400\"\r\n                    >\r\n                        <X className=\"w-5 h-5\" />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"flex-1 overflow-hidden flex flex-col md:flex-row\">\r\n\r\n                    {/* Sidebar / List */}\r\n                    <div className=\"w-full md:w-1/3 border-r border-gray-100 dark:border-gray-700 overflow-y-auto p-4 bg-gray-50/30 dark:bg-gray-800/30\">\r\n                        <div className=\"mb-4\">\r\n                            <button\r\n                                onClick={() => {\r\n                                    setEditingCategory(null);\r\n                                    setIsCreatingNew(true);\r\n                                    setNewCategory({ name: '', description: '' });\r\n                                    setSelectedParent(null);\r\n                                }}\r\n                                className=\"w-full py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center justify-center gap-2 shadow-sm shadow-blue-200 dark:shadow-none transition-all\"\r\n                            >\r\n                                <Plus className=\"w-4 h-4\" /> New Main Category\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-3\">\r\n                            {loading && categories.length === 0 ? (\r\n                                <div className=\"text-center py-8 text-gray-400 dark:text-gray-500\">Loading...</div>\r\n                            ) : categories.length === 0 ? (\r\n                                <div className=\"text-center py-8 text-gray-400 dark:text-gray-500 text-sm\">No categories yet</div>\r\n                            ) : (\r\n                                categories.map(cat => (\r\n                                    <div key={cat._id} className=\"group\">\r\n                                        <div\r\n                                            onClick={() => handleCategoryClick(cat)}\r\n                                            className={`flex items-center justify-between p-3 rounded-lg cursor-pointer transition-all border ${selectedParent?._id === cat._id\r\n                                                ? 'bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800'\r\n                                                : 'bg-white dark:bg-gray-700 border-gray-200 dark:border-gray-600 hover:border-blue-300 dark:hover:border-blue-500'\r\n                                                }`}\r\n                                        >\r\n                                            <span className={`font-medium ${selectedParent?._id === cat._id ? 'text-blue-700 dark:text-blue-300' : 'text-gray-700 dark:text-gray-200'}`}>\r\n                                                {cat.name}\r\n                                            </span>\r\n                                            <div className=\"flex items-center gap-1\">\r\n                                                <span className=\"text-xs bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-300 px-1.5 py-0.5 rounded-md\">\r\n                                                    {cat.subCategories?.length || 0}\r\n                                                </span>\r\n                                                {expandedCategories.has(cat._id) ? <ChevronUp className=\"w-4 h-4 text-blue-500\" /> : <ChevronDown className=\"w-4 h-4 text-gray-400\" />}\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {/* Action Buttons for Main Category (visible on hover or if expanded) */}\r\n                                        <div className={`px-2 py-1 flex justify-end gap-2 text-xs transition-opacity ${expandedCategories.has(cat._id) ? 'opacity-100' : 'opacity-0 group-hover:opacity-100 h-0 hidden group-hover:block group-hover:h-auto'}`}>\r\n                                            <button onClick={(e) => { e.stopPropagation(); handleEditClick(cat, null); }} className=\"text-blue-600 dark:text-blue-400 hover:underline\">Edit</button>\r\n                                            <button onClick={(e) => { e.stopPropagation(); initiateDelete(cat); }} className=\"text-red-600 dark:text-red-400 hover:underline\">Delete</button>\r\n                                        </div>\r\n                                    </div>\r\n                                ))\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Main View */}\r\n                    <div className=\"flex-1 p-6 overflow-y-auto bg-white dark:bg-gray-800\">\r\n                        {(editingCategory || isCreatingNew) ? (\r\n                            <div className=\"max-w-md mx-auto mt-10\">\r\n                                <div className=\"bg-blue-50 dark:bg-blue-900/10 p-6 rounded-xl border border-blue-100 dark:border-blue-800/30 text-center\">\r\n                                    <div className=\"w-12 h-12 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                                        {editingCategory ? <Edit2 className=\"w-6 h-6\" /> : <FolderPlus className=\"w-6 h-6\" />}\r\n                                    </div>\r\n                                    <h3 className=\"text-lg font-bold text-gray-900 dark:text-white mb-2\">\r\n                                        {editingCategory ? 'Edit Category' : 'Create New Category'}\r\n                                    </h3>\r\n                                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-6\">\r\n                                        {editingCategory ? 'Update the category name below.' : 'Add a new main category to organize your products.'}\r\n                                    </p>\r\n\r\n                                    <form onSubmit={handleSaveCategory} className=\"space-y-4 text-left\">\r\n                                        <div>\r\n                                            <label className=\"block text-xs font-bold text-gray-700 dark:text-gray-300 mb-1 uppercase tracking-wider\">Category Name</label>\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                value={newCategory.name}\r\n                                                onChange={(e) => setNewCategory({ ...newCategory, name: e.target.value })}\r\n                                                placeholder=\"e.g., Electronics\"\r\n                                                className=\"w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                                autoFocus\r\n                                            />\r\n                                        </div>\r\n                                        <div className=\"flex gap-3\">\r\n                                            <button\r\n                                                type=\"button\"\r\n                                                onClick={handleCancelEdit}\r\n                                                className=\"flex-1 py-2.5 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg font-medium transition-colors\"\r\n                                            >\r\n                                                Cancel\r\n                                            </button>\r\n                                            <button\r\n                                                type=\"submit\"\r\n                                                disabled={!newCategory.name.trim()}\r\n                                                className=\"flex-1 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n                                            >\r\n                                                {editingCategory ? 'Update' : 'Create'}\r\n                                            </button>\r\n                                        </div>\r\n                                    </form>\r\n                                </div>\r\n                            </div>\r\n                        ) : selectedParent ? (\r\n                            <div className=\"animate-in fade-in slide-in-from-bottom-4 duration-300\">\r\n                                <div className=\"flex justify-between items-start mb-6\">\r\n                                    <div>\r\n                                        <h3 className=\"text-2xl font-bold text-gray-900 dark:text-white\">{selectedParent.name}</h3>\r\n                                        <p className=\"text-sm text-gray-500 dark:text-gray-400\">Manage sub-categories</p>\r\n                                    </div>\r\n                                    <div className=\"flex gap-2\">\r\n                                        <button\r\n                                            onClick={() => handleEditClick(selectedParent, null)}\r\n                                            className=\"p-2 text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors\"\r\n                                            title=\"Edit Name\"\r\n                                        >\r\n                                            <Edit2 className=\"w-4 h-4\" />\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => initiateDelete(selectedParent)}\r\n                                            className=\"p-2 text-gray-500 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors\"\r\n                                            title=\"Delete Category\"\r\n                                        >\r\n                                            <Trash2 className=\"w-4 h-4\" />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Add Sub Category Input */}\r\n                                <div className=\"mb-6 flex gap-2\">\r\n                                    <div className=\"relative flex-1\">\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={subInputs[selectedParent._id] || ''}\r\n                                            onChange={(e) => setSubInputs({ ...subInputs, [selectedParent._id]: e.target.value })}\r\n                                            placeholder=\"Add new sub-category...\"\r\n                                            className=\"w-full pl-4 pr-10 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                            onKeyDown={(e) => e.key === 'Enter' && handleAddSubCategory(selectedParent._id)}\r\n                                        />\r\n                                        <button\r\n                                            onClick={() => handleAddSubCategory(selectedParent._id)}\r\n                                            disabled={!subInputs[selectedParent._id]?.trim()}\r\n                                            className=\"absolute right-1.5 top-1.5 p-1.5 bg-gray-100 dark:bg-gray-600 text-gray-600 dark:text-gray-300 hover:bg-blue-500 hover:text-white dark:hover:bg-blue-500 dark:hover:text-white rounded-md transition-colors disabled:opacity-50 disabled:hover:bg-gray-100 disabled:hover:text-gray-600\"\r\n                                        >\r\n                                            <Plus className=\"w-4 h-4\" />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Sub Categories List */}\r\n                                <div className=\"space-y-4\">\r\n                                    <h4 className=\"text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider\">\r\n                                        Sub Categories ({selectedParent.subCategories?.length || 0})\r\n                                    </h4>\r\n\r\n                                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\r\n                                        {!selectedParent.subCategories || selectedParent.subCategories.length === 0 ? (\r\n                                            <div className=\"col-span-full py-8 text-center border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-xl bg-gray-50/50 dark:bg-gray-800/50\">\r\n                                                <p className=\"text-gray-400 dark:text-gray-500 text-sm\">No sub-categories added yet.</p>\r\n                                            </div>\r\n                                        ) : (\r\n                                            selectedParent.subCategories.map((subCat, idx) => (\r\n                                                <div key={idx} className=\"group flex items-center justify-between p-3 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg shadow-sm hover:shadow-md hover:border-blue-200 dark:hover:border-blue-500 transition-all\">\r\n                                                    <span className=\"text-gray-700 dark:text-gray-200 font-medium\">{subCat.name}</span>\r\n                                                    <button\r\n                                                        onClick={() => initiateDelete(subCat, true)}\r\n                                                        className=\"text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all p-1 hover:bg-red-50 dark:hover:bg-red-900/20 rounded\"\r\n                                                    >\r\n                                                        <X className=\"w-4 h-4\" />\r\n                                                    </button>\r\n                                                </div>\r\n                                            ))\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"h-full flex flex-col items-center justify-center text-center text-gray-400 dark:text-gray-500\">\r\n                                <div className=\"w-20 h-20 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mb-4\">\r\n                                    <FolderTree className=\"w-10 h-10 text-gray-300 dark:text-gray-500\" />\r\n                                </div>\r\n                                <h3 className=\"text-lg font-semibold text-gray-600 dark:text-gray-300\">Select a Category</h3>\r\n                                <p className=\"text-sm max-w-xs mx-auto mt-2\">\r\n                                    Select a category from the sidebar to manage its sub-categories or create a new one.\r\n                                </p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Delete Confirmation Modal */}\r\n                {deleteConfirm.isOpen && (\r\n                    <div className=\"absolute inset-0 bg-black bg-opacity-20 flex items-center justify-center z-[60] p-4 backdrop-blur-sm\">\r\n                        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 max-w-sm w-full animate-in fade-in zoom-in duration-200 border border-gray-200 dark:border-gray-700\">\r\n                            <div className=\"w-12 h-12 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                                <Trash2 className=\"w-6 h-6\" />\r\n                            </div>\r\n                            <h3 className=\"text-lg font-bold text-center text-gray-900 dark:text-white mb-2\">Delete {deleteConfirm.isSubCategory ? 'Sub-Category' : 'Category'}?</h3>\r\n                            <p className=\"text-center text-sm text-gray-500 dark:text-gray-400 mb-6\">\r\n                                Are you sure you want to delete <span className=\"font-bold text-gray-800 dark:text-gray-200\">\"{deleteConfirm.categoryName}\"</span>?\r\n                                {deleteConfirm.hasSubCategories && (\r\n                                    <span className=\"block mt-2 text-red-500 dark:text-red-400 text-xs bg-red-50 dark:bg-red-900/20 py-1 px-2 rounded\">\r\n                                        Warning: This will delete {deleteConfirm.subCount} sub-categor{deleteConfirm.subCount === 1 ? 'y' : 'ies'}.\r\n                                    </span>\r\n                                )}\r\n                            </p>\r\n                            <div className=\"flex gap-3\">\r\n                                <button\r\n                                    onClick={() => setDeleteConfirm({ isOpen: false, categoryId: null, categoryName: '', hasSubCategories: false, subCount: 0, isSubCategory: false })}\r\n                                    className=\"flex-1 py-2.5 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg font-medium transition-colors\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                                <button\r\n                                    onClick={confirmDelete}\r\n                                    className=\"flex-1 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium shadow-sm shadow-red-200 dark:shadow-none transition-colors\"\r\n                                >\r\n                                    Delete\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default CategoryManagementModal;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\components\\ConfirmationModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\components\\ErrorBoundary.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":9,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":42,"suggestions":[{"messageId":"removeVar","data":{"varName":"error"},"fix":{"range":[244,249],"text":""},"desc":"Remove unused variable 'error'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\n\r\nclass ErrorBoundary extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = { hasError: false, error: null, errorInfo: null };\r\n    }\r\n\r\n    static getDerivedStateFromError(error) {\r\n        return { hasError: true };\r\n    }\r\n\r\n    componentDidCatch(error, errorInfo) {\r\n        this.setState({ error, errorInfo });\r\n        console.error(\"Uncaught error:\", error, errorInfo);\r\n    }\r\n\r\n    render() {\r\n        if (this.state.hasError) {\r\n            return (\r\n                <div className=\"p-8 bg-red-50 text-red-900 border border-red-200 rounded-lg m-4\">\r\n                    <h2 className=\"text-2xl font-bold mb-4\">Something went wrong.</h2>\r\n                    <details className=\"whitespace-pre-wrap\">\r\n                        <summary className=\"cursor-pointer font-semibold mb-2\">View Error Details</summary>\r\n                        {this.state.error && this.state.error.toString()}\r\n                        <br />\r\n                        {this.state.errorInfo && this.state.errorInfo.componentStack}\r\n                    </details>\r\n                    <button\r\n                        onClick={() => window.location.reload()}\r\n                        className=\"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700\"\r\n                    >\r\n                        Reload Page\r\n                    </button>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return this.props.children;\r\n    }\r\n}\r\n\r\nexport default ErrorBoundary;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\components\\Layout\\Layout.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\components\\Layout\\Sidebar.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\components\\RecordPaymentModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\context\\AuthContext.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":2,"column":54,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":63,"suggestions":[{"messageId":"removeVar","data":{"varName":"useEffect"},"fix":{"range":[110,121],"text":""},"desc":"Remove unused variable 'useEffect'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'setLoading' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":21,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"setLoading"},"fix":{"range":[722,734],"text":""},"desc":"Remove unused variable 'setLoading'."}]}],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":7,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":7,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable react-refresh/only-export-components */\r\nimport React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport api from '../utils/api';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const useAuth = () => {\r\n    const context = useContext(AuthContext);\r\n    if (!context) {\r\n        throw new Error('useAuth must be used within AuthProvider');\r\n    }\r\n    return context;\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n    const [user, setUser] = useState(() => {\r\n        const storedUser = localStorage.getItem('user');\r\n        const token = localStorage.getItem('token');\r\n        return (storedUser && token) ? JSON.parse(storedUser) : null;\r\n    });\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const login = async (username, password) => {\r\n        try {\r\n            const { data } = await api.post('/auth/login', { username, password });\r\n\r\n            localStorage.setItem('token', data.token);\r\n            localStorage.setItem('user', JSON.stringify(data));\r\n            setUser(data);\r\n\r\n            return { success: true, user: data };\r\n        } catch (error) {\r\n            return {\r\n                success: false,\r\n                error: error.response?.data?.message || error.message || 'Login failed. Check if backend is running.'\r\n            };\r\n        }\r\n    };\r\n\r\n    const googleLogin = async (token) => {\r\n        try {\r\n            const { data } = await api.post('/auth/google', { token });\r\n\r\n            localStorage.setItem('token', data.token);\r\n            localStorage.setItem('user', JSON.stringify(data));\r\n            setUser(data);\r\n\r\n            return { success: true, user: data };\r\n        } catch (error) {\r\n            return {\r\n                success: false,\r\n                error: error.response?.data?.message || error.message || 'Google Login failed.'\r\n            };\r\n        }\r\n    };\r\n\r\n    const register = async (name, username, email, password, shopCode) => {\r\n        try {\r\n            const { data } = await api.post('/auth/register', {\r\n                name,\r\n                username,\r\n                email,\r\n                password,\r\n                shopCode\r\n            });\r\n\r\n            localStorage.setItem('token', data.token);\r\n            localStorage.setItem('user', JSON.stringify(data));\r\n            setUser(data);\r\n\r\n            return { success: true, user: data };\r\n        } catch (error) {\r\n            return {\r\n                success: false,\r\n                error: error.response?.data?.message || error.message || 'Registration failed. Check if backend is running.'\r\n            };\r\n        }\r\n    };\r\n\r\n    const logout = () => {\r\n        localStorage.removeItem('token');\r\n        localStorage.removeItem('user');\r\n        setUser(null);\r\n    };\r\n\r\n    const isAdmin = () => {\r\n        return user?.role === 'Admin';\r\n    };\r\n\r\n    const isStaff = () => {\r\n        return user?.role === 'Staff';\r\n    };\r\n\r\n    const value = {\r\n        user,\r\n        loading,\r\n        login,\r\n        googleLogin,\r\n        register,\r\n        logout,\r\n        isAdmin,\r\n        isStaff,\r\n        isAuthenticated: !!user,\r\n    };\r\n\r\n    return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\context\\ClientViewContext.jsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":6,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":6,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\context\\SettingsContext.jsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  34 |\n  35 |     useEffect(() => {\n> 36 |         refreshSettings();\n     |         ^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  37 |     }, [refreshSettings]);\n  38 |\n  39 |     const updateSettings = async (newSettings) => {","line":36,"column":9,"nodeType":null,"endLine":36,"endColumn":24}],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":7,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":7,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable react-refresh/only-export-components */\r\nimport React, { createContext, useContext, useState, useEffect, useCallback } from 'react';\r\nimport api from '../utils/api';\r\n\r\nconst SettingsContext = createContext();\r\n\r\nexport const useSettings = () => {\r\n    const context = useContext(SettingsContext);\r\n    if (!context) {\r\n        throw new Error('useSettings must be used within SettingsProvider');\r\n    }\r\n    return context;\r\n};\r\n\r\nexport const SettingsProvider = ({ children }) => {\r\n    const [settings, setSettings] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const refreshSettings = useCallback(async () => {\r\n        try {\r\n            const { data } = await api.get('/settings');\r\n            setSettings(data);\r\n\r\n\r\n            if (data.brandColor) setThemeVars('--brand-color', data.brandColor);\r\n            if (data.themeColor) setThemeVars('--theme-color', data.themeColor);\r\n\r\n            setLoading(false);\r\n        } catch (error) {\r\n            console.error('Failed to load settings (Full Error):', error.response || error);\r\n            setLoading(false);\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        refreshSettings();\r\n    }, [refreshSettings]);\r\n\r\n    const updateSettings = async (newSettings) => {\r\n        try {\r\n            const { data } = await api.put('/settings', newSettings);\r\n            setSettings(data);\r\n\r\n\r\n            if (data.brandColor) setThemeVars('--brand-color', data.brandColor);\r\n            if (data.themeColor) setThemeVars('--theme-color', data.themeColor);\r\n\r\n            return { success: true, data };\r\n        } catch (error) {\r\n            return {\r\n                success: false,\r\n                error: error.response?.data?.message || 'Failed to update settings'\r\n            };\r\n        }\r\n    };\r\n\r\n    const [theme, setTheme] = useState(localStorage.getItem('theme') || 'system');\r\n    const [effectiveTheme, setEffectiveTheme] = useState('light');\r\n\r\n    // Handle Theme Change\r\n    useEffect(() => {\r\n        const root = document.documentElement;\r\n        localStorage.setItem('theme', theme);\r\n\r\n        const applyTheme = (isDark) => {\r\n            if (isDark) {\r\n                root.classList.add('dark');\r\n                root.setAttribute('data-theme', 'dark');\r\n                setEffectiveTheme('dark');\r\n            } else {\r\n                root.classList.remove('dark');\r\n                root.setAttribute('data-theme', 'light');\r\n                setEffectiveTheme('light');\r\n            }\r\n        };\r\n\r\n        if (theme === 'system') {\r\n            const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\r\n            applyTheme(mediaQuery.matches);\r\n\r\n            const handleChange = (e) => applyTheme(e.matches);\r\n            mediaQuery.addEventListener('change', handleChange);\r\n            return () => mediaQuery.removeEventListener('change', handleChange);\r\n        } else {\r\n            applyTheme(theme === 'dark');\r\n        }\r\n    }, [theme]);\r\n\r\n    const toggleTheme = () => {\r\n        // Cycle: Light -> Dark -> System -> Light\r\n        const modes = ['light', 'dark', 'system'];\r\n        const nextIndex = (modes.indexOf(theme) + 1) % modes.length;\r\n        setTheme(modes[nextIndex]);\r\n    };\r\n\r\n    const value = {\r\n        settings: settings || {\r\n            shopName: 'SHOP',\r\n            currency: 'INR',\r\n            address: '',\r\n            phone: '',\r\n            email: '',\r\n            gstin: ''\r\n        }, // Fallback to avoid null\r\n        loading,\r\n        refreshSettings,\r\n        updateSettings,\r\n        theme,\r\n        effectiveTheme,\r\n        toggleTheme\r\n    };\r\n\r\n    return <SettingsContext.Provider value={value}>{children}</SettingsContext.Provider>;\r\n};\r\n\r\n// Helper: Set both hex and rgb variables for opacity support\r\nconst setThemeVars = (name, hex) => {\r\n    document.documentElement.style.setProperty(name, hex);\r\n\r\n    // Convert hex to rgb\r\n    const r = parseInt(hex.slice(1, 3), 16);\r\n    const g = parseInt(hex.slice(3, 5), 16);\r\n    const b = parseInt(hex.slice(5, 7), 16);\r\n\r\n    document.documentElement.style.setProperty(`${name}-rgb`, `${r}, ${g}, ${b}`);\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\context\\ThemeContext.jsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":6,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":6,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\main.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\pages\\CustomerLedger.jsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  39 |\n  40 |     useEffect(() => {\n> 41 |         loadData();\n     |         ^^^^^^^^ Avoid calling setState() directly within an effect\n  42 |     }, [loadData]);\n  43 |\n  44 |     const handleRecalculate = async () => {","line":41,"column":9,"nodeType":null,"endLine":41,"endColumn":17},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":49,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":49,"endColumn":23}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport Layout from '../components/Layout/Layout';\r\nimport api from '../utils/api';\r\nimport { formatINR } from '../utils/currency';\r\nimport { formatDate } from '../utils/date';\r\nimport { ArrowLeft, Download, RefreshCw, Printer, Plus } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst CustomerLedger = () => {\r\n    const { id } = useParams();\r\n    const navigate = useNavigate();\r\n    const [customer, setCustomer] = useState(null);\r\n    const [ledger, setLedger] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [showPaymentModal, setShowPaymentModal] = useState(false);\r\n    const [payment, setPayment] = useState({\r\n        amount: '',\r\n        method: 'Cash',\r\n        notes: ''\r\n    });\r\n\r\n    const loadData = useCallback(async () => {\r\n        try {\r\n            setLoading(true);\r\n            const [customerRes, ledgerRes] = await Promise.all([\r\n                api.get(`/customers/${id}`),\r\n                api.get(`/ledger/${id}`)\r\n            ]);\r\n            setCustomer(customerRes.data);\r\n            setLedger(ledgerRes.data);\r\n            setLoading(false);\r\n        } catch (error) {\r\n            console.error('Error loading ledger:', error);\r\n            toast.error('Failed to load ledger');\r\n            setLoading(false);\r\n        }\r\n    }, [id]);\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, [loadData]);\r\n\r\n    const handleRecalculate = async () => {\r\n        try {\r\n            await api.post(`/ledger/recalculate/${id}`);\r\n            toast.success('Ledger recalculated');\r\n            loadData();\r\n        } catch (error) {\r\n            toast.error('Recalculation failed');\r\n        }\r\n    };\r\n\r\n    const handleRecordPayment = async () => {\r\n        if (!payment.amount || payment.amount <= 0) {\r\n            return toast.error('Please enter a valid amount');\r\n        }\r\n\r\n        try {\r\n            // Create payment via backend\r\n            await api.post('/payments', {\r\n                customerId: id,\r\n                amount: parseFloat(payment.amount),\r\n                method: payment.method,\r\n                notes: payment.notes || 'Direct payment recorded'\r\n            });\r\n\r\n            toast.success('Payment recorded successfully');\r\n            setShowPaymentModal(false);\r\n            setPayment({ amount: '', method: 'Cash', notes: '' });\r\n            loadData();\r\n        } catch (error) {\r\n            console.error('Payment error:', error);\r\n            toast.error(error.response?.data?.message || 'Failed to record payment');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Layout>\r\n            <div className=\"p-6\">\r\n                {/* Header */}\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                    <div className=\"flex items-center space-x-4\">\r\n                        <button\r\n                            onClick={() => navigate('/customers')}\r\n                            className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors\"\r\n                        >\r\n                            <ArrowLeft className=\"w-6 h-6 text-gray-600 dark:text-gray-400\" />\r\n                        </button>\r\n                        <div>\r\n                            <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n                                {loading ? 'Loading...' : `${customer?.name} - Ledger`}\r\n                            </h1>\r\n                            <p className=\"text-gray-600 dark:text-gray-400\">\r\n                                {customer?.phone} | {customer?.address}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center space-x-3\">\r\n                        <button\r\n                            onClick={() => setShowPaymentModal(true)}\r\n                            className=\"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors\"\r\n                        >\r\n                            <Plus className=\"w-4 h-4\" />\r\n                            <span>Record Payment</span>\r\n                        </button>\r\n                        <button\r\n                            onClick={handleRecalculate}\r\n                            className=\"flex items-center space-x-2 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 transition-colors\"\r\n                        >\r\n                            <RefreshCw className=\"w-4 h-4\" />\r\n                            <span>Recalculate</span>\r\n                        </button>\r\n                        <button className=\"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\">\r\n                            <Printer className=\"w-4 h-4\" />\r\n                            <span>Print Statement</span>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Summary Cards */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\r\n                    <div className=\"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 transition-colors\">\r\n                        <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-1\">Total Debit (Sales)</p>\r\n                        <p className=\"text-2xl font-bold text-red-600 dark:text-red-400 rupee\">\r\n                            {formatINR(ledger.reduce((sum, entry) => sum + (entry.debit || 0), 0))}\r\n                        </p>\r\n                    </div>\r\n                    <div className=\"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 transition-colors\">\r\n                        <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-1\">Total Credit (Received)</p>\r\n                        <p className=\"text-2xl font-bold text-green-600 dark:text-green-400 rupee\">\r\n                            {formatINR(ledger.reduce((sum, entry) => sum + (entry.credit || 0), 0))}\r\n                        </p>\r\n                    </div>\r\n                    <div className=\"bg-blue-50 dark:bg-blue-900/30 p-6 rounded-xl shadow-sm border border-blue-100 dark:border-blue-800/50 transition-colors\">\r\n                        <p className=\"text-sm text-blue-800 dark:text-blue-300 mb-1\">Net Balance Due</p>\r\n                        <p className=\"text-3xl font-bold text-blue-700 dark:text-blue-400 rupee\">\r\n                            {formatINR(customer?.balance || 0)}\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Ledger Table */}\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden border border-gray-100 dark:border-gray-700 transition-colors\">\r\n                    <div className=\"overflow-x-auto\">\r\n                        <table className=\"w-full\">\r\n                            <thead>\r\n                                <tr className=\"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-700\">\r\n                                    <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">Date</th>\r\n                                    <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">Particulars</th>\r\n                                    <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">Ref No</th>\r\n                                    <th className=\"px-6 py-4 text-right text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider text-red-600 dark:text-red-400\">Debit (Dr)</th>\r\n                                    <th className=\"px-6 py-4 text-right text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider text-green-600 dark:text-green-400\">Credit (Cr)</th>\r\n                                    <th className=\"px-6 py-4 text-right text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">Balance</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody className=\"divide-y divide-gray-200 dark:divide-gray-700\">\r\n                                {loading ? (\r\n                                    <tr>\r\n                                        <td colSpan=\"6\" className=\"text-center py-8\">Loading ledger...</td>\r\n                                    </tr>\r\n                                ) : ledger.length === 0 ? (\r\n                                    <tr>\r\n                                        <td colSpan=\"6\" className=\"text-center py-8 text-gray-500\">No transactions found</td>\r\n                                    </tr>\r\n                                ) : (\r\n                                    ledger.map((entry) => (\r\n                                        <tr key={entry._id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\">\r\n                                            <td className=\"px-6 py-4 text-sm text-gray-900 dark:text-gray-100 whitespace-nowrap\">\r\n                                                {formatDate(entry.date)}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-sm text-gray-900 dark:text-gray-100\">\r\n                                                <div className=\"font-medium\">{entry.refType}</div>\r\n                                                <div className=\"text-gray-500 dark:text-gray-400 text-xs\">{entry.description}</div>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-sm text-gray-500 dark:text-gray-400 font-mono\">\r\n                                                {entry.refNo || '-'}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-sm text-right font-medium text-red-600 dark:text-red-400\">\r\n                                                {entry.debit > 0 ? formatINR(entry.debit) : '-'}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-sm text-right font-medium text-green-600 dark:text-green-400\">\r\n                                                {entry.credit > 0 ? formatINR(entry.credit) : '-'}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-sm text-right font-bold text-gray-900 dark:text-white rupee bg-gray-50 dark:bg-gray-700/30\">\r\n                                                {formatINR(entry.balance)}\r\n                                            </td>\r\n                                        </tr>\r\n                                    ))\r\n                                )}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Payment Recording Modal */}\r\n            {showPaymentModal && (\r\n                <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 backdrop-blur-sm\">\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6 shadow-2xl transition-colors\">\r\n                        <h3 className=\"text-xl font-bold text-gray-900 dark:text-white mb-4\">Record Payment</h3>\r\n\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                    Amount *\r\n                                </label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={payment.amount}\r\n                                    onChange={(e) => setPayment({ ...payment, amount: e.target.value })}\r\n                                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors\"\r\n                                    placeholder=\"Enter amount received\"\r\n                                    min=\"0\"\r\n                                    step=\"0.01\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                    Payment Method *\r\n                                </label>\r\n                                <select\r\n                                    value={payment.method}\r\n                                    onChange={(e) => setPayment({ ...payment, method: e.target.value })}\r\n                                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors\"\r\n                                >\r\n                                    <option value=\"Cash\">Cash</option>\r\n                                    <option value=\"Credit\">Credit</option>\r\n                                    <option value=\"UPI\">UPI</option>\r\n                                    <option value=\"Card\">Card</option>\r\n                                    <option value=\"Bank Transfer\">Bank Transfer</option>\r\n                                </select>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                    Notes (Optional)\r\n                                </label>\r\n                                <textarea\r\n                                    value={payment.notes}\r\n                                    onChange={(e) => setPayment({ ...payment, notes: e.target.value })}\r\n                                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors\"\r\n                                    rows=\"3\"\r\n                                    placeholder=\"e.g., Payment for Invoice #123\"\r\n                                ></textarea>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex justify-end space-x-3 mt-6\">\r\n                            <button\r\n                                onClick={() => setShowPaymentModal(false)}\r\n                                className=\"px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors\"\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                            <button\r\n                                onClick={handleRecordPayment}\r\n                                className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium\"\r\n                            >\r\n                                Record Payment\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </Layout>\r\n    );\r\n};\r\n\r\nexport default CustomerLedger;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\pages\\Customers.jsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  47 |\n  48 |     useEffect(() => {\n> 49 |         loadCustomers();\n     |         ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  50 |     }, [loadCustomers]);\n  51 |\n  52 |     useEffect(() => {","line":49,"column":9,"nodeType":null,"endLine":49,"endColumn":22},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  57 |                 c.email?.toLowerCase().includes(searchQuery.toLowerCase())\n  58 |             );\n> 59 |             setFilteredCustomers(filtered);\n     |             ^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  60 |         } else {\n  61 |             setFilteredCustomers(customers);\n  62 |         }","line":59,"column":13,"nodeType":null,"endLine":59,"endColumn":33},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":78,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":78,"endColumn":23}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport ConfirmationModal from '../components/ConfirmationModal';\r\nimport Layout from '../components/Layout/Layout';\r\nimport api from '../utils/api';\r\nimport { formatINR } from '../utils/currency';\r\nimport {\r\n    Users,\r\n    Search,\r\n    Plus,\r\n    Edit2,\r\n    Trash2,\r\n    BookOpen, // Ledger Icon\r\n    Eye,\r\n    X,\r\n    Phone,\r\n    Mail,\r\n    IndianRupee\r\n} from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst Customers = () => {\r\n    const navigate = useNavigate();\r\n    const [customers, setCustomers] = useState([]);\r\n    const [filteredCustomers, setFilteredCustomers] = useState([]);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [loading, setLoading] = useState(true);\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [editingCustomer, setEditingCustomer] = useState(null);\r\n    const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n    const [customerToDelete, setCustomerToDelete] = useState(null);\r\n\r\n\r\n    const loadCustomers = useCallback(async () => {\r\n        try {\r\n            setLoading(true);\r\n            const { data } = await api.get('/customers');\r\n            setCustomers(data);\r\n            setFilteredCustomers(data);\r\n            setLoading(false);\r\n        } catch (error) {\r\n            console.error('Failed to load customers:', error);\r\n            toast.error('Failed to load customers');\r\n            setLoading(false);\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        loadCustomers();\r\n    }, [loadCustomers]);\r\n\r\n    useEffect(() => {\r\n        if (searchQuery) {\r\n            const filtered = customers.filter(c =>\r\n                c.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n                c.phone.includes(searchQuery) ||\r\n                c.email?.toLowerCase().includes(searchQuery.toLowerCase())\r\n            );\r\n            setFilteredCustomers(filtered);\r\n        } else {\r\n            setFilteredCustomers(customers);\r\n        }\r\n    }, [searchQuery, customers]);\r\n\r\n    const handleDeleteClick = (customer) => {\r\n        setCustomerToDelete(customer);\r\n        setShowDeleteModal(true);\r\n    };\r\n\r\n    const confirmDelete = async () => {\r\n        if (!customerToDelete) return;\r\n\r\n        try {\r\n            await api.delete(`/customers/${customerToDelete._id}`);\r\n            toast.success('Customer deleted successfully');\r\n            loadCustomers();\r\n            setCustomerToDelete(null);\r\n        } catch (error) {\r\n            toast.error('Failed to delete customer');\r\n        }\r\n    };\r\n\r\n    const handleEdit = (customer) => {\r\n        setEditingCustomer(customer);\r\n        setShowModal(true);\r\n    };\r\n\r\n    const handleAdd = () => {\r\n        setEditingCustomer(null);\r\n        setShowModal(true);\r\n    };\r\n\r\n    return (\r\n        <Layout>\r\n            <div className=\"p-6\">\r\n                {/* Header */}\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                    <div>\r\n                        <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">Customers</h1>\r\n                        <p className=\"text-gray-600 dark:text-gray-400 mt-1\">Manage customer information and ledgers</p>\r\n                    </div>\r\n                    <button\r\n                        onClick={handleAdd}\r\n                        className=\"flex items-center space-x-2 px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 shadow-sm transition-all\"\r\n                    >\r\n                        <Plus className=\"w-5 h-5\" />\r\n                        <span>Add Customer</span>\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Search */}\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 mb-6 border border-gray-100 dark:border-gray-700\">\r\n                    <div className=\"relative\">\r\n                        <Search className=\"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400\" />\r\n                        <input\r\n                            type=\"text\"\r\n                            value={searchQuery}\r\n                            onChange={(e) => setSearchQuery(e.target.value)}\r\n                            placeholder=\"Search by name, phone, or email...\"\r\n                            className=\"w-full pl-12 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Customers Grid */}\r\n                {loading ? (\r\n                    <div className=\"text-center py-12\">\r\n                        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto\"></div>\r\n                    </div>\r\n                ) : filteredCustomers.length === 0 ? (\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-12 text-center text-gray-500 dark:text-gray-400 border border-gray-100 dark:border-gray-700\">\r\n                        <Users className=\"w-16 h-16 mx-auto mb-4 opacity-50\" />\r\n                        <p className=\"text-lg\">No customers found</p>\r\n                        <button\r\n                            onClick={handleAdd}\r\n                            className=\"mt-4 text-blue-500 hover:text-blue-600 font-medium\"\r\n                        >\r\n                            Add your first customer\r\n                        </button>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                        {filteredCustomers.map((customer) => (\r\n                            <div\r\n                                key={customer._id}\r\n                                className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 hover:shadow-md transition-shadow border border-gray-100 dark:border-gray-700\"\r\n                            >\r\n                                <div className=\"flex items-start justify-between mb-4\">\r\n                                    <div>\r\n                                        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">{customer.name}</h3>\r\n                                        <div className=\"flex items-center space-x-2 mt-1 text-sm text-gray-600 dark:text-gray-400\">\r\n                                            <Phone className=\"w-4 h-4\" />\r\n                                            <span>{customer.phone}</span>\r\n                                        </div>\r\n                                        {customer.email && (\r\n                                            <div className=\"flex items-center space-x-2 mt-1 text-sm text-gray-600 dark:text-gray-400\">\r\n                                                <Mail className=\"w-4 h-4\" />\r\n                                                <span>{customer.email}</span>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {customer.address && (\r\n                                    <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2\">{customer.address}</p>\r\n                                )}\r\n\r\n                                <div className=\"border-t border-gray-200 dark:border-gray-700 pt-4\">\r\n                                    <div className=\"flex items-center justify-between mb-2\">\r\n                                        <span className=\"text-sm text-gray-600 dark:text-gray-400\">Balance:</span>\r\n                                        <span className={`text-lg font-bold rupee ${customer.balance > 0 ? 'text-red-600 dark:text-red-400' : 'text-green-600 dark:text-green-400'\r\n                                            }`}>\r\n                                            {formatINR(Math.abs(customer.balance))}\r\n                                        </span>\r\n                                    </div>\r\n                                    {customer.balance > 0 && (\r\n                                        <p className=\"text-xs text-red-600 dark:text-red-400\">Due amount</p>\r\n                                    )}\r\n                                </div>\r\n\r\n                                <div className=\"flex items-center justify-end space-x-2 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\r\n                                    <button\r\n                                        onClick={() => navigate(`/customers/${customer._id}/ledger`)}\r\n                                        className=\"p-2 text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-lg transition-colors\"\r\n                                        title=\"View Ledger\"\r\n                                    >\r\n                                        <BookOpen className=\"w-4 h-4\" />\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => handleEdit(customer)}\r\n                                        className=\"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors\"\r\n                                        title=\"Edit\"\r\n                                    >\r\n                                        <Edit2 className=\"w-4 h-4\" />\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => handleDeleteClick(customer)}\r\n                                        className=\"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors\"\r\n                                        title=\"Delete\"\r\n                                    >\r\n                                        <Trash2 className=\"w-4 h-4\" />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Add/Edit Customer Modal */}\r\n            {showModal && (\r\n                <CustomerModal\r\n                    customer={editingCustomer}\r\n                    onClose={() => {\r\n                        setShowModal(false);\r\n                        setEditingCustomer(null);\r\n                    }}\r\n                    onSuccess={() => {\r\n                        setShowModal(false);\r\n                        setEditingCustomer(null);\r\n                        loadCustomers();\r\n                    }}\r\n                />\r\n            )}\r\n\r\n            <ConfirmationModal\r\n                isOpen={showDeleteModal}\r\n                onClose={() => {\r\n                    setShowDeleteModal(false);\r\n                    setCustomerToDelete(null);\r\n                }}\r\n                onConfirm={confirmDelete}\r\n                title=\"Delete Customer\"\r\n                message={`Are you sure you want to delete \"${customerToDelete?.name}\"? This action cannot be undone.`}\r\n                confirmText=\"Delete Customer\"\r\n                isDangerous={true}\r\n            />\r\n        </Layout>\r\n    );\r\n};\r\n\r\n// Customer Modal Component\r\nconst CustomerModal = ({ customer, onClose, onSuccess }) => {\r\n    const [formData, setFormData] = useState({\r\n        name: customer?.name || '',\r\n        phone: customer?.phone || '',\r\n        email: customer?.email || '',\r\n        address: customer?.address || '',\r\n        gstin: customer?.gstin || '',\r\n    });\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n\r\n        try {\r\n            if (customer) {\r\n                await api.put(`/customers/${customer._id}`, formData);\r\n                toast.success('Customer updated successfully');\r\n            } else {\r\n                await api.post('/customers', formData);\r\n                toast.success('Customer added successfully');\r\n            }\r\n            onSuccess();\r\n        } catch (error) {\r\n            toast.error(error.response?.data?.message || 'Failed to save customer');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 backdrop-blur-sm\">\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full border border-gray-100 dark:border-gray-700\">\r\n                <div className=\"p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between\">\r\n                    <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n                        {customer ? 'Edit Customer' : 'Add New Customer'}\r\n                    </h2>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors text-gray-500 dark:text-gray-400\"\r\n                    >\r\n                        <X className=\"w-6 h-6\" />\r\n                    </button>\r\n                </div>\r\n\r\n                <form onSubmit={handleSubmit} className=\"p-6 space-y-4\">\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                            Full Name *\r\n                        </label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={formData.name}\r\n                            onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                            className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                            required\r\n                        />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                            Phone *\r\n                        </label>\r\n                        <input\r\n                            type=\"tel\"\r\n                            value={formData.phone}\r\n                            onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\r\n                            className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                            required\r\n                        />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                            Email\r\n                        </label>\r\n                        <input\r\n                            type=\"email\"\r\n                            value={formData.email}\r\n                            onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                            className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                            Address\r\n                        </label>\r\n                        <textarea\r\n                            value={formData.address}\r\n                            onChange={(e) => setFormData({ ...formData, address: e.target.value })}\r\n                            className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                            rows={3}\r\n                        />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                            GSTIN (Optional)\r\n                        </label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={formData.gstin}\r\n                            onChange={(e) => setFormData({ ...formData, gstin: e.target.value })}\r\n                            className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                            placeholder=\"22AAAAA0000A1Z5\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700\">\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={onClose}\r\n                            className=\"px-6 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-gray-700 dark:text-gray-300\"\r\n                        >\r\n                            Cancel\r\n                        </button>\r\n                        <button\r\n                            type=\"submit\"\r\n                            disabled={loading}\r\n                            className=\"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50\"\r\n                        >\r\n                            {loading ? 'Saving...' : customer ? 'Update Customer' : 'Add Customer'}\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Customers;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\pages\\Dashboard.jsx","messages":[{"ruleId":"no-undef","severity":2,"message":"'setLoading' is not defined.","line":38,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":38,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'setLoading' is not defined.","line":104,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":104,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'setLoading' is not defined.","line":107,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":107,"endColumn":23},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  110 |\n  111 |     useEffect(() => {\n> 112 |         loadDashboardData();\n      |         ^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  113 |     }, [loadDashboardData]);\n  114 |\n  115 |     const getStatusColor = (status) => {","line":112,"column":9,"nodeType":null,"endLine":112,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'loading' is not defined.","line":128,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":128,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'recentInvoices' is not defined.","line":285,"column":30,"nodeType":"Identifier","messageId":"undef","endLine":285,"endColumn":44},{"ruleId":"no-undef","severity":2,"message":"'recentInvoices' is not defined.","line":292,"column":38,"nodeType":"Identifier","messageId":"undef","endLine":292,"endColumn":52}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useClientView } from '../context/ClientViewContext.jsx';\r\nimport Layout from '../components/Layout/Layout';\r\nimport api from '../utils/api';\r\nimport { formatINR } from '../utils/currency';\r\nimport {\r\n    ShoppingCart,\r\n    Package,\r\n    IndianRupee,\r\n    AlertCircle,\r\n    TrendingUp,\r\n    Users,\r\n    FileText,\r\n    Wallet,\r\n    CreditCard\r\n} from 'lucide-react';\r\n\r\nconst Dashboard = () => {\r\n    const navigate = useNavigate();\r\n    const { user } = useAuth();\r\n    const { isClientView } = useClientView();\r\n    const [stats, setStats] = useState({\r\n        totalParties: 0,\r\n        totalItems: 0,\r\n        totalSales: 0,\r\n        totalInvoices: 0,\r\n        cashCollection: 0,\r\n        totalCollections: 0,\r\n        totalReceivables: 0,\r\n        recentInvoices: []\r\n    });\r\n    const [lowStockProducts, setLowStockProducts] = useState([]); // Keep this if it's still used later\r\n\r\n    const loadDashboardData = useCallback(async () => {\r\n        try {\r\n            setLoading(true);\r\n            const [productsRes, invoicesRes, customersRes] = await Promise.all([\r\n                api.get('/products'),\r\n                api.get('/invoices'),\r\n                api.get('/customers'),\r\n            ]);\r\n\r\n            const products = productsRes.data;\r\n            const invoices = invoicesRes.data;\r\n            const customers = customersRes.data;\r\n\r\n            // Calculate stats\r\n            const today = new Date().toDateString();\r\n            const todaysInvoices = invoices.filter(inv =>\r\n                new Date(inv.createdAt).toDateString() === today\r\n            );\r\n\r\n            const todaySales = todaysInvoices.reduce((sum, inv) => sum + inv.grandTotal, 0);\r\n            const totalSales = invoices.reduce((sum, inv) => sum + inv.grandTotal, 0);\r\n\r\n            // Cash vs Online collection (today)\r\n            const cashCollection = todaysInvoices.reduce((sum, inv) => {\r\n                const cashPayment = inv.payments?.find(p => p.mode === 'Cash');\r\n                return sum + (cashPayment?.amount || 0);\r\n            }, 0);\r\n\r\n            const onlineCollection = todaysInvoices.reduce((sum, inv) => {\r\n                const upiPayment = inv.payments?.find(p => p.mode === 'UPI');\r\n                const cardPayment = inv.payments?.find(p => p.mode === 'Card');\r\n                const bankPayment = inv.payments?.find(p => p.mode === 'Bank Transfer');\r\n                return sum + (upiPayment?.amount || 0) + (cardPayment?.amount || 0) + (bankPayment?.amount || 0);\r\n            }, 0);\r\n\r\n            // Credit/Udhaar (today's unpaid from today's invoices?)\r\n            // Or total credit? Usually \"Credit (Udhaar)\" implies total outstanding or today's credit given.\r\n            // Let's assume today's credit given for now based on context of \"Today's Collection Breakdown\"\r\n            // But if it's \"Credit (Udhaar)\", it might mean how much credit was given TODAY.\r\n            const creditUdhaar = todaysInvoices.reduce((sum, inv) => {\r\n                // Check if fully paid? Or just grandTotal - paidAmount\r\n                return sum + (inv.grandTotal - (inv.paidAmount || 0));\r\n            }, 0);\r\n\r\n            // Stock value and potential profit\r\n            const totalStockValue = products.reduce((sum, p) => sum + ((p.costPrice || 0) * p.stock), 0);\r\n            const potentialProfit = products.reduce((sum, p) =>\r\n                sum + (((p.sellingPrice || 0) - (p.costPrice || 0)) * p.stock), 0\r\n            );\r\n\r\n            // Get low stock items (stock <= 5)\r\n            const lowStock = products.filter(p => p.stock <= 5);\r\n\r\n            setStats({\r\n                totalParties: customers.length,\r\n                totalItems: products.length,\r\n                totalSales,\r\n                totalInvoices: invoices.length,\r\n                cashCollection,\r\n                onlineCollection,\r\n                todaySales,\r\n                creditUdhaar,\r\n                totalStockValue,\r\n                potentialProfit,\r\n                recentInvoices: invoices.slice(0, 5) // Most recent 5 (assuming sorted by backend or insert order)\r\n            });\r\n\r\n            setLowStockProducts(lowStock.slice(0, 10));\r\n            setLoading(false);\r\n        } catch (error) {\r\n            console.error('Failed to load dashboard data:', error);\r\n            setLoading(false);\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        loadDashboardData();\r\n    }, [loadDashboardData]);\r\n\r\n    const getStatusColor = (status) => {\r\n        switch (status) {\r\n            case 'Paid':\r\n                return 'bg-green-100 text-green-700';\r\n            case 'Partial':\r\n                return 'bg-yellow-100 text-yellow-700';\r\n            case 'Due':\r\n                return 'bg-red-100 text-red-700';\r\n            default:\r\n                return 'bg-gray-100 text-gray-700';\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <Layout>\r\n                <div className=\"flex items-center justify-center h-screen\">\r\n                    <div className=\"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500\"></div>\r\n                </div>\r\n            </Layout>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Layout>\r\n            <div className=\"p-6\">\r\n                {/* Header */}\r\n                <div className=\"mb-6\">\r\n                    <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">Dashboard</h1>\r\n                    <p className=\"text-gray-600 dark:text-gray-400 mt-1\">\r\n                        Welcome back, {user?.name}! Here's what's happening today.\r\n                    </p>\r\n                </div>\r\n\r\n                {/* Top 4 Stat Cards */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6\">\r\n                    {/* Total Parties */}\r\n                    <div className=\"bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white shadow-sm\">\r\n                        <div className=\"flex items-start justify-between\">\r\n                            <div>\r\n                                <p className=\"text-sm font-medium opacity-90\">Total Parties</p>\r\n                                <p className=\"text-3xl font-bold mt-2\">{stats.totalParties}</p>\r\n                            </div>\r\n                            <div className=\"p-3 bg-white bg-opacity-20 rounded-lg\">\r\n                                <Users className=\"w-8 h-8\" />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Total Items */}\r\n                    <div className=\"bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white shadow-sm\">\r\n                        <div className=\"flex items-start justify-between\">\r\n                            <div>\r\n                                <p className=\"text-sm font-medium opacity-90\">Total Items</p>\r\n                                <p className=\"text-3xl font-bold mt-2\">{stats.totalItems}</p>\r\n                            </div>\r\n                            <div className=\"p-3 bg-white bg-opacity-20 rounded-lg\">\r\n                                <Package className=\"w-8 h-8\" />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Total Sales */}\r\n                    <div className=\"bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-6 text-white shadow-sm\">\r\n                        <div className=\"flex items-start justify-between\">\r\n                            <div>\r\n                                <p className=\"text-sm font-medium opacity-90\">Total Sales</p>\r\n                                <p className=\"text-3xl font-bold mt-2 rupee\">\r\n                                    {formatINR(stats.totalSales)}\r\n                                </p>\r\n                            </div>\r\n                            <div className=\"p-3 bg-white bg-opacity-20 rounded-lg\">\r\n                                <TrendingUp className=\"w-8 h-8\" />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Total Invoices */}\r\n                    <div className=\"bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-6 text-white shadow-sm\">\r\n                        <div className=\"flex items-start justify-between\">\r\n                            <div>\r\n                                <p className=\"text-sm font-medium opacity-90\">Total Invoices</p>\r\n                                <p className=\"text-3xl font-bold mt-2\">{stats.totalInvoices}</p>\r\n                            </div>\r\n                            <div className=\"p-3 bg-white bg-opacity-20 rounded-lg\">\r\n                                <FileText className=\"w-8 h-8\" />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Today's Collection Breakdown */}\r\n                <div className=\"mb-6\">\r\n                    <h2 className=\"text-lg font-semibold text-gray-700 dark:text-gray-200 mb-4 flex items-center\">\r\n                        <span className=\"mr-2\"></span> Today's Collection Breakdown\r\n                    </h2>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n                        {/* Cash Collection */}\r\n                        <div className=\"bg-gradient-to-br from-emerald-50 to-emerald-100 dark:from-emerald-900/20 dark:to-emerald-900/10 rounded-lg p-4 border border-emerald-200 dark:border-emerald-800\">\r\n                            <p className=\"text-sm font-medium text-emerald-700 dark:text-emerald-400\"> Cash Collection</p>\r\n                            <p className=\"text-2xl font-bold text-emerald-600 dark:text-emerald-300 mt-2 rupee\">\r\n                                {formatINR(stats.cashCollection)}\r\n                            </p>\r\n                        </div>\r\n\r\n                        {/* Online (UPI) */}\r\n                        <div className=\"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-900/10 rounded-lg p-4 border border-blue-200 dark:border-blue-800\">\r\n                            <p className=\"text-sm font-medium text-blue-700 dark:text-blue-400\"> Online(UPI)</p>\r\n                            <p className=\"text-2xl font-bold text-blue-600 dark:text-blue-300 mt-2 rupee\">\r\n                                {formatINR(stats.onlineCollection)}\r\n                            </p>\r\n                        </div>\r\n\r\n                        {/* Total Sale */}\r\n                        <div className=\"bg-gradient-to-br from-pink-50 to-pink-100 dark:from-pink-900/20 dark:to-pink-900/10 rounded-lg p-4 border border-pink-200 dark:border-pink-800\">\r\n                            <p className=\"text-sm font-medium text-pink-700 dark:text-pink-400\"> Total Sale</p>\r\n                            <p className=\"text-2xl font-bold text-pink-600 dark:text-pink-300 mt-2 rupee\">\r\n                                {formatINR(stats.todaySales)}\r\n                            </p>\r\n                        </div>\r\n\r\n                        {/* Credit (Udhaar) */}\r\n                        <div className=\"bg-gradient-to-br from-amber-50 to-amber-100 dark:from-amber-900/20 dark:to-amber-900/10 rounded-lg p-4 border border-amber-200 dark:border-amber-800\">\r\n                            <p className=\"text-sm font-medium text-amber-700 dark:text-amber-400\"> Credit (Udhaar)</p>\r\n                            <p className=\"text-2xl font-bold text-amber-600 dark:text-amber-300 mt-2 rupee\">\r\n                                {formatINR(stats.creditUdhaar)}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Stock Value and Potential Profit */}\r\n                {!isClientView && (\r\n                    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\">\r\n                        {/* Total Stock Value */}\r\n                        <div className=\"bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl p-6 text-white shadow-lg\">\r\n                            <div className=\"flex items-center justify-between mb-2\">\r\n                                <h3 className=\"text-lg font-semibold\">Total Stock Value</h3>\r\n                                <Wallet className=\"w-6 h-6 opacity-80\" />\r\n                            </div>\r\n                            <p className=\"text-xs opacity-80 mb-4\">In current inventory</p>\r\n                            <p className=\"text-4xl font-bold rupee\">{formatINR(stats.totalStockValue)}</p>\r\n                        </div>\r\n\r\n                        {/* Potential Profit */}\r\n                        <div className=\"bg-gradient-to-br from-emerald-500 to-green-600 rounded-xl p-6 text-white shadow-lg\">\r\n                            <div className=\"flex items-center justify-between mb-2\">\r\n                                <h3 className=\"text-lg font-semibold\">Potential Profit</h3>\r\n                                <TrendingUp className=\"w-6 h-6 opacity-80\" />\r\n                            </div>\r\n                            <p className=\"text-xs opacity-80 mb-4\">On current inventory</p>\r\n                            <p className=\"text-4xl font-bold rupee\">{formatINR(stats.potentialProfit)}</p>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Recent Invoices and Low Stock Items */}\r\n                <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                    {/* Recent Invoices */}\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between\">\r\n                            <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white\">Recent Invoices</h2>\r\n                            <button\r\n                                onClick={() => navigate('/invoices')}\r\n                                className=\"text-sm text-blue-500 hover:text-blue-600 font-medium\"\r\n                            >\r\n                                View All\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"p-6\">\r\n                            {recentInvoices.length === 0 ? (\r\n                                <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\r\n                                    <FileText className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\r\n                                    <p>No invoices yet</p>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"space-y-3\">\r\n                                    {recentInvoices.map((invoice) => (\r\n                                        <div\r\n                                            key={invoice._id}\r\n                                            className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors cursor-pointer\"\r\n                                            onClick={() => navigate(`/invoices`)}\r\n                                        >\r\n                                            <div>\r\n                                                <p className=\"font-semibold text-gray-900 dark:text-white\">{invoice.invoiceNo}</p>\r\n                                                <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                                                    {invoice.customer?.name || 'Walk-in'}\r\n                                                </p>\r\n                                            </div>\r\n                                            <div className=\"text-right\">\r\n                                                <p className=\"font-bold text-gray-900 dark:text-white rupee text-sm\">\r\n                                                    {formatINR(invoice.grandTotal)}\r\n                                                </p>\r\n                                                <span className={`inline-block px-2 py-0.5 rounded-full text-xs font-semibold ${getStatusColor(invoice.status)}`}>\r\n                                                    {invoice.status}\r\n                                                </span>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Low Stock Items */}\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between\">\r\n                            <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white flex items-center\">\r\n                                <AlertCircle className=\"w-5 h-5 mr-2 text-orange-500\" />\r\n                                Low Stock Items\r\n                            </h2>\r\n                        </div>\r\n                        <div className=\"p-6\">\r\n                            {lowStockProducts.length === 0 ? (\r\n                                <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\r\n                                    <Package className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\r\n                                    <p className=\"text-green-600 dark:text-green-400 font-medium\">All items are well stocked!</p>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"space-y-3\">\r\n                                    <p className=\"text-xs text-orange-600 dark:text-orange-400 mb-3\">Items below minimum stock level</p>\r\n                                    {lowStockProducts.map((product) => (\r\n                                        <div\r\n                                            key={product._id}\r\n                                            className=\"flex items-center justify-between p-3 bg-orange-50 dark:bg-orange-900/10 rounded-lg border border-orange-200 dark:border-orange-900/30\"\r\n                                        >\r\n                                            <div className=\"flex items-center space-x-3\">\r\n                                                {product.image && (\r\n                                                    <img\r\n                                                        src={product.image}\r\n                                                        alt={product.name}\r\n                                                        className=\"w-10 h-10 rounded object-cover\"\r\n                                                    />\r\n                                                )}\r\n                                                <div>\r\n                                                    <p className=\"font-medium text-gray-900 dark:text-white text-sm\">{product.name}</p>\r\n                                                    <p className=\"text-xs text-gray-500 dark:text-gray-400\">{product.category}</p>\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"text-right\">\r\n                                                <p className=\"text-lg font-bold text-orange-600 dark:text-orange-400\">\r\n                                                    {product.stock}\r\n                                                </p>\r\n                                                <p className=\"text-xs text-gray-500 dark:text-gray-400\">in stock</p>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Layout>\r\n    );\r\n};\r\n\r\nexport default Dashboard;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\pages\\Daybook.jsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  41 |\n  42 |     useEffect(() => {\n> 43 |         loadDaybook();\n     |         ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  44 |     }, [loadDaybook]);\n  45 |\n  46 |     const handleDelete = (id) => {","line":43,"column":9,"nodeType":null,"endLine":43,"endColumn":20}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport Layout from '../components/Layout/Layout';\r\nimport ConfirmationModal from '../components/ConfirmationModal';\r\nimport api from '../utils/api';\r\nimport { formatINR } from '../utils/currency';\r\nimport { formatDate } from '../utils/date';\r\nimport {\r\n    BookOpen,\r\n    Calendar,\r\n    TrendingUp,\r\n    TrendingDown,\r\n    IndianRupee,\r\n    ArrowUpCircle,\r\n    ArrowDownCircle,\r\n    Trash2\r\n} from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\nimport RecordPaymentModal from '../components/RecordPaymentModal';\r\n\r\nconst Daybook = () => {\r\n    const [selectedDate, setSelectedDate] = useState(new Date().toLocaleDateString('en-CA'));\r\n    const [daybookData, setDaybookData] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);\r\n    const [isPaymentModalOpen, setIsPaymentModalOpen] = useState(false);\r\n    const [transactionToDelete, setTransactionToDelete] = useState(null);\r\n\r\n    const loadDaybook = useCallback(async () => {\r\n        try {\r\n            setLoading(true);\r\n            const { data } = await api.get(`/ledger/daybook?date=${selectedDate}`);\r\n            setDaybookData(data);\r\n            setLoading(false);\r\n        } catch (error) {\r\n            console.error('Failed to load daybook:', error);\r\n            toast.error('Failed to load daybook');\r\n            setLoading(false);\r\n        }\r\n    }, [selectedDate]);\r\n\r\n    useEffect(() => {\r\n        loadDaybook();\r\n    }, [loadDaybook]);\r\n\r\n    const handleDelete = (id) => {\r\n        setTransactionToDelete(id);\r\n        setIsDeleteModalOpen(true);\r\n    };\r\n\r\n    const confirmDelete = async () => {\r\n        if (!transactionToDelete) return;\r\n\r\n        try {\r\n            await api.delete(`/payments/${transactionToDelete}`);\r\n            toast.success('Transaction deleted');\r\n            loadDaybook();\r\n            setIsDeleteModalOpen(false);\r\n            setTransactionToDelete(null);\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error('Failed to delete transaction');\r\n        }\r\n    };\r\n\r\n    const getTotalCashIn = () => {\r\n        if (!daybookData?.transactions) return 0;\r\n        return daybookData.transactions\r\n            .filter(t => t.type === 'Sale')\r\n            .reduce((sum, t) => sum + t.amount, 0);\r\n    };\r\n\r\n    const getTotalCashOut = () => {\r\n        if (!daybookData?.transactions) return 0;\r\n        return daybookData.transactions\r\n            .filter(t => t.type === 'Purchase' || t.type === 'Expense' || t.type === 'Drawing')\r\n            .reduce((sum, t) => sum + t.amount, 0);\r\n    };\r\n\r\n    const getClosingBalance = () => {\r\n        const opening = daybookData?.openingBalance || 0;\r\n        const cashIn = getTotalCashIn();\r\n        const cashOut = getTotalCashOut();\r\n        return opening + cashIn - cashOut;\r\n    };\r\n\r\n    return (\r\n        <Layout>\r\n            <div className=\"p-6\">\r\n                {/* Header */}\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                    <div>\r\n                        <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">Daybook</h1>\r\n                        <p className=\"text-gray-600 dark:text-gray-400 mt-1\">Daily cash flow and transactions</p>\r\n                    </div>\r\n                    <div className=\"flex items-center space-x-3\">\r\n                        <button\r\n                            onClick={() => setIsPaymentModalOpen(true)}\r\n                            className=\"bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition\"\r\n                        >\r\n                            + Record Payment\r\n                        </button>\r\n                        <Calendar className=\"w-5 h-5 text-gray-400\" />\r\n                        <input\r\n                            type=\"date\"\r\n                            value={selectedDate}\r\n                            onChange={(e) => setSelectedDate(e.target.value)}\r\n                            className=\"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {loading ? (\r\n                    <div className=\"text-center py-12\">\r\n                        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto\"></div>\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        {/* Summary Cards - Kept vibrant but could add dark shadows/borders if needed */}\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\r\n                            <div className=\"bg-blue-500 rounded-xl p-6 text-white shadow-sm\">\r\n                                <div className=\"flex items-start justify-between\">\r\n                                    <div>\r\n                                        <p className=\"text-sm font-medium opacity-90\">Opening Balance</p>\r\n                                        <p className=\"text-2xl font-bold mt-2 rupee\">\r\n                                            {formatINR(daybookData?.openingBalance || 0)}\r\n                                        </p>\r\n                                    </div>\r\n                                    <div className=\"p-3 bg-white bg-opacity-20 rounded-lg\">\r\n                                        <IndianRupee className=\"w-6 h-6\" />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-green-500 rounded-xl p-6 text-white shadow-sm\">\r\n                                <div className=\"flex items-start justify-between\">\r\n                                    <div>\r\n                                        <p className=\"text-sm font-medium opacity-90\">Total Cash In</p>\r\n                                        <p className=\"text-2xl font-bold mt-2 rupee\">\r\n                                            {formatINR(getTotalCashIn())}\r\n                                        </p>\r\n                                    </div>\r\n                                    <div className=\"p-3 bg-white bg-opacity-20 rounded-lg\">\r\n                                        <ArrowDownCircle className=\"w-6 h-6\" />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-red-500 rounded-xl p-6 text-white shadow-sm\">\r\n                                <div className=\"flex items-start justify-between\">\r\n                                    <div>\r\n                                        <p className=\"text-sm font-medium opacity-90\">Total Cash Out</p>\r\n                                        <p className=\"text-2xl font-bold mt-2 rupee\">\r\n                                            {formatINR(getTotalCashOut())}\r\n                                        </p>\r\n                                    </div>\r\n                                    <div className=\"p-3 bg-white bg-opacity-20 rounded-lg\">\r\n                                        <ArrowUpCircle className=\"w-6 h-6\" />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-purple-500 rounded-xl p-6 text-white shadow-sm\">\r\n                                <div className=\"flex items-start justify-between\">\r\n                                    <div>\r\n                                        <p className=\"text-sm font-medium opacity-90\">Closing Balance</p>\r\n                                        <p className=\"text-2xl font-bold mt-2 rupee\">\r\n                                            {formatINR(getClosingBalance())}\r\n                                        </p>\r\n                                    </div>\r\n                                    <div className=\"p-3 bg-white bg-opacity-20 rounded-lg\">\r\n                                        <TrendingUp className=\"w-6 h-6\" />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Transactions Table */}\r\n                        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden border border-gray-100 dark:border-gray-700\">\r\n                            <div className=\"p-6 border-b border-gray-200 dark:border-gray-700\">\r\n                                <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white flex items-center\">\r\n                                    <BookOpen className=\"w-5 h-5 mr-2 text-blue-500\" />\r\n                                    Transactions for {formatDate(selectedDate)}\r\n                                </h2>\r\n                            </div>\r\n\r\n                            {!daybookData?.transactions || daybookData.transactions.length === 0 ? (\r\n                                <div className=\"text-center py-12 text-gray-500 dark:text-gray-400\">\r\n                                    <BookOpen className=\"w-16 h-16 mx-auto mb-4 opacity-50\" />\r\n                                    <p className=\"text-lg\">No transactions for this date</p>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"overflow-x-auto\">\r\n                                    <table className=\"w-full\">\r\n                                        <thead className=\"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-700\">\r\n                                            <tr>\r\n                                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                                                    Type\r\n                                                </th>\r\n                                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                                                    Description\r\n                                                </th>\r\n                                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                                                    Party\r\n                                                </th>\r\n                                                <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                                                    Cash In\r\n                                                </th>\r\n                                                <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                                                    Cash Out\r\n                                                </th>\r\n                                                <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                                                    Balance\r\n                                                </th>\r\n                                                <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                                                    Actions\r\n                                                </th>\r\n                                            </tr>\r\n                                        </thead>\r\n                                        <tbody className=\"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700\">\r\n                                            {daybookData.transactions.map((transaction, index) => {\r\n                                                const isCashIn = transaction.type === 'Sale' || transaction.type === 'Invoice';\r\n                                                const runningBalance = daybookData.openingBalance +\r\n                                                    daybookData.transactions\r\n                                                        .slice(0, index + 1)\r\n                                                        .reduce((sum, t) => {\r\n                                                            const isInc = t.type === 'Sale' || t.type === 'Invoice';\r\n                                                            return sum + (isInc ? t.amount : -t.amount);\r\n                                                        }, 0);\r\n\r\n                                                return (\r\n                                                    <tr key={transaction._id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors\">\r\n                                                        <td className=\"px-6 py-4\">\r\n                                                            <span className={`inline-block px-3 py-1 rounded-full text-xs font-semibold ${transaction.type === 'Sale' || transaction.type === 'Invoice'\r\n                                                                ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400'\r\n                                                                : transaction.type === 'Purchase' || transaction.type === 'Expense' || transaction.type === 'Drawing'\r\n                                                                    ? 'bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400'\r\n                                                                    : 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400'\r\n                                                                }`}>\r\n                                                                {transaction.type}\r\n                                                            </span>\r\n                                                        </td>\r\n                                                        <td className=\"px-6 py-4 text-sm text-gray-900 dark:text-white\">\r\n                                                            {transaction.description}\r\n                                                        </td>\r\n                                                        <td className=\"px-6 py-4 text-sm text-gray-600 dark:text-gray-400\">\r\n                                                            {transaction.party?.name || '-'}\r\n                                                        </td>\r\n                                                        <td className=\"px-6 py-4 text-right text-sm font-semibold text-green-600 dark:text-green-400 rupee\">\r\n                                                            {isCashIn ? formatINR(transaction.amount) : '-'}\r\n                                                        </td>\r\n                                                        <td className=\"px-6 py-4 text-right text-sm font-semibold text-red-600 dark:text-red-400 rupee\">\r\n                                                            {!isCashIn ? formatINR(transaction.amount) : '-'}\r\n                                                        </td>\r\n                                                        <td className=\"px-6 py-4 text-right text-sm font-bold text-gray-900 dark:text-white rupee\">\r\n                                                            {formatINR(runningBalance)}\r\n                                                        </td>\r\n                                                        <td className=\"px-6 py-4 text-right\">\r\n                                                            <button\r\n                                                                onClick={() => handleDelete(transaction._id)}\r\n                                                                className=\"text-red-500 hover:text-red-700 p-1 rounded hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors\"\r\n                                                                title=\"Delete Transaction\"\r\n                                                            >\r\n                                                                <Trash2 className=\"w-4 h-4\" />\r\n                                                            </button>\r\n                                                        </td>\r\n                                                    </tr>\r\n                                                );\r\n                                            })}\r\n\r\n                                            {/* Closing Balance Row */}\r\n                                            <tr className=\"bg-gray-100 dark:bg-gray-700 font-bold\">\r\n                                                <td colSpan=\"3\" className=\"px-6 py-4 text-right text-gray-900 dark:text-white\">\r\n                                                    Closing Balance:\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 text-right text-green-600 dark:text-green-400 rupee\">\r\n                                                    {formatINR(getTotalCashIn())}\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 text-right text-red-600 dark:text-red-400 rupee\">\r\n                                                    {formatINR(getTotalCashOut())}\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 text-right text-purple-600 dark:text-purple-400 rupee\">\r\n                                                    {formatINR(getClosingBalance())}\r\n                                                </td>\r\n                                            </tr>\r\n                                        </tbody>\r\n                                    </table>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </>\r\n                )}\r\n            </div>\r\n\r\n            <ConfirmationModal\r\n                isOpen={isDeleteModalOpen}\r\n                onClose={() => {\r\n                    setIsDeleteModalOpen(false);\r\n                    setTransactionToDelete(null);\r\n                }}\r\n                onConfirm={confirmDelete}\r\n                title=\"Delete Transaction\"\r\n                message=\"Are you sure you want to delete this transaction? This will reverse the balance adjustment and cannot be undone.\"\r\n                confirmText=\"Delete Transaction\"\r\n                cancelText=\"Cancel\"\r\n            />\r\n\r\n            <RecordPaymentModal\r\n                isOpen={isPaymentModalOpen}\r\n                onClose={() => setIsPaymentModalOpen(false)}\r\n                onSuccess={loadDaybook}\r\n            />\r\n        </Layout>\r\n    );\r\n};\r\n\r\nexport default Daybook;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\pages\\Inventory.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'navigate' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":24,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"navigate"},"fix":{"range":[716,747],"text":""},"desc":"Remove unused variable 'navigate'."}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadProducts` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\n  41 |\n  42 |     useEffect(() => {\n> 43 |         loadProducts();\n     |         ^^^^^^^^^^^^ `loadProducts` accessed before it is declared\n  44 |         loadCategories();\n  45 |     }, []);\n  46 |\n\n  76 |     }, [searchQuery, categoryFilter, products]);\n  77 |\n> 78 |     const loadProducts = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 79 |         try {\n     | ^^^^^^^^^^^^^\n> 80 |             setLoading(true);\n     \n     | ^^^^^^^^^^^^^\n> 89 |         }\n     | ^^^^^^^^^^^^^\n> 90 |     };\n     | ^^^^^^^ `loadProducts` is declared here\n  91 |\n  92 |     const handleDeleteClick = (product) => {\n  93 |         setProductToDelete(product);","line":43,"column":9,"nodeType":null,"endLine":43,"endColumn":21},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadCategories` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\n  42 |     useEffect(() => {\n  43 |         loadProducts();\n> 44 |         loadCategories();\n     |         ^^^^^^^^^^^^^^ `loadCategories` accessed before it is declared\n  45 |     }, []);\n  46 |\n  47 |     const loadCategories = async () => {\n\n  45 |     }, []);\n  46 |\n> 47 |     const loadCategories = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 48 |         try {\n     | ^^^^^^^^^^^^^\n> 49 |             const { data } = await api.get('/categories?parent=null');\n     | ^^^^^^^^^^^^^\n> 50 |             setCategories(['All Categories', ...data.map(c => c.name)]);\n     | ^^^^^^^^^^^^^\n> 51 |         } catch (error) {\n     | ^^^^^^^^^^^^^\n> 52 |             console.error('Failed to load categories');\n     | ^^^^^^^^^^^^^\n> 53 |         }\n     | ^^^^^^^^^^^^^\n> 54 |     };\n     | ^^^^^^^ `loadCategories` is declared here\n  55 |\n  56 |     useEffect(() => {\n  57 |         let filtered = products;","line":44,"column":9,"nodeType":null,"endLine":44,"endColumn":23},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":51,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":51,"endColumn":23},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":105,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":105,"endColumn":23},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":443,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":443,"endColumn":27},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":465,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":465,"endColumn":27}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport ConfirmationModal from '../components/ConfirmationModal';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useClientView } from '../context/ClientViewContext.jsx';\r\nimport Layout from '../components/Layout/Layout';\r\nimport CategoryManagementModal from '../components/CategoryManagementModal';\r\nimport api from '../utils/api';\r\nimport { formatINR } from '../utils/currency';\r\nimport {\r\n    Package,\r\n    Search,\r\n    Plus,\r\n    Edit2,\r\n    Trash2,\r\n    X,\r\n    Upload,\r\n    Download,\r\n    FolderTree\r\n} from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst Inventory = () => {\r\n    const navigate = useNavigate();\r\n    const { isAdmin } = useAuth();\r\n    const { isClientView } = useClientView();\r\n    const [products, setProducts] = useState([]);\r\n    const [filteredProducts, setFilteredProducts] = useState([]);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [categoryFilter, setCategoryFilter] = useState('All Categories');\r\n    const [loading, setLoading] = useState(true);\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [showCategoryModal, setShowCategoryModal] = useState(false);\r\n    const [editingProduct, setEditingProduct] = useState(null);\r\n\r\n    const [categories, setCategories] = useState(['All Categories']);\r\n\r\n    // Delete Confirmation State\r\n    const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n    const [productToDelete, setProductToDelete] = useState(null);\r\n\r\n    useEffect(() => {\r\n        loadProducts();\r\n        loadCategories();\r\n    }, []);\r\n\r\n    const loadCategories = async () => {\r\n        try {\r\n            const { data } = await api.get('/categories?parent=null');\r\n            setCategories(['All Categories', ...data.map(c => c.name)]);\r\n        } catch (error) {\r\n            console.error('Failed to load categories');\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        let filtered = products;\r\n\r\n        // Search filter\r\n        if (searchQuery) {\r\n            filtered = filtered.filter(p =>\r\n                p.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n                p.sku?.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n                p.imei1?.includes(searchQuery) ||\r\n                p.imei2?.includes(searchQuery) ||\r\n                p.serialNumber?.includes(searchQuery)\r\n            );\r\n        }\r\n\r\n        // Category filter\r\n        if (categoryFilter !== 'All Categories') {\r\n            filtered = filtered.filter(p => p.category === categoryFilter);\r\n        }\r\n\r\n        setFilteredProducts(filtered);\r\n    }, [searchQuery, categoryFilter, products]);\r\n\r\n    const loadProducts = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const { data } = await api.get('/products');\r\n            setProducts(data);\r\n            setFilteredProducts(data);\r\n            setLoading(false);\r\n        } catch (error) {\r\n            console.error('Failed to load products:', error);\r\n            toast.error('Failed to load products');\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDeleteClick = (product) => {\r\n        setProductToDelete(product);\r\n        setShowDeleteModal(true);\r\n    };\r\n\r\n    const confirmDelete = async () => {\r\n        if (!productToDelete) return;\r\n\r\n        try {\r\n            await api.delete(`/products/${productToDelete._id}`);\r\n            toast.success('Product deleted successfully');\r\n            loadProducts();\r\n            setProductToDelete(null);\r\n        } catch (error) {\r\n            toast.error('Failed to delete product');\r\n        }\r\n    };\r\n\r\n    const handleEdit = (product) => {\r\n        setEditingProduct(product);\r\n        setShowModal(true);\r\n    };\r\n\r\n    const handleAdd = () => {\r\n        setEditingProduct(null);\r\n        setShowModal(true);\r\n    };\r\n\r\n    const handleExport = () => {\r\n        // Define headers\r\n        const headers = ['Name', 'SKU', 'Category', 'Sub-Category', 'Selling Price', 'Stock', 'Min Stock Alert'];\r\n        if (!isClientView) {\r\n            headers.splice(4, 0, 'Cost Price');\r\n        }\r\n\r\n        // Map data to rows\r\n        const rows = filteredProducts.map(p => {\r\n            const row = [\r\n                `\"${p.name.replace(/\"/g, '\"\"')}\"`, // Escape quotes\r\n                `\"${p.sku || ''}\"`,\r\n                `\"${p.category || ''}\"`,\r\n                `\"${p.subCategory || ''}\"`,\r\n                p.sellingPrice || 0,\r\n                p.stock || 0,\r\n                p.minStockAlert || 5\r\n            ];\r\n\r\n            if (!isClientView) {\r\n                row.splice(4, 0, p.costPrice || 0);\r\n            }\r\n\r\n            return row;\r\n        });\r\n\r\n        // Combine headers and rows\r\n        const csvContent = [\r\n            headers.join(','),\r\n            ...rows.map(r => r.join(','))\r\n        ].join('\\n');\r\n\r\n        // Create download link\r\n        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n        const link = document.createElement('a');\r\n        if (link.download !== undefined) {\r\n            const url = URL.createObjectURL(blob);\r\n            link.setAttribute('href', url);\r\n            link.setAttribute('download', `inventory_export_${new Date().toISOString().split('T')[0]}.csv`);\r\n            link.style.visibility = 'hidden';\r\n            document.body.appendChild(link);\r\n            link.click();\r\n            document.body.removeChild(link);\r\n        }\r\n    };\r\n\r\n    const getStockColor = (stock) => {\r\n        if (stock <= 5) return 'text-red-600 bg-red-50';\r\n        if (stock <= 10) return 'text-yellow-600 bg-yellow-50';\r\n        return 'text-green-600 bg-green-50';\r\n    };\r\n\r\n    return (\r\n        <Layout>\r\n            <div className=\"p-6\">\r\n                {/* Header */}\r\n                <div className=\"mb-6\">\r\n                    <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">Inventory Management</h1>\r\n                    <p className=\"text-gray-600 dark:text-gray-400 mt-1\">Manage your product catalog</p>\r\n                </div>\r\n\r\n                {/* Toolbar */}\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 mb-6 border border-gray-100 dark:border-gray-700\">\r\n                    <div className=\"flex flex-col lg:flex-row items-center gap-4\">\r\n                        {/* Search */}\r\n                        <div className=\"relative flex-1 w-full\">\r\n                            <Search className=\"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400\" />\r\n                            <input\r\n                                type=\"text\"\r\n                                value={searchQuery}\r\n                                onChange={(e) => setSearchQuery(e.target.value)}\r\n                                placeholder=\"Search by name or SKU...\"\r\n                                className=\"w-full pl-12 pr-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                            />\r\n                        </div>\r\n\r\n                        {/* Category Filter */}\r\n                        <select\r\n                            value={categoryFilter}\r\n                            onChange={(e) => setCategoryFilter(e.target.value)}\r\n                            className=\"px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full lg:w-auto bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                        >\r\n                            {categories.map(cat => (\r\n                                <option key={cat} value={cat}>{cat}</option>\r\n                            ))}\r\n                        </select>\r\n\r\n                        {/* Sub-Category Filter (Placeholder) */}\r\n                        <select\r\n                            className=\"px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full lg:w-auto bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                        >\r\n                            <option>All Sub-Categories</option>\r\n                        </select>\r\n\r\n                        {/* Action Buttons */}\r\n                        <div className=\"flex flex-wrap items-center gap-2 w-full lg:w-auto\">\r\n                            <button\r\n                                onClick={() => setShowCategoryModal(true)}\r\n                                className=\"flex items-center space-x-2 px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-gray-700 dark:text-gray-300\"\r\n                            >\r\n                                <FolderTree className=\"w-4 h-4\" />\r\n                                <span className=\"text-sm font-medium\">Manage Categories</span>\r\n                            </button>\r\n\r\n                            <button className=\"flex items-center space-x-2 px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-gray-700 dark:text-gray-300\">\r\n                                <Upload className=\"w-4 h-4\" />\r\n                                <span className=\"text-sm font-medium\">Import CSV</span>\r\n                            </button>\r\n\r\n                            <button\r\n                                onClick={handleExport}\r\n                                className=\"flex items-center space-x-2 px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-gray-700 dark:text-gray-300\"\r\n                            >\r\n                                <Download className=\"w-4 h-4\" />\r\n                                <span className=\"text-sm font-medium\">Export CSV</span>\r\n                            </button>\r\n\r\n                            <button\r\n                                onClick={handleAdd}\r\n                                className=\"flex items-center space-x-2 px-4 py-2.5 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors\"\r\n                            >\r\n                                <Plus className=\"w-4 h-4\" />\r\n                                <span className=\"text-sm font-medium\">Add Product</span>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Products Table */}\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden border border-gray-100 dark:border-gray-700\">\r\n                    {loading ? (\r\n                        <div className=\"text-center py-12\">\r\n                            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto\"></div>\r\n                        </div>\r\n                    ) : filteredProducts.length === 0 ? (\r\n                        <div className=\"text-center py-16 text-gray-500 dark:text-gray-400\">\r\n                            <Package className=\"w-16 h-16 mx-auto mb-4 opacity-50\" />\r\n                            <p className=\"text-lg\">No products found. Add your first product to get started.</p>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"overflow-x-auto\">\r\n                            <table className=\"w-full\">\r\n                                <thead className=\"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-700\">\r\n                                    <tr>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                                            Image\r\n                                        </th>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                                            Product Name\r\n                                        </th>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                                            SKU\r\n                                        </th>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                                            Category\r\n                                        </th>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                                            Sub-Category\r\n                                        </th>\r\n                                        <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                                            Selling Price\r\n                                        </th>\r\n                                        {isAdmin() && !isClientView && (\r\n                                            <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                                                Cost Price\r\n                                            </th>\r\n                                        )}\r\n                                        <th className=\"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                                            Stock\r\n                                        </th>\r\n                                        <th className=\"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                                            Actions\r\n                                        </th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody className=\"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700\">\r\n                                    {filteredProducts.map((product) => (\r\n                                        <tr key={product._id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors\">\r\n                                            <td className=\"px-6 py-4\">\r\n                                                {product.image ? (\r\n                                                    <img\r\n                                                        src={product.image}\r\n                                                        alt={product.name}\r\n                                                        className=\"w-12 h-12 rounded-lg object-cover border border-gray-200 dark:border-gray-600\"\r\n                                                    />\r\n                                                ) : (\r\n                                                    <div className=\"w-12 h-12 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center\">\r\n                                                        <Package className=\"w-6 h-6 text-gray-400 dark:text-gray-500\" />\r\n                                                    </div>\r\n                                                )}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4\">\r\n                                                <div>\r\n                                                    <p className=\"font-medium text-gray-900 dark:text-white\">{product.name}</p>\r\n                                                    {product.imei1 && (\r\n                                                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">IMEI: {product.imei1}</p>\r\n                                                    )}\r\n                                                    {product.serialNumber && (\r\n                                                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">S/N: {product.serialNumber}</p>\r\n                                                    )}\r\n                                                </div>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-sm text-gray-600 dark:text-gray-400\">\r\n                                                {product.sku || '-'}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-sm text-gray-900 dark:text-white\">\r\n                                                {product.category}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-sm text-gray-600 dark:text-gray-400\">\r\n                                                -\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-right text-sm font-semibold text-gray-900 dark:text-white rupee\">\r\n                                                {formatINR(product.sellingPrice)}\r\n                                            </td>\r\n                                            {isAdmin() && !isClientView && (\r\n                                                <td className=\"px-6 py-4 text-right text-sm text-gray-600 dark:text-gray-400 rupee\">\r\n                                                    {formatINR(product.costPrice)}\r\n                                                </td>\r\n                                            )}\r\n                                            <td className=\"px-6 py-4 text-center\">\r\n                                                <span className={`inline-block px-3 py-1 rounded-full text-sm font-semibold ${getStockColor(product.stock)}`}>\r\n                                                    {product.stock}\r\n                                                </span>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-center\">\r\n                                                <div className=\"flex items-center justify-center space-x-2\">\r\n                                                    <button\r\n                                                        onClick={() => handleEdit(product)}\r\n                                                        className=\"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors\"\r\n                                                        title=\"Edit\"\r\n                                                    >\r\n                                                        <Edit2 className=\"w-4 h-4\" />\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={() => handleDeleteClick(product)}\r\n                                                        className=\"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors\"\r\n                                                        title=\"Delete\"\r\n                                                    >\r\n                                                        <Trash2 className=\"w-4 h-4\" />\r\n                                                    </button>\r\n                                                </div>\r\n                                            </td>\r\n                                        </tr>\r\n                                    ))}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Add/Edit Product Modal */}\r\n            {showModal && (\r\n                <ProductModal\r\n                    product={editingProduct}\r\n                    onClose={() => {\r\n                        setShowModal(false);\r\n                        setEditingProduct(null);\r\n                    }}\r\n                    onSuccess={() => {\r\n                        setShowModal(false);\r\n                        setEditingProduct(null);\r\n                        loadProducts();\r\n                    }}\r\n                />\r\n            )}\r\n\r\n            {/* Category Management Modal */}\r\n            {showCategoryModal && (\r\n                <CategoryManagementModal\r\n                    onClose={() => {\r\n                        setShowCategoryModal(false);\r\n                        loadCategories();\r\n                    }}\r\n                />\r\n            )}\r\n\r\n            {/* Delete Confirmation Modal */}\r\n            <ConfirmationModal\r\n                isOpen={showDeleteModal}\r\n                onClose={() => {\r\n                    setShowDeleteModal(false);\r\n                    setProductToDelete(null);\r\n                }}\r\n                onConfirm={confirmDelete}\r\n                title=\"Delete Product\"\r\n                message={`Are you sure you want to delete \"${productToDelete?.name}\"? This action cannot be undone.`}\r\n                confirmText=\"Delete Product\"\r\n                isDangerous={true}\r\n            />\r\n        </Layout>\r\n    );\r\n};\r\n\r\n// Product Modal Component\r\nconst ProductModal = ({ product, onClose, onSuccess }) => {\r\n    const [formData, setFormData] = useState({\r\n        name: product?.name || '',\r\n        sku: product?.sku || '',\r\n        category: product?.category || '',\r\n        subCategory: product?.subCategory || '',\r\n        costPrice: product?.costPrice || '',\r\n        margin: product?.margin || '',\r\n        sellingPrice: product?.sellingPrice || '',\r\n        stock: product?.stock || '',\r\n        minStockAlert: product?.minStockAlert || 5, // Default 5\r\n        gstPercent: product?.gstPercent || 18,\r\n        imei1: product?.imei1 || '',\r\n        imei2: product?.imei2 || '',\r\n        serialNumber: product?.serialNumber || '',\r\n        image: product?.image || '',\r\n    });\r\n\r\n    const [categories, setCategories] = useState([]);\r\n    const [subCategories, setSubCategories] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Load categories on mount\r\n    useEffect(() => {\r\n        const fetchCategories = async () => {\r\n            try {\r\n                const { data } = await api.get('/categories?parent=null');\r\n                setCategories(data);\r\n            } catch (error) {\r\n                console.error('Failed to load categories');\r\n            }\r\n        };\r\n        fetchCategories();\r\n    }, []);\r\n\r\n    // Load sub-categories when category changes\r\n    useEffect(() => {\r\n        const fetchSubCategories = async () => {\r\n            if (!formData.category) {\r\n                setSubCategories([]);\r\n                return;\r\n            }\r\n\r\n            // Find category ID\r\n            const selectedCat = categories.find(c => c.name === formData.category);\r\n            if (!selectedCat) return;\r\n\r\n            try {\r\n                const { data } = await api.get(`/categories/${selectedCat._id}`);\r\n                setSubCategories(data.subCategories || []);\r\n            } catch (error) {\r\n                console.error('Failed to load sub-categories');\r\n            }\r\n        };\r\n        fetchSubCategories();\r\n    }, [formData.category, categories]);\r\n\r\n    // Auto-calculate logic\r\n    useEffect(() => {\r\n        if (formData.costPrice && formData.margin) {\r\n            const cp = parseFloat(formData.costPrice);\r\n            const margin = parseFloat(formData.margin);\r\n            const sp = cp + (cp * margin / 100);\r\n            setFormData(prev => ({ ...prev, sellingPrice: sp.toFixed(2) }));\r\n        }\r\n    }, [formData.costPrice, formData.margin]);\r\n\r\n    const handleSellingPriceChange = (e) => {\r\n        const sp = parseFloat(e.target.value);\r\n        setFormData(prev => ({ ...prev, sellingPrice: e.target.value }));\r\n\r\n        if (formData.costPrice && sp) {\r\n            const cp = parseFloat(formData.costPrice);\r\n            const margin = ((sp - cp) / cp) * 100;\r\n            setFormData(prev => ({ ...prev, margin: margin.toFixed(2) }));\r\n        }\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n\r\n        try {\r\n            if (product) {\r\n                await api.put(`/products/${product._id}`, formData);\r\n                toast.success('Product updated successfully');\r\n            } else {\r\n                await api.post('/products', formData);\r\n                toast.success('Product added successfully');\r\n            }\r\n            onSuccess();\r\n        } catch (error) {\r\n            toast.error(error.response?.data?.message || 'Failed to save product');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleImageUpload = (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n\r\n        // Check file size (max 5MB)\r\n        if (file.size > 5 * 1024 * 1024) {\r\n            toast.error('Image size should be less than 5MB');\r\n            return;\r\n        }\r\n\r\n        const reader = new FileReader();\r\n        reader.onloadend = () => {\r\n            setFormData({ ...formData, image: reader.result });\r\n        };\r\n        reader.readAsDataURL(file);\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 backdrop-blur-sm\">\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto border border-gray-100 dark:border-gray-700\">\r\n                <div className=\"px-8 py-6 border-b border-gray-100 dark:border-gray-700 flex items-center justify-between sticky top-0 bg-white dark:bg-gray-800 z-10\">\r\n                    <div>\r\n                        <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n                            {product ? 'Edit Product' : 'Add New Product'}\r\n                        </h2>\r\n                        <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                            Fill in the product details to add it to your inventory.\r\n                        </p>\r\n                    </div>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors text-gray-400 hover:text-gray-600 dark:hover:text-gray-200\"\r\n                    >\r\n                        <X className=\"w-6 h-6\" />\r\n                    </button>\r\n                </div>\r\n\r\n                <form onSubmit={handleSubmit} className=\"p-8 space-y-6\">\r\n                    {/* Basic Details */}\r\n                    <div className=\"space-y-4\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1.5\">Product Name</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                value={formData.name}\r\n                                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                                className=\"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-gray-900 dark:focus:ring-gray-400 focus:border-transparent transition-all outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                placeholder=\"Enter product name\"\r\n                                required\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1.5\">SKU</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={formData.sku}\r\n                                    onChange={(e) => setFormData({ ...formData, sku: e.target.value })}\r\n                                    className=\"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-gray-900 dark:focus:ring-gray-400 focus:border-transparent transition-all outline-none bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                    placeholder=\"Auto-generated if empty\"\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1.5\">Category</label>\r\n                                <select\r\n                                    value={formData.category}\r\n                                    onChange={(e) => setFormData({ ...formData, category: e.target.value, subCategory: '' })}\r\n                                    className=\"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-gray-900 dark:focus:ring-gray-400 focus:border-transparent transition-all outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                                    required\r\n                                >\r\n                                    <option value=\"\">Select category</option>\r\n                                    {categories.map(cat => (\r\n                                        <option key={cat._id} value={cat.name}>{cat.name}</option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1.5\">Sub-Category</label>\r\n                                <select\r\n                                    value={formData.subCategory}\r\n                                    onChange={(e) => setFormData({ ...formData, subCategory: e.target.value })}\r\n                                    className={`w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-gray-900 dark:focus:ring-gray-400 focus:border-transparent transition-all outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white ${!formData.category ? 'opacity-50 cursor-not-allowed' : ''}`}\r\n                                    disabled={!formData.category}\r\n                                >\r\n                                    <option value=\"\">Select sub-category</option>\r\n                                    {subCategories.map(sub => (\r\n                                        <option key={sub._id} value={sub.name}>{sub.name}</option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1.5\">Cost Price ()</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={formData.costPrice}\r\n                                    onChange={(e) => setFormData({ ...formData, costPrice: e.target.value })}\r\n                                    className=\"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-gray-900 dark:focus:ring-gray-400 focus:border-transparent transition-all outline-none bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                    placeholder=\"Enter cost price\"\r\n                                    required\r\n                                    min=\"0\"\r\n                                    step=\"0.01\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1.5\">Margin (%)</label>\r\n                                <div className=\"relative\">\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        value={formData.margin}\r\n                                        onChange={(e) => setFormData({ ...formData, margin: e.target.value })}\r\n                                        className=\"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-gray-900 dark:focus:ring-gray-400 focus:border-transparent transition-all outline-none bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                        placeholder=\"e.g., 20\"\r\n                                        step=\"0.1\"\r\n                                    />\r\n                                    <span className=\"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-500 font-medium\">%</span>\r\n                                </div>\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1.5\">Selling Price ()</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={formData.sellingPrice}\r\n                                    onChange={handleSellingPriceChange}\r\n                                    className=\"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-gray-900 dark:focus:ring-gray-400 focus:border-transparent transition-all outline-none bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                    placeholder=\"Calculated automatically\"\r\n                                    required\r\n                                    min=\"0\"\r\n                                    step=\"0.01\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1.5\">Current Stock</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={formData.stock}\r\n                                    onChange={(e) => setFormData({ ...formData, stock: e.target.value })}\r\n                                    className=\"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-gray-900 dark:focus:ring-gray-400 focus:border-transparent transition-all outline-none bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                                    required\r\n                                    min=\"0\"\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1.5\">Min Stock Alert Level</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={formData.minStockAlert}\r\n                                    onChange={(e) => setFormData({ ...formData, minStockAlert: e.target.value })}\r\n                                    className=\"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-gray-900 dark:focus:ring-gray-400 focus:border-transparent transition-all outline-none bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                                    min=\"0\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1.5\">GST Rate (%)</label>\r\n                                <select\r\n                                    value={formData.gstPercent}\r\n                                    onChange={(e) => setFormData({ ...formData, gstPercent: e.target.value })}\r\n                                    className=\"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-gray-900 dark:focus:ring-gray-400 focus:border-transparent transition-all outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                                >\r\n                                    <option value={0}>0% (Nil Rated)</option>\r\n                                    <option value={5}>5%</option>\r\n                                    <option value={12}>12%</option>\r\n                                    <option value={18}>18% (Standard)</option>\r\n                                    <option value={28}>28% (Luxury)</option>\r\n                                </select>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Category Specific Fields */}\r\n                        {formData.category === 'Phone' && (\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl border border-gray-200 dark:border-gray-700\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1.5\">IMEI 1</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={formData.imei1}\r\n                                        onChange={(e) => setFormData({ ...formData, imei1: e.target.value })}\r\n                                        className=\"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-gray-900 dark:focus:ring-gray-400 focus:border-transparent transition-all outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                        placeholder=\"Enter IMEI 1\"\r\n                                    />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1.5\">IMEI 2</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={formData.imei2}\r\n                                        onChange={(e) => setFormData({ ...formData, imei2: e.target.value })}\r\n                                        className=\"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-gray-900 dark:focus:ring-gray-400 focus:border-transparent transition-all outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                        placeholder=\"Enter IMEI 2\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {(formData.category === 'Watch' || formData.category === 'Audio') && (\r\n                            <div className=\"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl border border-gray-200 dark:border-gray-700\">\r\n                                <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1.5\">Serial Number</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={formData.serialNumber}\r\n                                    onChange={(e) => setFormData({ ...formData, serialNumber: e.target.value })}\r\n                                    className=\"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-gray-900 dark:focus:ring-gray-400 focus:border-transparent transition-all outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                    placeholder=\"Enter Serial Number\"\r\n                                />\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Image Upload */}\r\n                        <div>\r\n                            <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2\">Product Image (Optional)</label>\r\n                            <div className=\"flex items-center gap-4\">\r\n                                <div className={`w-24 h-24 rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center overflow-hidden bg-gray-50 dark:bg-gray-700 ${!formData.image ? 'p-4' : ''}`}>\r\n                                    {formData.image ? (\r\n                                        <div className=\"relative w-full h-full group\">\r\n                                            <img src={formData.image} alt=\"Preview\" className=\"w-full h-full object-cover\" />\r\n                                            <button\r\n                                                type=\"button\"\r\n                                                onClick={() => setFormData({ ...formData, image: '' })}\r\n                                                className=\"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 shadow-md opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                                                title=\"Remove Image\"\r\n                                            >\r\n                                                <X className=\"w-3 h-3\" />\r\n                                            </button>\r\n                                        </div>\r\n                                    ) : (\r\n                                        <div className=\"text-gray-400 dark:text-gray-500\">\r\n                                            <svg className=\"w-8 h-8 mx-auto\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\r\n                                            </svg>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"cursor-pointer bg-blue-600 hover:bg-blue-700 text-white px-4 py-2.5 rounded-lg font-medium transition-colors inline-flex items-center gap-2\">\r\n                                        <Upload className=\"w-4 h-4\" />\r\n                                        <span>Upload Image</span>\r\n                                        <input\r\n                                            type=\"file\"\r\n                                            onChange={handleImageUpload}\r\n                                            accept=\"image/*\"\r\n                                            className=\"hidden\"\r\n                                        />\r\n                                    </label>\r\n                                    <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n                                        PNG, JPG, WEBP (max 5MB)<br />\r\n                                        Auto-compressed to &lt;50KB for storage\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Footer Actions */}\r\n                    <div className=\"flex items-center justify-end space-x-4 pt-6 mt-6 border-t border-gray-100 dark:border-gray-700\">\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={onClose}\r\n                            className=\"px-6 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\"\r\n                        >\r\n                            Cancel\r\n                        </button>\r\n                        <button\r\n                            type=\"submit\"\r\n                            disabled={loading}\r\n                            className=\"px-6 py-2.5 bg-gray-900 text-white rounded-lg font-medium hover:bg-gray-800 transition-colors disabled:opacity-50 flex items-center gap-2\"\r\n                        >\r\n                            {loading ? (\r\n                                <>\r\n                                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\"></div>\r\n                                    <span>Saving...</span>\r\n                                </>\r\n                            ) : (\r\n                                <span>{product ? 'Update Product' : 'Create Product'}</span>\r\n                            )}\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Inventory;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\pages\\InvoiceCreator.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":330,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":330,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"_"},"fix":{"range":[12272,12273],"text":""},"desc":"Remove unused variable '_'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'data' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":343,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":343,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"data"},"fix":{"range":[12807,12868],"text":""},"desc":"Remove unused variable 'data'."}]},{"ruleId":"no-constant-condition","severity":2,"message":"Unexpected constant condition.","line":939,"column":34,"nodeType":"Literal","messageId":"unexpected","endLine":939,"endColumn":39}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport ErrorBoundary from '../components/ErrorBoundary';\r\nimport Layout from '../components/Layout/Layout';\r\nimport api from '../utils/api';\r\nimport { formatINR } from '../utils/currency';\r\nimport { calculateLineTotal, calculateInvoiceSummary } from '../utils/gstCalculator';\r\nimport { useSettings } from '../context/SettingsContext';\r\nimport {\r\n    Search,\r\n    Plus,\r\n    Trash2,\r\n    Calendar,\r\n    User,\r\n    ChevronDown,\r\n    ChevronUp,\r\n    Store,\r\n    Save,\r\n    Printer,\r\n    Share2\r\n} from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\nimport { QRCodeSVG } from 'qrcode.react';\r\n\r\nconst InvoiceCreator = () => {\r\n    const navigate = useNavigate();\r\n    const { settings, loading: settingsLoading } = useSettings();\r\n    console.log('InvoiceCreator Render/Settings:', { settings, loading: settingsLoading });\r\n    const [loading, setLoading] = useState(false);\r\n\r\n\r\n\r\n\r\n\r\n    // Data Sources\r\n    const [products, setProducts] = useState([]);\r\n    const [customers, setCustomers] = useState([]);\r\n\r\n    // Fetch Data on Mount (Fix for Search)\r\n    useEffect(() => {\r\n        const fetchData = async () => {\r\n            try {\r\n                const [productsRes, customersRes] = await Promise.all([\r\n                    api.get('/products'),\r\n                    api.get('/customers')\r\n                ]);\r\n                setProducts(productsRes.data);\r\n                setCustomers(customersRes.data);\r\n            } catch (error) {\r\n                console.error('Failed to fetch data:', error);\r\n                toast.error('Failed to load products or customers');\r\n            }\r\n        };\r\n        fetchData();\r\n    }, []);\r\n\r\n    // UI State\r\n    const [showProductSearch, setShowProductSearch] = useState(false);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [filteredProducts, setFilteredProducts] = useState([]);\r\n    const [showCompanyDetails, setShowCompanyDetails] = useState(true);\r\n    const [sellerDetails, setSellerDetails] = useState({\r\n        storeName: '',\r\n        tagline: '',\r\n        address: '',\r\n        phone: '',\r\n        email: '',\r\n        gstin: '',\r\n        bankDetails: '',\r\n        upiId: '',\r\n        website: '',\r\n        termsAndConditions: '',\r\n        authSignLabel: '',\r\n        footerFontSize: 12,\r\n        footerFontFamily: 'sans-serif',\r\n        footerAlignment: 'center'\r\n    });\r\n\r\n    const [items, setItems] = useState([]);\r\n    const [invoiceSettings, setInvoiceSettings] = useState({\r\n        title: 'Tax Invoice',\r\n        invoiceNo: 'New',\r\n        date: new Date().toLocaleDateString('en-CA') // YYYY-MM-DD in local time\r\n    });\r\n    const [customerInfo, setCustomerInfo] = useState({\r\n        name: '',\r\n        phone: '',\r\n        email: '',\r\n        gstin: '',\r\n        address: '',\r\n        notes: ''\r\n    });\r\n    const [newItemConfig, setNewItemConfig] = useState({\r\n        selectedProduct: null,\r\n        qty: 1\r\n    });\r\n    const [payment, setPayment] = useState({\r\n        cash: '',\r\n        upi: '',\r\n        card: '',\r\n        bank: ''\r\n    });\r\n\r\n    // Initialize Seller Details from Settings\r\n    useEffect(() => {\r\n        if (settings) {\r\n            setSellerDetails({\r\n                storeName: settings.storeName || settings.shopName || '',\r\n                tagline: '', // Manually entered\r\n                address: settings.address || '',\r\n                phone: settings.phone || '',\r\n                email: settings.email || '',\r\n                gstin: settings.gstin || settings.gstNumber || '',\r\n                bankDetails: (settings.bankName && settings.accountNumber)\r\n                    ? `${settings.bankName}, A/c: ${settings.accountNumber}, IFSC: ${settings.ifscCode}`\r\n                    : '',\r\n                upiId: settings.upi || settings.upiId || '',\r\n                website: settings.website || '',\r\n                termsAndConditions: settings.termsAndConditions || '',\r\n                invoiceFooterText: settings.invoiceFooterText || '',\r\n                authSignLabel: settings.authSignLabel || 'Authorized Signatory',\r\n                footerFontSize: settings.footerFontSize || 12,\r\n                footerFontFamily: settings.footerFontFamily || 'sans-serif',\r\n                footerAlignment: settings.footerAlignment || 'center'\r\n            });\r\n        }\r\n    }, [settings]);\r\n\r\n    // Product Search Logic\r\n    useEffect(() => {\r\n        if (searchQuery) {\r\n            const lower = searchQuery.toLowerCase();\r\n            const filtered = products.filter(p =>\r\n                p.name.toLowerCase().includes(lower) ||\r\n                p.category.toLowerCase().includes(lower) ||\r\n                p.sku?.toLowerCase().includes(lower)\r\n            );\r\n            setFilteredProducts(filtered);\r\n            setShowProductSearch(true);\r\n        } else {\r\n            setFilteredProducts([]);\r\n            setShowProductSearch(false);\r\n        }\r\n    }, [searchQuery, products]);\r\n\r\n    // Customer Selection\r\n    const handleCustomerSelect = (customerId) => {\r\n        if (!customerId) return;\r\n        const customer = customers.find(c => c._id === customerId);\r\n        if (customer) {\r\n            setCustomerInfo({\r\n                _id: customer._id,\r\n                name: customer.name,\r\n                phone: customer.phone,\r\n                email: customer.email || '',\r\n                gstin: customer.gstin || '',\r\n                address: customer.address || ''\r\n            });\r\n        }\r\n    };\r\n\r\n    const handlePhoneChange = (e) => {\r\n        const value = e.target.value;\r\n        // Search for exact match by phone\r\n        const found = customers.find(c => c.phone && c.phone.trim() === value.trim());\r\n\r\n        if (found) {\r\n            setCustomerInfo({\r\n                _id: found._id,\r\n                name: found.name,\r\n                phone: found.phone, // Use stored phone to ensure consistency\r\n                email: found.email || '',\r\n                gstin: found.gstin || '',\r\n                address: found.address || '',\r\n                notes: found.notes || ''\r\n            });\r\n            toast.success('Existing customer details loaded');\r\n        } else {\r\n            // Just update the phone number if no match\r\n            setCustomerInfo(prev => ({ ...prev, phone: value }));\r\n        }\r\n    };\r\n\r\n    if (settingsLoading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center min-h-[400px]\">\r\n                <div className=\"text-center text-gray-500\">\r\n                    <div className=\"w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-2\"></div>\r\n                    Loading invoice settings...\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!settings) {\r\n        return (\r\n            <div className=\"flex items-center justify-center min-h-[400px]\">\r\n                <div className=\"text-center text-red-500 p-8 bg-red-50 rounded-lg\">\r\n                    <p className=\"font-semibold mb-2\">Failed to load invoice settings</p>\r\n                    <p className=\"text-sm mb-4\">Please check your connection and try again.</p>\r\n                    <button\r\n                        onClick={() => window.location.reload()}\r\n                        className=\"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700\"\r\n                    >\r\n                        Retry\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Add Item Logic\r\n    const addItem = (product = null, isCustom = false) => {\r\n        const qty = parseInt(newItemConfig.qty) || 1;\r\n\r\n        let newItem;\r\n        if (isCustom) {\r\n            newItem = {\r\n                productId: null,\r\n                name: '',\r\n                isCustom: true,\r\n                showImei: true, // Show fields by default for custom items\r\n                quantity: 1,\r\n                pricePerUnit: 0,\r\n                gstPercent: 0,\r\n                taxableValue: 0,\r\n                gstAmount: 0,\r\n                totalAmount: 0\r\n            };\r\n        } else if (product) {\r\n            // Check if exists\r\n            const existingIndex = items.findIndex(i => i.productId === product._id);\r\n            if (existingIndex >= 0) {\r\n                toast.success('Product already added. Adjusted quantity.');\r\n                updateItem(existingIndex, 'quantity', items[existingIndex].quantity + qty);\r\n                setSearchQuery('');\r\n                return;\r\n            }\r\n\r\n            newItem = {\r\n                productId: product._id,\r\n                name: product.name,\r\n                category: product.category, // Store category for IMEI check\r\n                showImei: false, // Default to hidden for inventory unless auto-detected\r\n                imei: '', // Init IMEI 1\r\n                imei2: '', // Init IMEI 2\r\n                serialNumber: '', // Init Serial\r\n                isCustom: false,\r\n                quantity: qty,\r\n                pricePerUnit: product.sellingPrice,\r\n                gstPercent: product.gstPercent,\r\n                ...calculateLineTotal(qty, product.sellingPrice, product.gstPercent, true)\r\n            };\r\n        }\r\n\r\n        if (newItem) {\r\n            setItems([...items, newItem]);\r\n            setSearchQuery('');\r\n            setNewItemConfig({ selectedProduct: null, qty: 1 });\r\n            if (!isCustom) setShowProductSearch(false);\r\n        }\r\n    };\r\n\r\n    // Update Item\r\n    const updateItem = (index, field, value) => {\r\n        const updatedItems = [...items];\r\n        const item = { ...updatedItems[index] };\r\n\r\n        if (field === 'quantity') item.quantity = parseFloat(value) || 0;\r\n        if (field === 'pricePerUnit') item.pricePerUnit = parseFloat(value) || 0;\r\n        if (field === 'gstPercent') item.gstPercent = parseFloat(value) || 0;\r\n        if (field === 'name') item.name = value;\r\n        if (field === 'imei') item.imei = value;\r\n        if (field === 'imei2') item.imei2 = value;\r\n        if (field === 'serialNumber') item.serialNumber = value;\r\n        if (field === 'showImei') item.showImei = value;\r\n\r\n        // Recalculate\r\n        const totals = calculateLineTotal(\r\n            item.quantity,\r\n            item.pricePerUnit,\r\n            item.gstPercent,\r\n            true // Inclusive tax calculation preferred for retail\r\n        );\r\n\r\n        updatedItems[index] = { ...item, ...totals };\r\n        setItems(updatedItems);\r\n    };\r\n\r\n    const removeItem = (index) => {\r\n        setItems(items.filter((_, i) => i !== index));\r\n    };\r\n\r\n    // Calculations\r\n    const summary = calculateInvoiceSummary(items);\r\n    const totalPaid = Object.values(payment).reduce((sum, val) => sum + (parseFloat(val) || 0), 0);\r\n    const balanceDue = summary.grandTotal - totalPaid;\r\n    const isFullyPaid = balanceDue <= 0.5; // Tolerance for float\r\n\r\n    // Submit\r\n    const handleSubmit = async () => {\r\n        if (items.length === 0) {\r\n            toast.error('Add items to invoice first');\r\n            return;\r\n        }\r\n\r\n        if (!customerInfo.name) {\r\n            toast.error('Customer name is required');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setLoading(true);\r\n            const invoicePayload = {\r\n                customerId: customerInfo._id || undefined, // FIXED: was 'customer', backend expects 'customerId'\r\n                invoiceType: invoiceSettings.title,\r\n                invoiceDate: invoiceSettings.date,\r\n                items: items.map(item => ({\r\n                    productId: item.productId, // FIXED: was 'product', backend expects 'productId'\r\n                    itemName: item.name,\r\n                    quantity: item.quantity,\r\n                    pricePerUnit: item.pricePerUnit,\r\n                    gstPercent: item.gstPercent,\r\n                    isTaxInclusive: true, // All items are tax-inclusive in this UI\r\n                    imei: item.imei, // Include IMEI 1\r\n                    imei2: item.imei2, // Include IMEI 2\r\n                    serialNumber: item.serialNumber // Include Serial\r\n                })),\r\n                payments: Object.entries(payment)\r\n                    .filter(([_, amount]) => amount > 0)\r\n                    .map(([mode, amount]) => ({\r\n                        method: mode.charAt(0).toUpperCase() + mode.slice(1),\r\n                        amount\r\n                    })),\r\n                customerName: customerInfo.name,\r\n                customerPhone: customerInfo.phone,\r\n                customerAddress: customerInfo.address,\r\n                customerGstin: customerInfo.gstin,\r\n                sellerDetails,\r\n                notes: customerInfo.notes || ''\r\n            };\r\n\r\n            const { data } = await api.post('/invoices', invoicePayload);\r\n            toast.success('Invoice Created Successfully!');\r\n            navigate('/invoices');\r\n\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error(error.response?.data?.message || 'Failed to create invoice');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Layout>\r\n            <div className=\"p-6 max-w-[1600px] mx-auto\">\r\n                <div className=\"mb-6\">\r\n                    <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">Create New Invoice</h1>\r\n                    <p className=\"text-gray-600 dark:text-gray-400\">Generate a fully customizable invoice</p>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-6\">\r\n                    {/* LEFT SIDEBAR (3 cols) */}\r\n                    <div className=\"lg:col-span-3 space-y-6\">\r\n\r\n                        {/* Invoice Settings */}\r\n                        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-5\">\r\n                            <h3 className=\"font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2\">\r\n                                <Printer className=\"w-4 h-4 text-blue-600 dark:text-blue-400\" />\r\n                                Invoice Settings\r\n                            </h3>\r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1\">Invoice Title</label>\r\n                                    <select\r\n                                        value={invoiceSettings.title}\r\n                                        onChange={(e) => setInvoiceSettings({ ...invoiceSettings, title: e.target.value })}\r\n                                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                                    >\r\n                                        <option value=\"Tax Invoice\">TAX INVOICE</option>\r\n                                        <option value=\"Bill of Supply\">BILL OF SUPPLY</option>\r\n                                        <option value=\"Estimate\">ESTIMATE / QUOTATION</option>\r\n                                    </select>\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1\">Invoice Date</label>\r\n                                    <input\r\n                                        type=\"date\"\r\n                                        value={invoiceSettings.date}\r\n                                        onChange={(e) => setInvoiceSettings({ ...invoiceSettings, date: e.target.value })}\r\n                                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                                    />\r\n                                    <p className=\"text-[10px] text-gray-400 mt-1\">Supports backdating</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Customer Information */}\r\n                        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-5\">\r\n                            <h3 className=\"font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2\">\r\n                                <User className=\"w-4 h-4 text-blue-600 dark:text-blue-400\" />\r\n                                Customer Information\r\n                            </h3>\r\n\r\n                            {/* Search Existing */}\r\n                            <div className=\"mb-4 relative\">\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"Search existing customer...\"\r\n                                    className=\"w-full pl-9 pr-3 py-2 border border-blue-100 dark:border-gray-600 bg-blue-50 dark:bg-gray-700 rounded-lg text-sm focus:bg-white dark:focus:bg-gray-600 text-gray-900 dark:text-white transition-colors placeholder-gray-500 hover:bg-white dark:hover:bg-gray-600\"\r\n                                    onChange={(e) => {\r\n                                        const found = customers.find(c => c.name.toLowerCase().includes(e.target.value.toLowerCase()) || c.phone.includes(e.target.value));\r\n                                        if (found) handleCustomerSelect(found._id);\r\n                                    }}\r\n                                />\r\n                                <Search className=\"w-4 h-4 text-blue-400 absolute left-3 top-2.5\" />\r\n                            </div>\r\n\r\n                            <div className=\"space-y-3\">\r\n                                <div>\r\n                                    <label className=\"block text-xs font-medium text-gray-500 dark:text-gray-300 mb-1\">Customer Name *</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={customerInfo.name}\r\n                                        onChange={(e) => setCustomerInfo({ ...customerInfo, name: e.target.value })}\r\n                                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                        placeholder=\"Enter customer name\"\r\n                                    />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-xs font-medium text-gray-500 dark:text-gray-300 mb-1\">Mobile Number</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={customerInfo.phone}\r\n                                        onChange={handlePhoneChange}\r\n                                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                        placeholder=\"+91 98765 43210\"\r\n                                    />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-xs font-medium text-gray-500 dark:text-gray-300 mb-1\">Email</label>\r\n                                    <input\r\n                                        type=\"email\"\r\n                                        value={customerInfo.email}\r\n                                        onChange={(e) => setCustomerInfo({ ...customerInfo, email: e.target.value })}\r\n                                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                        placeholder=\"customer@email.com\"\r\n                                    />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-xs font-medium text-gray-500 dark:text-gray-300 mb-1\">GSTIN</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={customerInfo.gstin}\r\n                                        onChange={(e) => setCustomerInfo({ ...customerInfo, gstin: e.target.value })}\r\n                                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                        placeholder=\"GSTIN (Optional)\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Company Details */}\r\n                        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden\">\r\n                            <button\r\n                                onClick={() => setShowCompanyDetails(!showCompanyDetails)}\r\n                                className=\"w-full p-4 flex items-center justify-between bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors\"\r\n                            >\r\n                                <span className=\"font-semibold text-gray-800 dark:text-gray-200 flex items-center gap-2\">\r\n                                    <Store className=\"w-4 h-4 text-gray-600 dark:text-gray-400\" />\r\n                                    Company Details\r\n                                </span>\r\n                                {showCompanyDetails ? <ChevronUp className=\"w-4 h-4 text-gray-600 dark:text-gray-400\" /> : <ChevronDown className=\"w-4 h-4 text-gray-600 dark:text-gray-400\" />}\r\n                            </button>\r\n\r\n                            {showCompanyDetails && (\r\n                                <div className=\"p-5 border-t border-gray-100 dark:border-gray-700 flex flex-col gap-3\">\r\n                                    <p className=\"text-[10px] text-gray-500 italic\">These details are pre-filled from Store Settings. Edit here for this invoice only.</p>\r\n\r\n                                    <div>\r\n                                        <label className=\"block text-[10px] uppercase font-bold text-gray-500 dark:text-gray-400 mb-1\">Company Name</label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={sellerDetails.storeName}\r\n                                            onChange={(e) => setSellerDetails({ ...sellerDetails, storeName: e.target.value })}\r\n                                            className=\"w-full text-sm font-bold text-gray-900 dark:text-white border-none border-b border-gray-200 dark:border-gray-700 focus:border-blue-500 focus:ring-0 px-0 py-1 bg-transparent placeholder-gray-400\"\r\n                                            placeholder=\"Your Business Name\"\r\n                                        />\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                        <label className=\"block text-[10px] uppercase font-bold text-gray-500 dark:text-gray-400 mb-1\">Tagline</label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={sellerDetails.tagline}\r\n                                            onChange={(e) => setSellerDetails({ ...sellerDetails, tagline: e.target.value })}\r\n                                            className=\"w-full text-xs text-gray-600 dark:text-gray-300 border-none border-b border-gray-200 dark:border-gray-700 focus:border-blue-500 focus:ring-0 px-0 py-1 bg-transparent placeholder-gray-400\"\r\n                                            placeholder=\"e.g., Best Deals In Tech\"\r\n                                        />\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                        <label className=\"block text-[10px] uppercase font-bold text-gray-500 dark:text-gray-400 mb-1\">Address</label>\r\n                                        <textarea\r\n                                            value={sellerDetails.address}\r\n                                            onChange={(e) => setSellerDetails({ ...sellerDetails, address: e.target.value })}\r\n                                            className=\"w-full text-xs text-gray-600 dark:text-gray-300 border border-gray-200 dark:border-gray-700 rounded p-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 bg-white dark:bg-gray-700 placeholder-gray-400\"\r\n                                            rows=\"2\"\r\n                                            placeholder=\"Shop address...\"\r\n                                        />\r\n                                    </div>\r\n\r\n                                    <div className=\"grid grid-cols-2 gap-3\">\r\n                                        <div>\r\n                                            <label className=\"block text-[10px] uppercase font-bold text-gray-500 dark:text-gray-300 mb-1\">Mobile</label>\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                value={sellerDetails.phone}\r\n                                                onChange={(e) => setSellerDetails({ ...sellerDetails, phone: e.target.value })}\r\n                                                className=\"w-full text-xs text-gray-600 dark:text-white border border-gray-200 dark:border-gray-700 rounded px-2 py-1 bg-white dark:bg-gray-700 placeholder-gray-400\"\r\n                                                placeholder=\"+91...\"\r\n                                            />\r\n                                        </div>\r\n                                        <div>\r\n                                            <label className=\"block text-[10px] uppercase font-bold text-gray-500 dark:text-gray-300 mb-1\">Email</label>\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                value={sellerDetails.email}\r\n                                                onChange={(e) => setSellerDetails({ ...sellerDetails, email: e.target.value })}\r\n                                                className=\"w-full text-xs text-gray-600 dark:text-white border border-gray-200 dark:border-gray-700 rounded px-2 py-1 bg-white dark:bg-gray-700 placeholder-gray-400\"\r\n                                                placeholder=\"contact@...\"\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                        <label className=\"block text-[10px] uppercase font-bold text-gray-500 dark:text-gray-300 mb-1\">GSTIN</label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={sellerDetails.gstin}\r\n                                            onChange={(e) => setSellerDetails({ ...sellerDetails, gstin: e.target.value })}\r\n                                            className=\"w-full text-xs text-gray-600 dark:text-white border border-gray-200 dark:border-gray-700 rounded px-2 py-1 bg-white dark:bg-gray-700 placeholder-gray-400\"\r\n                                            placeholder=\"GSTIN\"\r\n                                        />\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                        <label className=\"block text-[10px] uppercase font-bold text-gray-500 dark:text-gray-400 mb-1\">Bank Details</label>\r\n                                        <textarea\r\n                                            value={sellerDetails.bankDetails}\r\n                                            onChange={(e) => setSellerDetails({ ...sellerDetails, bankDetails: e.target.value })}\r\n                                            className=\"w-full text-xs text-gray-600 dark:text-gray-300 border border-gray-200 dark:border-gray-700 rounded p-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 bg-white dark:bg-gray-700 placeholder-gray-400\"\r\n                                            rows=\"2\"\r\n                                            placeholder=\"Bank Name, A/c No, IFSC...\"\r\n                                        />\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                        <label className=\"block text-[10px] uppercase font-bold text-gray-500 dark:text-gray-400 mb-1\">Terms & Conditions</label>\r\n                                        <textarea\r\n                                            value={sellerDetails.termsAndConditions}\r\n                                            onChange={(e) => setSellerDetails({ ...sellerDetails, termsAndConditions: e.target.value })}\r\n                                            className=\"w-full text-xs text-gray-600 dark:text-gray-300 border border-gray-200 dark:border-gray-700 rounded p-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 bg-white dark:bg-gray-700 placeholder-gray-400\"\r\n                                            rows=\"3\"\r\n                                            placeholder=\"Terms...\"\r\n                                        />\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                        <label className=\"block text-[10px] uppercase font-bold text-gray-500 dark:text-gray-400 mb-1\">Footer Note</label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={sellerDetails.invoiceFooterText}\r\n                                            onChange={(e) => setSellerDetails({ ...sellerDetails, invoiceFooterText: e.target.value })}\r\n                                            className=\"w-full text-xs text-gray-600 dark:text-gray-300 border border-gray-200 dark:border-gray-700 rounded px-2 py-1 bg-white dark:bg-gray-700 placeholder-gray-400\"\r\n                                            placeholder=\"Thank you...\"\r\n                                        />\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                        <label className=\"block text-[10px] uppercase font-bold text-gray-500 dark:text-gray-400 mb-1\">Signatory Label</label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={sellerDetails.authSignLabel}\r\n                                            onChange={(e) => setSellerDetails({ ...sellerDetails, authSignLabel: e.target.value })}\r\n                                            className=\"w-full text-xs text-gray-600 dark:text-gray-300 border border-gray-200 dark:border-gray-700 rounded px-2 py-1 bg-white dark:bg-gray-700 placeholder-gray-400\"\r\n                                            placeholder=\"Authorized Signatory\"\r\n                                        />\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                        <label className=\"block text-[10px] uppercase font-bold text-gray-500 dark:text-gray-400 mb-1\">UPI ID (for QR Code)</label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={sellerDetails.upiId}\r\n                                            onChange={(e) => setSellerDetails({ ...sellerDetails, upiId: e.target.value })}\r\n                                            className=\"w-full text-xs text-gray-600 dark:text-gray-300 border border-gray-200 dark:border-gray-700 rounded px-2 py-1 bg-white dark:bg-gray-700 placeholder-gray-400\"\r\n                                            placeholder=\"yourshop@upi\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                    </div>\r\n\r\n                    {/* CENTER CONTENT (6 cols) */}\r\n                    <div className=\"lg:col-span-6 space-y-6\">\r\n\r\n                        {/* Add Products */}\r\n                        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-6\">\r\n                            <h3 className=\"font-semibold text-gray-800 dark:text-gray-200 mb-4\">Add Products</h3>\r\n\r\n                            <div className=\"flex flex-col md:flex-row gap-4 items-end\">\r\n                                <div className=\"flex-1 relative\">\r\n                                    <label className=\"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1\">Select from Inventory</label>\r\n                                    <div className=\"relative\">\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={searchQuery}\r\n                                            onChange={(e) => setSearchQuery(e.target.value)}\r\n                                            placeholder=\"Choose a product...\"\r\n                                            className=\"w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                        />\r\n                                        {showProductSearch && searchQuery && filteredProducts.length > 0 && (\r\n                                            <div className=\"absolute z-20 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl max-h-60 overflow-y-auto\">\r\n                                                {filteredProducts.map(p => (\r\n                                                    <div\r\n                                                        key={p._id}\r\n                                                        onClick={() => addItem(p)}\r\n                                                        className=\"p-3 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer border-b last:border-0 border-gray-100 dark:border-gray-700 flex justify-between items-center\"\r\n                                                    >\r\n                                                        <div>\r\n                                                            <div className=\"font-medium text-gray-900 dark:text-white\">{p.name}</div>\r\n                                                            <div className=\"text-xs text-gray-500 dark:text-gray-400\">Stock: {p.stock} | SKU: {p.sku}</div>\r\n                                                        </div>\r\n                                                        <div className=\"font-semibold text-blue-600 dark:text-blue-400\">{formatINR(p.sellingPrice)}</div>\r\n                                                    </div>\r\n                                                ))}\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"w-24\">\r\n                                    <label className=\"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1\">Qty</label>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        value={newItemConfig.qty}\r\n                                        onChange={(e) => setNewItemConfig({ ...newItemConfig, qty: e.target.value })}\r\n                                        className=\"w-full px-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg text-center text-gray-900 dark:text-white font-semibold bg-white dark:bg-gray-700\"\r\n                                        min=\"1\"\r\n                                    />\r\n                                </div>\r\n                                <button\r\n                                    onClick={() => {\r\n                                        if (filteredProducts.length > 0) addItem(filteredProducts[0]);\r\n                                    }}\r\n                                    className=\"px-6 py-2.5 bg-gray-900 dark:bg-blue-600 text-white rounded-lg hover:bg-gray-800 dark:hover:bg-blue-700 flex items-center gap-2\"\r\n                                >\r\n                                    <Plus className=\"w-4 h-4\" /> Add\r\n                                </button>\r\n                            </div>\r\n\r\n                            <div className=\"mt-4 pt-4 border-t border-gray-100 dark:border-gray-700\">\r\n                                <button\r\n                                    onClick={() => addItem(null, true)}\r\n                                    className=\"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 flex items-center gap-2 font-medium px-3 py-2 border border-dashed border-blue-200 dark:border-blue-800 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors w-full md:w-auto justify-center\"\r\n                                >\r\n                                    <Plus className=\"w-4 h-4\" /> Add Custom Item (Service, Repair, etc.)\r\n                                </button>\r\n                            </div>\r\n\r\n                            {/* Items Table */}\r\n                            <div className=\"mt-6 overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700\">\r\n                                <table className=\"w-full text-sm text-left\">\r\n                                    <thead className=\"bg-gray-50 dark:bg-gray-700/50 text-gray-600 dark:text-gray-300 font-medium\">\r\n                                        <tr>\r\n                                            <th className=\"px-4 py-3 w-10\">#</th>\r\n                                            <th className=\"px-4 py-3 min-w-[200px]\">ITEM NAME</th>\r\n                                            <th className=\"px-4 py-3 w-28 text-center\">QTY</th>\r\n                                            <th className=\"px-4 py-3 w-40 text-right\">RATE ()</th>\r\n                                            <th className=\"px-4 py-3 w-20 text-center\">GST %</th>\r\n                                            <th className=\"px-4 py-3 w-28 text-right\">TAX AMT</th>\r\n                                            <th className=\"px-4 py-3 w-32 text-right\">TOTAL</th>\r\n                                            <th className=\"px-4 py-3 w-10\"></th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody className=\"divide-y divide-gray-100 dark:divide-gray-700\">\r\n                                        {items.length === 0 ? (\r\n                                            <tr>\r\n                                                <td colSpan=\"8\" className=\"px-4 py-8 text-center text-gray-400 dark:text-gray-500\">\r\n                                                    No items added yet.\r\n                                                </td>\r\n                                            </tr>\r\n                                        ) : (\r\n                                            items.map((item, index) => (\r\n                                                <tr key={index} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/30 group transition-colors\">\r\n                                                    <td className=\"px-4 py-3 text-gray-500 dark:text-gray-400\">{index + 1}</td>\r\n                                                    <td className=\"px-4 py-3\">\r\n                                                        <input\r\n                                                            type=\"text\"\r\n                                                            value={item.name}\r\n                                                            onChange={(e) => updateItem(index, 'name', e.target.value)}\r\n                                                            className=\"w-full bg-transparent border-b border-transparent hover:border-gray-300 dark:hover:border-gray-600 focus:border-blue-500 py-2 px-1 focus:ring-0 text-base font-semibold text-gray-900 dark:text-white placeholder-gray-400 transition-colors\"\r\n                                                            placeholder=\"Item Name\"\r\n                                                        />\r\n                                                        {item.isCustom && <span className=\"text-[10px] text-blue-500 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30 px-1.5 py-0.5 rounded ml-2\">Custom</span>}\r\n\r\n                                                        {/* Toggle for IMEI/Serial */}\r\n                                                        {!item.showImei && (\r\n                                                            <button\r\n                                                                onClick={() => updateItem(index, 'showImei', true)}\r\n                                                                className=\"ml-2 text-[10px] text-gray-400 hover:text-blue-500 transition-colors\"\r\n                                                            >\r\n                                                                + Add IMEI/Serial\r\n                                                            </button>\r\n                                                        )}\r\n\r\n                                                        {/* Conditional IMEI Inputs */}\r\n                                                        {(item.showImei || (item.category && ['smartphone', 'keypad phone', 'mobile', 'phone', 'stub', 'cell', 'mi', 'vivo', 'oppo', 'samsung', 'iphone', 'apple', 'android', 'electronics'].some(c => item.category.toLowerCase().includes(c)))) && (\r\n                                                            <div className=\"mt-2 grid grid-cols-2 gap-2 bg-orange-50 dark:bg-gray-700/50 p-2 rounded-lg border border-orange-100 dark:border-gray-600\">\r\n                                                                <div>\r\n                                                                    <input\r\n                                                                        type=\"text\"\r\n                                                                        value={item.imei || ''}\r\n                                                                        onChange={(e) => updateItem(index, 'imei', e.target.value)}\r\n                                                                        className=\"w-full bg-white dark:bg-gray-600 border border-gray-200 dark:border-gray-500 rounded px-2 py-1 text-xs text-center text-gray-700 dark:text-gray-200 placeholder-gray-400 focus:outline-none focus:border-blue-400 focus:ring-1 focus:ring-blue-400\"\r\n                                                                        placeholder=\"IMEI 1\"\r\n                                                                    />\r\n                                                                </div>\r\n                                                                <div>\r\n                                                                    <input\r\n                                                                        type=\"text\"\r\n                                                                        value={item.imei2 || ''}\r\n                                                                        onChange={(e) => updateItem(index, 'imei2', e.target.value)}\r\n                                                                        className=\"w-full bg-white dark:bg-gray-600 border border-gray-200 dark:border-gray-500 rounded px-2 py-1 text-xs text-center text-gray-700 dark:text-gray-200 placeholder-gray-400 focus:outline-none focus:border-blue-400 focus:ring-1 focus:ring-blue-400\"\r\n                                                                        placeholder=\"IMEI 2\"\r\n                                                                    />\r\n                                                                </div>\r\n                                                            </div>\r\n                                                        )}\r\n\r\n                                                        {/* Conditional Serial Number Input */}\r\n                                                        {(item.showImei || (item.category && ['watch', 'laptop', 'buds', 'audio', 'speaker', 'serial', 'macbook', 'ipad', 'tablet', 'electronics'].some(c => item.category.toLowerCase().includes(c)))) && (\r\n                                                            <div className=\"mt-2\">\r\n                                                                <input\r\n                                                                    type=\"text\"\r\n                                                                    value={item.serialNumber || ''}\r\n                                                                    onChange={(e) => updateItem(index, 'serialNumber', e.target.value)}\r\n                                                                    className=\"w-full bg-blue-50 dark:bg-gray-700/50 border border-blue-100 dark:border-gray-600 rounded px-2 py-1 text-xs text-gray-700 dark:text-gray-200 placeholder-gray-400 focus:outline-none focus:border-blue-400\"\r\n                                                                    placeholder=\"Serial Number (Optional)\"\r\n                                                                />\r\n                                                            </div>\r\n                                                        )}\r\n                                                    </td>\r\n                                                    <td className=\"px-2 py-3\">\r\n                                                        <input\r\n                                                            type=\"number\"\r\n                                                            value={item.quantity}\r\n                                                            onChange={(e) => updateItem(index, 'quantity', e.target.value)}\r\n                                                            className=\"w-full bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded px-2 py-1 text-center text-sm font-semibold text-gray-900 dark:text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500\"\r\n                                                        />\r\n                                                    </td>\r\n                                                    <td className=\"px-4 py-3\">\r\n                                                        <div className=\"relative\">\r\n                                                            <input\r\n                                                                type=\"number\"\r\n                                                                value={item.pricePerUnit}\r\n                                                                onChange={(e) => updateItem(index, 'pricePerUnit', e.target.value)}\r\n                                                                className=\"w-full bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded pl-2 pr-1 py-2 text-right text-base font-bold text-gray-900 dark:text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500\"\r\n                                                            />\r\n                                                        </div>\r\n                                                    </td>\r\n                                                    <td className=\"px-4 py-3\">\r\n                                                        <select\r\n                                                            value={item.gstPercent}\r\n                                                            onChange={(e) => updateItem(index, 'gstPercent', e.target.value)}\r\n                                                            className=\"w-full bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded px-1 py-1 text-center text-sm font-semibold text-gray-900 dark:text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 appearance-none\"\r\n                                                        >\r\n                                                            <option value=\"0\">0%</option>\r\n                                                            <option value=\"5\">5%</option>\r\n                                                            <option value=\"12\">12%</option>\r\n                                                            <option value=\"18\">18%</option>\r\n                                                            <option value=\"28\">28%</option>\r\n                                                        </select>\r\n                                                    </td>\r\n                                                    <td className=\"px-4 py-3 text-right text-gray-600 dark:text-gray-300\">\r\n                                                        {formatINR(item.gstAmount)}\r\n                                                    </td>\r\n                                                    <td className=\"px-4 py-3 text-right font-semibold text-gray-900 dark:text-white\">\r\n                                                        {formatINR(item.totalAmount)}\r\n                                                    </td>\r\n                                                    <td className=\"px-4 py-3 text-center\">\r\n                                                        <button\r\n                                                            onClick={() => removeItem(index)}\r\n                                                            className=\"text-red-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                                                        >\r\n                                                            <Trash2 className=\"w-4 h-4\" />\r\n                                                        </button>\r\n                                                    </td>\r\n                                                </tr>\r\n                                            ))\r\n                                        )}\r\n                                    </tbody>\r\n                                </table>\r\n                            </div>\r\n\r\n                            {/* Totals Summary */}\r\n                            {items.length > 0 && (\r\n                                <div className=\"mt-4 flex justify-end\">\r\n                                    <div className=\"w-64 space-y-2 text-sm\">\r\n                                        <div className=\"flex justify-between text-gray-600 dark:text-gray-400\">\r\n                                            <span>Taxable Value:</span>\r\n                                            <span>{formatINR(summary.totalTaxable)}</span>\r\n                                        </div>\r\n                                        <div className=\"flex justify-between text-gray-600 dark:text-gray-400\">\r\n                                            <span>Total GST:</span>\r\n                                            <span>{formatINR(summary.totalGST)}</span>\r\n                                        </div>\r\n                                        <div className=\"flex justify-between text-blue-600 dark:text-blue-400 font-bold text-lg pt-2 border-t border-gray-100 dark:border-gray-700\">\r\n                                            <span>Grand Total:</span>\r\n                                            <span>{formatINR(summary.grandTotal)}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Payment Breakdown (Inline) */}\r\n                        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-6\">\r\n                            <h3 className=\"font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2\">\r\n                                <div className=\"p-1 bg-green-100 dark:bg-green-900/30 rounded text-green-600 dark:text-green-400\">\r\n                                    <div className=\"w-3 h-3 rounded-full border-2 border-current\" />\r\n                                </div>\r\n                                Payment Breakdown\r\n                            </h3>\r\n\r\n                            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\r\n                                <div>\r\n                                    <label className=\"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1\">Cash</label>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        value={payment.cash || ''}\r\n                                        onChange={(e) => setPayment({ ...payment, cash: e.target.value })}\r\n                                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm bg-gray-50 dark:bg-gray-700 focus:bg-white dark:focus:bg-gray-600 text-gray-900 dark:text-white transition-colors\"\r\n                                        placeholder=\"0.00\"\r\n                                    />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1\">UPI (GPay/PhonePe)</label>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        value={payment.upi || ''}\r\n                                        onChange={(e) => setPayment({ ...payment, upi: e.target.value })}\r\n                                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm bg-gray-50 dark:bg-gray-700 focus:bg-white dark:focus:bg-gray-600 text-gray-900 dark:text-white transition-colors\"\r\n                                        placeholder=\"0.00\"\r\n                                    />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1\">Card</label>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        value={payment.card || ''}\r\n                                        onChange={(e) => setPayment({ ...payment, card: e.target.value })}\r\n                                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm bg-gray-50 dark:bg-gray-700 focus:bg-white dark:focus:bg-gray-600 text-gray-900 dark:text-white transition-colors\"\r\n                                        placeholder=\"0.00\"\r\n                                    />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1\">Bank Transfer</label>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        value={payment.bank || ''}\r\n                                        onChange={(e) => setPayment({ ...payment, bank: e.target.value })}\r\n                                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm bg-gray-50 dark:bg-gray-700 focus:bg-white dark:focus:bg-gray-600 text-gray-900 dark:text-white transition-colors\"\r\n                                        placeholder=\"0.00\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex flex-col md:flex-row justify-between items-center p-4 bg-gray-50 dark:bg-gray-800/50 rounded-xl border border-gray-200 dark:border-gray-700\">\r\n                                <div className=\"space-y-1 mb-4 md:mb-0\">\r\n                                    <div className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                                        Total Paid: <span className=\"font-semibold text-green-600 dark:text-green-400\">{formatINR(totalPaid)}</span>\r\n                                    </div>\r\n                                    <div className=\"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2\">\r\n                                        Balance Due (Udhaar):\r\n                                        <span className={`text-xl ${balanceDue > 0 ? 'text-orange-500' : 'text-gray-400 dark:text-gray-500'}`}>\r\n                                            {formatINR(balanceDue > 0 ? balanceDue : 0)}\r\n                                        </span>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-2 mt-1\">\r\n                                        <span className=\"text-xs font-medium text-gray-500 dark:text-gray-400\">Status:</span>\r\n                                        {isFullyPaid ? (\r\n                                            <span className=\"px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-bold rounded-full\">Paid</span>\r\n                                        ) : (\r\n                                            <span className=\"px-2 py-1 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 text-xs font-bold rounded-full flex items-center gap-1\">\r\n                                                Credit / Udhaar\r\n                                                <span className=\"font-normal opacity-75 text-[10px]\">(Added to customer ledger)</span>\r\n                                            </span>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"flex gap-3\">\r\n                                    <button\r\n                                        onClick={() => navigate('/dashboard')}\r\n                                        className=\"px-5 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 font-medium hover:bg-white dark:hover:bg-gray-700 transition-colors\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={handleSubmit}\r\n                                        disabled={loading}\r\n                                        className=\"px-8 py-2.5 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 shadow-lg shadow-blue-200 dark:shadow-blue-900/50 transition-all flex items-center gap-2\"\r\n                                    >\r\n                                        {loading ? 'Saving...' : 'Save TAX INVOICE'}\r\n                                        {!loading && <Save className=\"w-4 h-4\" />}\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                    </div>\r\n\r\n                    {/* RIGHT PREVIEW PANEL (3 cols) */}\r\n                    <div className=\"lg:col-span-3\">\r\n                        <div className=\"sticky top-6\">\r\n                            <h3 className=\"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2\">\r\n                                <Printer className=\"w-4 h-4\" />\r\n                                Live Invoice Preview\r\n                            </h3>\r\n\r\n                            {/* Invoice Preview Card */}\r\n                            <div className=\"bg-white shadow-xl rounded-lg overflow-hidden border border-gray-200 text-xs text-gray-900\">\r\n                                {/* Header - Simplified Design */}\r\n                                {/* Header - Modern Clean Design */}\r\n                                {false ? (\r\n                                    <div className=\"w-full\">\r\n                                        <img\r\n                                            src={settings.letterhead?.startsWith?.('http') ? settings.letterhead : `http://localhost:5000${settings.letterhead}`}\r\n                                            alt=\"Letterhead\"\r\n                                            className=\"w-full h-auto object-contain\"\r\n                                        />\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"p-4 bg-white\">\r\n                                        <div className=\"flex justify-between items-start mb-2\">\r\n                                            {/* Left: Branding */}\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                {settings?.logo && (\r\n                                                    <img\r\n                                                        src={settings.logo?.startsWith?.('http') ? settings.logo : `http://localhost:5000${settings.logo}`}\r\n                                                        className=\"h-10 w-auto object-contain\"\r\n                                                        alt=\"Logo\"\r\n                                                    />\r\n                                                )}\r\n                                                <div>\r\n                                                    <h1 className=\"text-sm font-bold uppercase tracking-wider text-gray-800 leading-tight\">\r\n                                                        {sellerDetails.storeName || ''}\r\n                                                    </h1>\r\n                                                    <p className=\"text-[9px] text-gray-500 tracking-[0.2em]\">\r\n                                                        {sellerDetails.tagline || ''}\r\n                                                    </p>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            {/* Right: Contact & Invoice Meta */}\r\n                                            <div className=\"text-right\">\r\n                                                <div className=\"mb-2\">\r\n                                                    <div className=\"font-bold text-[10px] uppercase tracking-wide text-gray-900\">{invoiceSettings.title}</div>\r\n                                                    <div className=\"text-[9px] text-gray-500\">{invoiceSettings.invoiceNo}</div>\r\n                                                    <div className=\"text-[9px] text-gray-500\">{invoiceSettings.date}</div>\r\n                                                </div>\r\n\r\n                                                <div className=\"text-[9px] text-gray-600 space-y-0.5 font-medium\">\r\n                                                    {sellerDetails.address ? (\r\n                                                        <>\r\n                                                            <p>{sellerDetails.address.split(',')[0]}</p>\r\n                                                            <p>{sellerDetails.address.split(',')[1]}</p>\r\n                                                        </>\r\n                                                    ) : null}\r\n                                                    {sellerDetails.phone && (\r\n                                                        <div className=\"flex items-center justify-end gap-1.5 mt-1\">\r\n                                                            <span>{sellerDetails.phone}</span>\r\n                                                            <span className=\"text-[8px]\" style={{ color: settings?.brandColor || '#EF4444' }}></span>\r\n                                                        </div>\r\n                                                    )}\r\n                                                    {sellerDetails.email && (\r\n                                                        <div className=\"flex items-center justify-end gap-1.5\">\r\n                                                            <span>{sellerDetails.email}</span>\r\n                                                            <span className=\"text-[8px]\" style={{ color: settings?.brandColor || '#EF4444' }}></span>\r\n                                                        </div>\r\n                                                    )}\r\n                                                    {sellerDetails.website && (\r\n                                                        <div className=\"flex items-center justify-end gap-1.5\">\r\n                                                            <span>{sellerDetails.website}</span>\r\n                                                            <span className=\"text-[8px]\" style={{ color: settings?.brandColor || '#EF4444' }}></span>\r\n                                                        </div>\r\n                                                    )}\r\n                                                    {sellerDetails.gstin && (\r\n                                                        <div className=\"flex items-center justify-end gap-1.5 mt-1 font-semibold\">\r\n                                                            <span>GSTIN: {sellerDetails.gstin}</span>\r\n                                                        </div>\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {/* Custom Divider Line */}\r\n                                        <div className=\"flex items-center mt-2 mb-1\">\r\n                                            <div className=\"h-1.5 rounded-l-full w-1/3\" style={{ backgroundColor: settings?.brandColor || '#EF4444' }}></div>\r\n                                            <div className=\"h-0.5 bg-gray-800 w-2/3 rounded-r-full\"></div>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* From/To Section */}\r\n                                <div className=\"p-3 grid grid-cols-2 gap-3 border-b\">\r\n                                    <div>\r\n                                        <div className=\"text-[8px] font-semibold text-gray-600 mb-0.5\">From:</div>\r\n                                        <p className=\"text-[10px] font-semibold text-gray-900\">{sellerDetails.storeName || ''}</p>\r\n                                        <p className=\"text-[9px] text-gray-700\">{sellerDetails.address || ''}</p>\r\n                                        <p className=\"text-[9px] text-gray-700\">{sellerDetails.phone}</p>\r\n                                    </div>\r\n                                    <div>\r\n                                        <div className=\"text-[8px] font-semibold text-gray-600 mb-0.5\">To:</div>\r\n                                        <p className=\"text-[10px] font-semibold text-gray-900\">{customerInfo.name || ''}</p>\r\n                                        <p className=\"text-[9px] text-gray-700\">{customerInfo.phone || ''}</p>\r\n                                        {customerInfo.email && <p className=\"text-[9px] text-gray-700\">{customerInfo.email}</p>}\r\n                                        {customerInfo.gstin && <p className=\"text-[9px] text-gray-700 font-semibold\">GSTIN: {customerInfo.gstin}</p>}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Items Table */}\r\n                                <div className=\"p-4\">\r\n                                    <table className=\"w-full text-[9px]\">\r\n                                        <thead>\r\n                                            <tr className=\"text-white\" style={{ backgroundColor: settings?.brandColor || '#1e3a8a' }}>\r\n                                                <th className=\"py-1.5 px-2 text-left w-10\">#</th>\r\n                                                <th className=\"py-1.5 px-2 text-left\">Item</th>\r\n                                                <th className=\"py-1.5 px-2 text-center w-16\">Qty</th>\r\n                                                <th className=\"py-1.5 px-2 text-right w-24\">Rate</th>\r\n                                                <th className=\"py-1.5 px-2 text-center w-20\">GST %</th>\r\n                                                <th className=\"py-1.5 px-2 text-right w-24\">Total</th>\r\n                                            </tr>\r\n                                        </thead>\r\n                                        <tbody className=\"divide-y divide-gray-100\">\r\n                                            {items.length === 0 ? (\r\n                                                <tr>\r\n                                                    <td colSpan=\"6\" className=\"py-4 text-center text-gray-400 text-[10px]\">\r\n                                                        No items added\r\n                                                    </td>\r\n                                                </tr>\r\n                                            ) : (\r\n                                                items.map((item, index) => (\r\n                                                    <tr key={index} className=\"hover:bg-gray-50 border-b border-gray-50 last:border-0 transition-colors\">\r\n                                                        <td className=\"py-2 px-2 text-gray-500 align-top\">{index + 1}</td>\r\n                                                        <td className=\"py-2 px-2 align-top\">\r\n                                                            <div className=\"font-medium text-gray-900\">{item.name}</div>\r\n                                                            {/* Render IMEI/Serial in Preview */}\r\n                                                            {(item.imei || item.imei2 || item.serialNumber) && (\r\n                                                                <div className=\"text-[7px] text-gray-500 mt-0.5 space-y-0.5\">\r\n                                                                    {item.imei && <span>IMEI 1: {item.imei} </span>}\r\n                                                                    {item.imei2 && <span>IMEI 2: {item.imei2} </span>}\r\n                                                                    {item.serialNumber && <span>SN: {item.serialNumber}</span>}\r\n                                                                </div>\r\n                                                            )}\r\n                                                        </td>\r\n                                                        <td className=\"py-2 px-2 text-center align-top\">{item.quantity}</td>\r\n                                                        <td className=\"py-2 px-2 text-right align-top\">{formatINR(item.pricePerUnit)}</td>\r\n                                                        <td className=\"py-2 px-2 text-center text-gray-500 align-top\">\r\n                                                            {item.gstPercent > 0 ? `${item.gstPercent}%` : '-'}\r\n                                                        </td>\r\n                                                        <td className=\"py-2 px-2 text-right align-top\">{formatINR(item.totalAmount)}</td>\r\n                                                    </tr>\r\n                                                ))\r\n                                            )}\r\n                                        </tbody>\r\n                                    </table>\r\n                                </div>\r\n                                {/* Totals Section - Right Aligned */}\r\n                                <div className=\"p-3 flex justify-end border-t\">\r\n                                    <div className=\"w-48 space-y-0.5\">\r\n                                        <div className=\"flex justify-between text-[9px]\">\r\n                                            <span>Subtotal:</span>\r\n                                            <span>{formatINR(summary.totalTaxable)}</span>\r\n                                        </div>\r\n                                        <div className=\"flex justify-between text-[9px]\">\r\n                                            <span>Total GST:</span>\r\n                                            <span>{formatINR(summary.totalGST)}</span>\r\n                                        </div>\r\n                                        {/* GRAND TOTAL with Blue Badge */}\r\n                                        <div className=\"flex justify-between font-bold text-white p-1.5 rounded mt-1 text-[10px]\"\r\n                                            style={{ backgroundColor: settings?.brandColor || '#1e3a8a' }}>\r\n                                            <span className=\"uppercase\">GRAND TOTAL:</span>\r\n                                            <span>{formatINR(summary.grandTotal)}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Bottom Section - Footer */}\r\n                                <div className=\"p-3 border-t\">\r\n                                    <div className=\"grid grid-cols-2 gap-4\">\r\n                                        {/* Left: QR Code, Notes, Bank Details */}\r\n                                        <div className=\"space-y-2\">\r\n                                            {/* QR Code */}\r\n                                            {sellerDetails.upiId && (\r\n                                                <div>\r\n                                                    <QRCodeSVG\r\n                                                        value={`upi://pay?pa=${sellerDetails.upiId}&pn=${encodeURIComponent(sellerDetails.storeName || 'Store')}`}\r\n                                                        size={60}\r\n                                                        level=\"M\"\r\n                                                        includeMargin={false}\r\n                                                    />\r\n                                                    <div className=\"text-[7px] text-gray-500 mt-0.5\">\r\n                                                        {settings?.digitalSignature ? 'Scan to Pay' : 'ghfghfghfghf'}\r\n                                                    </div>\r\n                                                </div>\r\n                                            )}\r\n\r\n                                            {/* Notes */}\r\n                                            <div className=\"text-[8px] text-gray-600 whitespace-pre-line\">\r\n                                                {sellerDetails.termsAndConditions || ' Goods once sold will not be taken back\\n Payment due within 30 days'}\r\n                                            </div>\r\n                                            {sellerDetails.invoiceFooterText && (\r\n                                                <div\r\n                                                    className={`mt-1 ${sellerDetails.footerFontFamily === 'handwritten' ? 'font-handwritten' : 'font-medium italic'} ${sellerDetails.footerAlignment === 'center' ? 'text-center' : sellerDetails.footerAlignment === 'right' ? 'text-right' : 'text-left'} text-gray-500`}\r\n                                                    style={{ fontSize: `${sellerDetails.footerFontSize * 0.7}px` }}\r\n                                                >\r\n                                                    {sellerDetails.invoiceFooterText}\r\n                                                </div>\r\n                                            )}\r\n\r\n                                            {/* Bank Details */}\r\n                                            {sellerDetails.bankDetails && (\r\n                                                <div className=\"mt-2 whitespace-pre-line\">\r\n                                                    <div className=\"font-semibold text-[8px] mb-0.5 text-gray-700\">Bank Details:</div>\r\n                                                    <div className=\"text-[7px] text-gray-700\">\r\n                                                        {sellerDetails.bankDetails}\r\n                                                    </div>\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n\r\n                                        {/* Right: Authorized Sign */}\r\n                                        <div className=\"flex flex-col items-end justify-end\">\r\n                                            {settings?.digitalSignature ? (\r\n                                                <img\r\n                                                    src={settings.digitalSignature?.startsWith?.('http') ? settings.digitalSignature : `http://localhost:5000${settings.digitalSignature}`}\r\n                                                    alt=\"Signature\"\r\n                                                    className=\"w-24 h-12 object-contain mb-1\"\r\n                                                />\r\n                                            ) : (\r\n                                                <div className=\"w-20 h-10 flex items-center justify-center border border-dashed border-gray-300 rounded mb-1 bg-gray-50 opacity-50\">\r\n                                                    <span className=\"font-serif italic text-[10px] text-gray-400\">Signed</span>\r\n                                                </div>\r\n                                            )}\r\n                                            <div className=\"text-[8px] font-medium text-gray-800\">{sellerDetails.authSignLabel}</div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                                {/* Decorative Footer Bar */}\r\n                                <div className=\"flex h-8 border-t border-white\">\r\n                                    <div className=\"w-1/4 h-full\" style={{ backgroundColor: settings?.brandColor || '#EF4444' }}></div>\r\n                                    <div className=\"w-1/4 h-full opacity-80\" style={{ backgroundColor: settings?.brandColor || '#EF4444' }}></div>\r\n                                    <div className=\"w-1/4 h-full opacity-60\" style={{ backgroundColor: settings?.brandColor || '#EF4444' }}></div>\r\n                                    <div className=\"w-1/4 h-full opacity-40\" style={{ backgroundColor: settings?.brandColor || '#EF4444' }}></div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Layout >\r\n    );\r\n};\r\n\r\nconst InvoiceCreatorWithErrorBoundary = () => (\r\n    <ErrorBoundary>\r\n        <InvoiceCreator />\r\n    </ErrorBoundary>\r\n);\r\n\r\nexport default InvoiceCreatorWithErrorBoundary;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\pages\\InvoiceHistory.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'voidReason' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":29,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"voidReason"},"fix":{"range":[968,978],"text":""},"desc":"Remove unused variable 'voidReason'."}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadInvoices` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\n  30 |\n  31 |     useEffect(() => {\n> 32 |         loadInvoices();\n     |         ^^^^^^^^^^^^ `loadInvoices` accessed before it is declared\n  33 |     }, []);\n  34 |\n  35 |     useEffect(() => {\n\n  60 |     }, [searchQuery, statusFilter, invoices]);\n  61 |\n> 62 |     const loadInvoices = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 63 |         try {\n     | ^^^^^^^^^^^^^\n> 64 |             setLoading(true);\n     \n     | ^^^^^^^^^^^^^\n> 73 |         }\n     | ^^^^^^^^^^^^^\n> 74 |     };\n     | ^^^^^^^ `loadInvoices` is declared here\n  75 |\n  76 |     const handleVoidClick = (invoice) => {\n  77 |         setSelectedInvoice(invoice);","line":32,"column":9,"nodeType":null,"endLine":32,"endColumn":21},{"ruleId":"no-unused-vars","severity":2,"message":"'res' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":85,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":85,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"res"},"fix":{"range":[2945,3010],"text":""},"desc":"Remove unused variable 'res'."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport Layout from '../components/Layout/Layout';\r\nimport api from '../utils/api';\r\nimport { formatINR } from '../utils/currency';\r\nimport { formatDate } from '../utils/date';\r\nimport {\r\n    FileText,\r\n    Search,\r\n    Filter,\r\n    Download,\r\n    Eye,\r\n    Trash2,\r\n    Plus\r\n} from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst InvoiceHistory = () => {\r\n    const navigate = useNavigate();\r\n    const [invoices, setInvoices] = useState([]);\r\n    const [filteredInvoices, setFilteredInvoices] = useState([]);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [statusFilter, setStatusFilter] = useState('All');\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Void Modal State\r\n    const [showVoidModal, setShowVoidModal] = useState(false);\r\n    const [selectedInvoice, setSelectedInvoice] = useState(null);\r\n    const [voidReason, setVoidReason] = useState('');\r\n\r\n    useEffect(() => {\r\n        loadInvoices();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        let filtered = invoices;\r\n\r\n        // Search filter\r\n        if (searchQuery) {\r\n            const query = searchQuery.toLowerCase();\r\n            filtered = filtered.filter(inv =>\r\n                inv.invoiceNo.toLowerCase().includes(query) ||\r\n                (inv.customer?.name || inv.customerName || '').toLowerCase().includes(query) ||\r\n                (inv.customer?.phone || inv.customerPhone || '').includes(query) ||\r\n                // Search by IMEI (1 or 2) or Serial\r\n                inv.items?.some(item =>\r\n                    item.imei?.toLowerCase().includes(query) ||\r\n                    item.imei2?.toLowerCase().includes(query) ||\r\n                    item.serialNumber?.toLowerCase().includes(query)\r\n                )\r\n            );\r\n        }\r\n\r\n        // Status filter\r\n        if (statusFilter !== 'All') {\r\n            filtered = filtered.filter(inv => inv.status === statusFilter);\r\n        }\r\n\r\n        setFilteredInvoices(filtered);\r\n    }, [searchQuery, statusFilter, invoices]);\r\n\r\n    const loadInvoices = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const { data } = await api.get('/invoices');\r\n            setInvoices(data);\r\n            setFilteredInvoices(data);\r\n            setLoading(false);\r\n        } catch (error) {\r\n            console.error('Failed to load invoices:', error);\r\n            toast.error('Failed to load invoices');\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleVoidClick = (invoice) => {\r\n        setSelectedInvoice(invoice);\r\n        setVoidReason(''); // We can keep reason for our own tracking if we add 'reason' to delete endpoint later, but for now standard delete.\r\n        setShowVoidModal(true);\r\n    };\r\n\r\n    const confirmDelete = async () => {\r\n        try {\r\n            // Hard Delete API Call\r\n            const res = await api.delete(`/invoices/${selectedInvoice._id}`);\r\n            // alert('Response: ' + JSON.stringify(res.data)); // Optional Debug\r\n            toast.success('Invoice deleted successfully');\r\n            setShowVoidModal(false);\r\n            loadInvoices();\r\n        } catch (error) {\r\n            console.error('Delete error:', error);\r\n            const msg = error.response?.data?.message || 'Failed to delete invoice';\r\n            toast.error(msg);\r\n        }\r\n    };\r\n\r\n    const getStatusColor = (status) => {\r\n        switch (status) {\r\n            case 'Paid':\r\n                return 'bg-green-100 text-green-700';\r\n            case 'Partial':\r\n                return 'bg-yellow-100 text-yellow-700';\r\n            case 'Due':\r\n                return 'bg-red-100 text-red-700';\r\n            case 'Void':\r\n                return 'bg-gray-200 text-gray-500 line-through';\r\n            default:\r\n                return 'bg-gray-100 text-gray-700';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Layout>\r\n            <div className=\"p-6\">\r\n                {/* Header */}\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                    <div>\r\n                        <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">Invoice History</h1>\r\n                        <p className=\"text-gray-600 dark:text-gray-400 mt-1\">View and manage all invoices</p>\r\n                    </div>\r\n                    <button\r\n                        onClick={() => navigate('/invoice/new')}\r\n                        className=\"flex items-center space-x-2 px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg shadow-sm transition-all\"\r\n                    >\r\n                        <Plus className=\"w-5 h-5\" />\r\n                        <span>New Invoice</span>\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Filters */}\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 mb-6\">\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                        {/* Search */}\r\n                        <div className=\"relative\">\r\n                            <Search className=\"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400\" />\r\n                            <input\r\n                                type=\"text\"\r\n                                value={searchQuery}\r\n                                onChange={(e) => setSearchQuery(e.target.value)}\r\n                                placeholder=\"Search by invoice number, customer name, or phone...\"\r\n                                className=\"w-full pl-12 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                            />\r\n                        </div>\r\n\r\n                        {/* Status Filter */}\r\n                        <div className=\"relative\">\r\n                            <Filter className=\"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400\" />\r\n                            <select\r\n                                value={statusFilter}\r\n                                onChange={(e) => setStatusFilter(e.target.value)}\r\n                                className=\"w-full pl-12 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                            >\r\n                                <option>All</option>\r\n                                <option>Paid</option>\r\n                                <option>Partial</option>\r\n                                <option>Due</option>\r\n                                <option>Void</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Invoices Table */}\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden\">\r\n                    {loading ? (\r\n                        <div className=\"text-center py-12\">\r\n                            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto\"></div>\r\n                        </div>\r\n                    ) : filteredInvoices.length === 0 ? (\r\n                        <div className=\"text-center py-12 text-gray-500 dark:text-gray-400\">\r\n                            <FileText className=\"w-16 h-16 mx-auto mb-4 opacity-50\" />\r\n                            <p className=\"text-lg\">No invoices found</p>\r\n                            {searchQuery || statusFilter !== 'All' ? (\r\n                                <p className=\"text-sm mt-2\">Try adjusting your filters</p>\r\n                            ) : (\r\n                                <button\r\n                                    onClick={() => navigate('/invoice/new')}\r\n                                    className=\"mt-4 text-blue-500 hover:text-blue-400 font-medium\"\r\n                                >\r\n                                    Create your first invoice\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"overflow-x-auto\">\r\n                            <table className=\"w-full\">\r\n                                <thead className=\"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-700\">\r\n                                    <tr>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\r\n                                            Invoice No\r\n                                        </th>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\r\n                                            Customer\r\n                                        </th>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\r\n                                            Date\r\n                                        </th>\r\n                                        <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\r\n                                            Amount\r\n                                        </th>\r\n                                        <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\r\n                                            Paid\r\n                                        </th>\r\n                                        <th className=\"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\r\n                                            Status\r\n                                        </th>\r\n                                        <th className=\"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\r\n                                            Actions\r\n                                        </th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody className=\"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700\">\r\n                                    {filteredInvoices.map((invoice) => (\r\n                                        <tr key={invoice._id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors\">\r\n                                            <td className=\"px-6 py-4\">\r\n                                                <div className=\"font-medium text-gray-900 dark:text-white\">{invoice.invoiceNo}</div>\r\n                                                <div className=\"text-xs text-gray-500 dark:text-gray-400\">{invoice.invoiceType}</div>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4\">\r\n                                                <div className=\"text-sm text-gray-900 dark:text-white\">\r\n                                                    {invoice.customer?.name || invoice.customerName || 'Walk-in Customer'}\r\n                                                </div>\r\n                                                {invoice.customer?.phone && (\r\n                                                    <div className=\"text-xs text-gray-500 dark:text-gray-400\">{invoice.customer.phone}</div>\r\n                                                )}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-sm text-gray-600 dark:text-gray-300\">\r\n                                                {formatDate(invoice.invoiceDate || invoice.createdAt)}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-right text-sm font-semibold text-gray-900 dark:text-white rupee\">\r\n                                                {formatINR(invoice.grandTotal)}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-right text-sm text-gray-600 dark:text-gray-300 rupee\">\r\n                                                {formatINR(invoice.paidAmount)}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-center\">\r\n                                                <span className={`inline-block px-3 py-1 rounded-full text-xs font-semibold ${getStatusColor(invoice.status)}`}>\r\n                                                    {invoice.status}\r\n                                                </span>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-center\">\r\n                                                <div className=\"flex items-center justify-center space-x-2\">\r\n                                                    <button\r\n                                                        onClick={() => navigate(`/invoice/${invoice._id}`)}\r\n                                                        className=\"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg transition-colors\"\r\n                                                        title=\"View\"\r\n                                                    >\r\n                                                        <Eye className=\"w-4 h-4\" />\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={() => window.print()}\r\n                                                        className=\"p-2 text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/30 rounded-lg transition-colors\"\r\n                                                        title=\"Print\"\r\n                                                    >\r\n                                                        <Download className=\"w-4 h-4\" />\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={() => handleVoidClick(invoice)}\r\n                                                        className=\"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors\"\r\n                                                        title=\"Delete Permanently\"\r\n                                                    >\r\n                                                        <Trash2 className=\"w-4 h-4\" />\r\n                                                    </button>\r\n                                                </div>\r\n                                            </td>\r\n                                        </tr>\r\n                                    ))}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Summary Stats */}\r\n                {!loading && filteredInvoices.length > 0 && (\r\n                    <div className=\"mt-6 grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n                        <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm border border-gray-100 dark:border-gray-700\">\r\n                            <p className=\"text-sm text-gray-600 dark:text-gray-400\">Total Invoices</p>\r\n                            <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{filteredInvoices.length}</p>\r\n                        </div>\r\n                        <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm border border-gray-100 dark:border-gray-700\">\r\n                            <p className=\"text-sm text-gray-600 dark:text-gray-400\">Total Amount</p>\r\n                            <p className=\"text-2xl font-bold text-gray-900 dark:text-white rupee\">\r\n                                {formatINR(filteredInvoices.reduce((sum, inv) => sum + inv.grandTotal, 0))}\r\n                            </p>\r\n                        </div>\r\n                        <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm border border-gray-100 dark:border-gray-700\">\r\n                            <p className=\"text-sm text-gray-600 dark:text-gray-400\">Total Paid</p>\r\n                            <p className=\"text-2xl font-bold text-green-600 dark:text-green-400 rupee\">\r\n                                {formatINR(filteredInvoices.reduce((sum, inv) => sum + inv.paidAmount, 0))}\r\n                            </p>\r\n                        </div>\r\n                        <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm border border-gray-100 dark:border-gray-700\">\r\n                            <p className=\"text-sm text-gray-600 dark:text-gray-400\">Total Due</p>\r\n                            <p className=\"text-2xl font-bold text-red-600 dark:text-red-400 rupee\">\r\n                                {formatINR(filteredInvoices.reduce((sum, inv) => sum + (inv.grandTotal - inv.paidAmount), 0))}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Delete Confirmation Modal */}\r\n            {showVoidModal && (\r\n                <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 backdrop-blur-sm\">\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6 shadow-xl border border-gray-200 dark:border-gray-700 animate-in fade-in zoom-in duration-200\">\r\n                        <h3 className=\"text-xl font-bold text-gray-900 dark:text-white mb-4\">Delete Invoice {selectedInvoice?.invoiceNo}</h3>\r\n\r\n                        <div className=\"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 border p-4 rounded-lg mb-6\">\r\n                            <p className=\"text-sm text-red-800 dark:text-red-300 font-medium mb-2\">\r\n                                Critical Warning: This will PERMANENTLY remove the invoice.\r\n                            </p>\r\n                            <ul className=\"list-disc pl-5 text-sm text-red-700 dark:text-red-400 space-y-1\">\r\n                                <li>Items will be restored to inventory.</li>\r\n                                <li>Customer balance will be reverted.</li>\r\n                                <li>Record will be gone forever.</li>\r\n                            </ul>\r\n                        </div>\r\n\r\n                        <div className=\"flex justify-end space-x-3\">\r\n                            <button\r\n                                onClick={() => setShowVoidModal(false)}\r\n                                className=\"px-4 py-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg font-medium transition-colors\"\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                            <button\r\n                                onClick={confirmDelete}\r\n                                className=\"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium shadow-sm transition-colors\"\r\n                            >\r\n                                Confirm Delete\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </Layout>\r\n    );\r\n};\r\n\r\nexport default InvoiceHistory;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\pages\\InvoiceView.jsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadInvoice` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\n  17 |\n  18 |     useEffect(() => {\n> 19 |         loadInvoice();\n     |         ^^^^^^^^^^^ `loadInvoice` accessed before it is declared\n  20 |     }, [id]);\n  21 |\n  22 |     const loadInvoice = async () => {\n\n  20 |     }, [id]);\n  21 |\n> 22 |     const loadInvoice = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 23 |         try {\n     | ^^^^^^^^^^^^^\n> 24 |             const { data } = await api.get(`/invoices/${id}`);\n     \n     | ^^^^^^^^^^^^^\n> 31 |         }\n     | ^^^^^^^^^^^^^\n> 32 |     };\n     | ^^^^^^^ `loadInvoice` is declared here\n  33 |\n  34 |     const handleWhatsAppShare = () => {\n  35 |         if (!invoice) return;","line":19,"column":9,"nodeType":null,"endLine":19,"endColumn":20},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadInvoice'. Either include it or remove the dependency array.","line":20,"column":8,"nodeType":"ArrayExpression","endLine":20,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [id, loadInvoice]","fix":{"range":[775,779],"text":"[id, loadInvoice]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport api from '../utils/api';\r\nimport { useSettings } from '../context/SettingsContext';\r\nimport { formatINR } from '../utils/currency';\r\nimport { formatDate } from '../utils/date';\r\nimport { Printer, ArrowLeft, Download, Share2, Mail } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\nimport { QRCodeSVG } from 'qrcode.react';\r\n\r\nconst InvoiceView = ({ isPublic = false }) => {\r\n    const { id } = useParams();\r\n    const navigate = useNavigate();\r\n    const { settings } = useSettings();\r\n    const [invoice, setInvoice] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        loadInvoice();\r\n    }, [id]);\r\n\r\n    const loadInvoice = async () => {\r\n        try {\r\n            const { data } = await api.get(`/invoices/${id}`);\r\n            setInvoice(data);\r\n            setLoading(false);\r\n        } catch (error) {\r\n            console.error('Failed to load invoice:', error);\r\n            toast.error('Failed to load invoice');\r\n            navigate('/invoices');\r\n        }\r\n    };\r\n\r\n    const handleWhatsAppShare = () => {\r\n        if (!invoice) return;\r\n\r\n        const phone = invoice.customer?.phone || invoice.customerPhone || '';\r\n        const cleanPhone = phone.replace(/\\D/g, ''); // Remove non-digits\r\n\r\n        // Use public link if available, otherwise fallback to current URL (though public link is preferred)\r\n        const shareUrl = `${window.location.origin}/share/invoice/${invoice._id}`;\r\n\r\n        // Construct Message\r\n        const message = `Hello ${invoice.customer?.name || 'Customer'},\\n\\nHere is your invoice *${invoice.invoiceNo}* from *${invoice.sellerDetails?.storeName || settings?.storeName}*.\\n\\nYou can view and download it here:\\n${shareUrl}\\n\\nDate: ${formatDate(invoice.invoiceDate)}\\nTotal Amount: *${formatINR(invoice.grandTotal)}*\\n\\nThank you for your business!`;\r\n\r\n        const url = `https://wa.me/${cleanPhone.length > 10 ? cleanPhone : ''}?text=${encodeURIComponent(message)}`;\r\n\r\n        window.open(url, '_blank');\r\n    };\r\n\r\n    const handleEmailShare = () => {\r\n        if (!invoice) return;\r\n\r\n        const shareUrl = `${window.location.origin}/share/invoice/${invoice._id}`;\r\n        const subject = `Invoice ${invoice.invoiceNo} from ${invoice.sellerDetails?.storeName || settings?.storeName}`;\r\n        const body = `Hello ${invoice.customer?.name || 'Customer'},\\n\\nPlease find attached your invoice ${invoice.invoiceNo}.\\n\\nYou can view it online here:\\n${shareUrl}\\n\\nTotal Amount: ${formatINR(invoice.grandTotal)}\\n\\nThank you for your business!`;\r\n\r\n        window.location.href = `mailto:${invoice.customer?.email || ''}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\r\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!invoice) return null;\r\n\r\n    // Use invoice-specific seller details if available (Snapshot), otherwise fallback to global settings\r\n    const seller = invoice.sellerDetails || {\r\n        storeName: settings?.storeName || settings?.shopName,\r\n        tagline: settings?.tagline,\r\n        address: settings?.address,\r\n        phone: settings?.phone,\r\n        email: settings?.email,\r\n        gstin: settings?.gstin || settings?.gstNumber,\r\n        website: settings?.website,\r\n        bankDetails: (settings?.bankName && settings?.accountNumber)\r\n            ? `${settings.bankName}, A/c: ${settings.accountNumber}, IFSC: ${settings.ifscCode}`\r\n            : '',\r\n        upiId: settings?.upi || settings?.upiId,\r\n        footerFontSize: settings?.footerFontSize || 12,\r\n        footerFontFamily: settings?.footerFontFamily || 'sans-serif',\r\n        footerAlignment: settings?.footerAlignment || 'center',\r\n        invoiceFooterText: settings?.invoiceFooterText || ''\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 p-6 print:p-0 print:bg-white transition-all duration-300\">\r\n            {/* Toolbar - Hidden in Print */}\r\n            <div className=\"max-w-4xl mx-auto mb-6 flex items-center justify-between print:hidden\">\r\n                <div>\r\n                    {!isPublic && (\r\n                        <button\r\n                            onClick={() => navigate('/invoices')}\r\n                            className=\"flex items-center gap-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors\"\r\n                        >\r\n                            <ArrowLeft className=\"w-5 h-5\" />\r\n                            Back to History\r\n                        </button>\r\n                    )}\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                    {!isPublic && (\r\n                        <>\r\n                            <button\r\n                                onClick={handleWhatsAppShare}\r\n                                className=\"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-sm\"\r\n                            >\r\n                                <Share2 className=\"w-4 h-4\" />\r\n                                WhatsApp\r\n                            </button>\r\n                            <button\r\n                                onClick={handleEmailShare}\r\n                                className=\"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors shadow-sm\"\r\n                            >\r\n                                <Mail className=\"w-4 h-4\" />\r\n                                Email\r\n                            </button>\r\n                        </>\r\n                    )}\r\n                    <button\r\n                        onClick={() => window.print()}\r\n                        className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-sm\"\r\n                    >\r\n                        <Printer className=\"w-4 h-4\" />\r\n                        Print Invoice\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Invoice Paper */}\r\n            <div className=\"max-w-4xl mx-auto bg-white shadow-xl rounded-xl overflow-hidden print:shadow-none print:rounded-none print:a4-page-container transition-all duration-300 text-gray-900\">\r\n                {/* Header - Modern Clean Design */}\r\n                <div className=\"p-4 bg-white print:bg-white transition-colors\">\r\n                    <div className=\"flex justify-between items-start mb-2\">\r\n                        {/* Left: Branding */}\r\n                        <div className=\"flex items-center gap-3\">\r\n                            {settings?.logo && (\r\n                                <img\r\n                                    src={settings.logo?.startsWith?.('http') ? settings.logo : `http://localhost:5000${settings.logo}`}\r\n                                    className=\"h-10 w-auto object-contain\"\r\n                                    alt=\"Logo\"\r\n                                />\r\n                            )}\r\n                            <div>\r\n                                <h1 className=\"text-sm font-bold uppercase tracking-wider text-gray-800 leading-tight\">\r\n                                    {seller.storeName || ''}\r\n                                </h1>\r\n                                <p className=\"text-[9px] text-gray-500 tracking-[0.2em]\">\r\n                                    {seller.tagline || ''}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Right: Contact & Invoice Meta */}\r\n                        <div className=\"text-right\">\r\n                            <div className=\"mb-2\">\r\n                                <div className=\"font-bold text-[10px] uppercase tracking-wide text-gray-900\">{invoice.invoiceType || 'TAX INVOICE'}</div>\r\n                                <div className=\"text-[9px] text-gray-500\">{invoice.invoiceNo}</div>\r\n                                <div className=\"text-[9px] text-gray-500\">{formatDate(invoice.invoiceDate || invoice.createdAt)}</div>\r\n                            </div>\r\n\r\n                            <div className=\"text-[9px] text-gray-600 space-y-0.5 font-medium\">\r\n                                {seller.address ? (\r\n                                    <>\r\n                                        <p>{seller.address.split(',')[0]}</p>\r\n                                        <p>{seller.address.split(',')[1]}</p>\r\n                                    </>\r\n                                ) : null}\r\n                                {seller.phone && (\r\n                                    <div className=\"flex items-center justify-end gap-1.5 mt-1\">\r\n                                        <span>{seller.phone}</span>\r\n                                        <span className=\"text-[8px]\" style={{ color: settings?.brandColor || '#EF4444' }}></span>\r\n                                    </div>\r\n                                )}\r\n                                {seller.email && (\r\n                                    <div className=\"flex items-center justify-end gap-1.5\">\r\n                                        <span>{seller.email}</span>\r\n                                        <span className=\"text-[8px]\" style={{ color: settings?.brandColor || '#EF4444' }}></span>\r\n                                    </div>\r\n                                )}\r\n                                {seller.website && (\r\n                                    <div className=\"flex items-center justify-end gap-1.5\">\r\n                                        <span>{seller.website}</span>\r\n                                        <span className=\"text-[8px]\" style={{ color: settings?.brandColor || '#EF4444' }}></span>\r\n                                    </div>\r\n                                )}\r\n                                {seller.gstin && (\r\n                                    <div className=\"flex items-center justify-end gap-1.5 mt-1 font-semibold\">\r\n                                        <span>GSTIN: {seller.gstin}</span>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Custom Divider Line */}\r\n                    <div className=\"flex items-center mt-2 mb-1\">\r\n                        <div className=\"h-1.5 rounded-l-full w-1/3\" style={{ backgroundColor: settings?.brandColor || '#EF4444' }}></div>\r\n                        <div className=\"h-0.5 bg-gray-800 w-2/3 rounded-r-full\"></div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* From/To Section */}\r\n                <div className=\"p-3 grid grid-cols-2 gap-3 border-b border-gray-100 print:border-gray-200\">\r\n                    <div>\r\n                        <div className=\"text-[8px] font-semibold text-gray-600 mb-0.5\">From:</div>\r\n                        <p className=\"text-[10px] font-semibold text-gray-900\">{seller.storeName || ''}</p>\r\n                        <p className=\"text-[9px] text-gray-700\">{seller.address || ''}</p>\r\n                        <p className=\"text-[9px] text-gray-700\">{seller.phone}</p>\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"text-[8px] font-semibold text-gray-600 mb-0.5\">To:</div>\r\n                        <p className=\"text-[10px] font-semibold text-gray-900\">\r\n                            {(invoice.customer && invoice.customer.name)\r\n                                ? invoice.customer.name\r\n                                : (invoice.customerName || 'Walk-in Customer')}\r\n                        </p>\r\n                        <p className=\"text-[9px] text-gray-700\">{invoice.customerPhone || 'No Phone'}</p>\r\n                        {(invoice.customer?.address || invoice.customerAddress) && <p className=\"text-[9px] text-gray-700\">{invoice.customer?.address || invoice.customerAddress}</p>}\r\n                        {(invoice.customer?.gstin || invoice.customerGstin) && <p className=\"text-[9px] text-gray-700 font-semibold\">GSTIN: {invoice.customer?.gstin || invoice.customerGstin}</p>}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Items Table */}\r\n                <div className=\"p-6\">\r\n                    <table className=\"w-full text-[9px]\">\r\n                        <thead>\r\n                            <tr className=\"text-white\" style={{ backgroundColor: settings?.brandColor || '#1e3a8a' }}>\r\n                                <th className=\"py-1.5 px-2 text-left w-10\">#</th>\r\n                                <th className=\"py-1.5 px-2 text-left\">Item</th>\r\n                                <th className=\"py-1.5 px-2 text-center w-16\">Qty</th>\r\n                                <th className=\"py-1.5 px-2 text-right w-24\">Rate</th>\r\n                                <th className=\"py-1.5 px-2 text-center w-20\">GST %</th>\r\n                                <th className=\"py-1.5 px-2 text-right w-24\">Total</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-gray-100 print:divide-gray-200\">\r\n                            {invoice.items.map((item, index) => (\r\n                                <tr className=\"hover:bg-gray-50 border-b border-gray-50 last:border-0 transition-colors\">\r\n                                    <td className=\"py-2 px-2 text-gray-500 align-top\">{index + 1}</td>\r\n                                    <td className=\"py-2 px-2 align-top\">\r\n                                        <div className=\"font-medium text-gray-900\">{item.productName || item.itemName}</div>\r\n                                        {/* IMEI/Serial Display */}\r\n                                        {(item.imei || item.imei2 || item.serialNumber) && (\r\n                                            <div className=\"text-[7px] text-gray-500 mt-0.5 space-y-0.5\">\r\n                                                {item.imei && <span>IMEI 1: {item.imei} </span>}\r\n                                                {item.imei2 && <span>IMEI 2: {item.imei2} </span>}\r\n                                                {item.serialNumber && <span>SN: {item.serialNumber}</span>}\r\n                                            </div>\r\n                                        )}\r\n                                        {item.isCustom && (\r\n                                            <span className=\"inline-block mt-0.5 text-[7px] bg-blue-50 text-blue-600 px-1 py-0.2 rounded\">\r\n                                                Custom\r\n                                            </span>\r\n                                        )}\r\n                                    </td>\r\n                                    <td className=\"py-2 px-2 text-center text-gray-700 align-top\">{item.quantity}</td>\r\n                                    <td className=\"py-2 px-2 text-right text-gray-700 align-top\">{formatINR(item.pricePerUnit)}</td>\r\n                                    <td className=\"py-2 px-2 text-center text-gray-500 align-top\">\r\n                                        {item.gstPercent > 0 ? `${item.gstPercent}%` : '-'}\r\n                                    </td>\r\n                                    <td className=\"py-2 px-2 text-right font-medium text-gray-900 align-top\">\r\n                                        {formatINR(item.totalAmount)}\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n\r\n                {/* Totals Section - Right Aligned */}\r\n                <div className=\"p-3 flex justify-end border-t border-gray-100 print:border-gray-200\">\r\n                    <div className=\"w-48 space-y-0.5\">\r\n                        <div className=\"flex justify-between text-[9px] text-gray-700\">\r\n                            <span>Subtotal:</span>\r\n                            <span>{formatINR(invoice.totalTaxable)}</span>\r\n                        </div>\r\n                        <div className=\"flex justify-between text-[9px] text-gray-700\">\r\n                            <span>Total GST:</span>\r\n                            <span>{formatINR(invoice.totalGST)}</span>\r\n                        </div>\r\n                        {/* GRAND TOTAL with Blue Badge */}\r\n                        <div className=\"flex justify-between font-bold text-white p-1.5 rounded mt-1 text-[10px]\"\r\n                            style={{ backgroundColor: settings?.brandColor || '#1e3a8a' }}>\r\n                            <span className=\"uppercase\">GRAND TOTAL:</span>\r\n                            <span>{formatINR(invoice.grandTotal)}</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Bottom Section - Footer */}\r\n                <div className=\"p-3 border-t border-gray-100 print:border-gray-200\">\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        {/* Left: QR Code, Notes, Bank Details */}\r\n                        <div className=\"space-y-2\">\r\n                            {/* QR Code */}\r\n                            {seller.upiId && (\r\n                                <div>\r\n                                    <QRCodeSVG\r\n                                        value={`upi://pay?pa=${seller.upiId}&pn=${encodeURIComponent(seller.storeName || '' || 'Store')}`}\r\n                                        size={60}\r\n                                        level=\"M\"\r\n                                        includeMargin={false}\r\n                                    />\r\n                                    <div className=\"text-[7px] text-gray-500 mt-0.5\">\r\n                                        {settings?.digitalSignature ? 'Scan to Pay' : 'Official Invoice'}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Notes */}\r\n                            <div className=\"text-[8px] text-gray-600 whitespace-pre-line\">\r\n                                {invoice.notes || seller.termsAndConditions || ' Goods once sold will not be taken back\\n Payment due within 30 days'}\r\n                            </div>\r\n                            {seller.invoiceFooterText && (\r\n                                <div\r\n                                    className={`mt-1 ${seller.footerFontFamily === 'handwritten' ? 'font-handwritten' : 'font-medium italic'} ${seller.footerAlignment === 'center' ? 'text-center' : seller.footerAlignment === 'right' ? 'text-right' : 'text-left'} text-gray-500`}\r\n                                    style={{ fontSize: `${seller.footerFontSize * 0.7}px` }}\r\n                                >\r\n                                    {seller.invoiceFooterText}\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Bank Details */}\r\n                            {seller.bankDetails && (\r\n                                <div className=\"mt-2 whitespace-pre-line\">\r\n                                    <div className=\"font-semibold text-[8px] mb-0.5 text-gray-700\">Bank Details:</div>\r\n                                    <div className=\"text-[7px] text-gray-700 leading-tight\">\r\n                                        {seller.bankDetails}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Right: Authorized Sign */}\r\n                        <div className=\"flex flex-col items-end justify-end\">\r\n                            {settings?.digitalSignature ? (\r\n                                <img\r\n                                    src={settings.digitalSignature.startsWith('http') ? settings.digitalSignature : `http://localhost:5000${settings.digitalSignature}`}\r\n                                    alt=\"Signature\"\r\n                                    className=\"w-24 h-12 object-contain mb-1\"\r\n                                />\r\n                            ) : (\r\n                                <div className=\"w-20 h-10 flex items-center justify-center border border-dashed border-gray-300 rounded mb-1 bg-gray-50 opacity-50\">\r\n                                    <span className=\"font-serif italic text-[10px] text-gray-400\">Signed</span>\r\n                                </div>\r\n                            )}\r\n                            <div className=\"text-[8px] font-medium text-gray-900\">{seller.authSignLabel || 'Authorized Signatory'}</div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Decorative Footer Bar */}\r\n                <div className=\"flex h-8 border-t border-white\">\r\n                    <div className=\"w-1/4 h-full\" style={{ backgroundColor: settings?.brandColor || '#EF4444' }}></div>\r\n                    <div className=\"w-1/4 h-full opacity-80\" style={{ backgroundColor: settings?.brandColor || '#EF4444' }}></div>\r\n                    <div className=\"w-1/4 h-full opacity-60\" style={{ backgroundColor: settings?.brandColor || '#EF4444' }}></div>\r\n                    <div className=\"w-1/4 h-full opacity-40\" style={{ backgroundColor: settings?.brandColor || '#EF4444' }}></div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Print Footer */}\r\n            <div className=\"p-4 border-t border-gray-100 dark:border-gray-800 text-center text-[10px] text-gray-400 dark:text-gray-500 print:block hidden\">\r\n                <p>Computer Generated Invoice  {seller.storeName}</p>\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n};\r\n\r\nexport default InvoiceView;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\pages\\LetterheadCreator.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'useRef' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":1,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":44,"suggestions":[{"messageId":"removeVar","data":{"varName":"useRef"},"fix":{"range":[35,43],"text":""},"desc":"Remove unused variable 'useRef'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadLetterhead'. Either include it or remove the dependency array.","line":35,"column":8,"nodeType":"ArrayExpression","endLine":35,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [id, loadLetterhead]","fix":{"range":[1321,1325],"text":"[id, loadLetterhead]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from 'react';\r\nimport { useNavigate, useParams, useLocation } from 'react-router-dom';\r\nimport Layout from '../components/Layout/Layout';\r\nimport api from '../utils/api';\r\nimport { useSettings } from '../context/SettingsContext';\r\nimport { ArrowLeft, Save, Printer, Type, Layout as LayoutIcon } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst LetterheadCreator = () => {\r\n    const navigate = useNavigate();\r\n    const { id } = useParams();\r\n    const location = useLocation();\r\n    const isViewMode = location.pathname.includes('/view/');\r\n    const { settings } = useSettings();\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Document Content\r\n    const [recipient, setRecipient] = useState({ name: '', address: '', email: '' });\r\n    const [subject, setSubject] = useState('');\r\n    const [content, setContent] = useState('');\r\n\r\n    // Copy Global Config to Local State (for potential overrides, though we stick to Global for now)\r\n    const [config, setConfig] = useState(null);\r\n\r\n    useEffect(() => {\r\n        if (settings?.letterheadConfig && !id) {\r\n            setConfig(settings.letterheadConfig);\r\n        }\r\n    }, [settings, id]);\r\n\r\n    useEffect(() => {\r\n        if (id) {\r\n            loadLetterhead();\r\n        }\r\n    }, [id]);\r\n\r\n    const loadLetterhead = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const { data } = await api.get(`/letterheads/${id}`);\r\n            setRecipient(data.recipient || { name: '', address: '', email: '' });\r\n            setSubject(data.subject);\r\n            setContent(data.content);\r\n            if (data.configSnapshot) {\r\n                setConfig(data.configSnapshot);\r\n            } else if (settings?.letterheadConfig) {\r\n                setConfig(settings.letterheadConfig);\r\n            }\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error('Failed to load letterhead');\r\n            navigate('/letterheads');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleSave = async (status = 'Draft') => {\r\n        if (!subject || !content) {\r\n            toast.error('Subject and Content are required');\r\n            return;\r\n        }\r\n        try {\r\n            setLoading(true);\r\n            const data = {\r\n                recipient,\r\n                subject,\r\n                content,\r\n                status\r\n            };\r\n\r\n            if (id) {\r\n                await api.put(`/letterheads/${id}`, data);\r\n                toast.success('Letterhead updated');\r\n            } else {\r\n                await api.post('/letterheads', data);\r\n                toast.success('Letterhead created');\r\n            }\r\n            navigate('/letterheads');\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error('Failed to save letterhead');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handlePrint = () => {\r\n        window.print();\r\n    };\r\n\r\n    if (!config) return <Layout><div className=\"p-6\">Loading config...</div></Layout>;\r\n\r\n    return (\r\n        <Layout>\r\n            <div className=\"p-6 h-[calc(100vh-64px)] overflow-hidden flex flex-col no-print bg-gray-50 dark:bg-gray-900\">\r\n                {/* Header */}\r\n                <div className=\"flex justify-between items-center mb-6\">\r\n                    <div className=\"flex items-center space-x-4\">\r\n                        <button onClick={() => navigate('/letterheads')} className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors\">\r\n                            <ArrowLeft className=\"w-5 h-5 text-gray-600 dark:text-gray-400\" />\r\n                        </button>\r\n                        <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Create Letter</h1>\r\n                    </div>\r\n                    <div className=\"flex space-x-3\">\r\n                        <button onClick={handlePrint} className=\"flex items-center space-x-2 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition\">\r\n                            <Printer className=\"w-4 h-4\" />\r\n                            <span>Print / PDF</span>\r\n                        </button>\r\n                        {!isViewMode && (\r\n                            <button onClick={() => handleSave('Final')} disabled={loading} className=\"flex items-center space-x-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors\">\r\n                                <Save className=\"w-4 h-4\" />\r\n                                <span>{loading ? 'Saving...' : id ? 'Update' : 'Save Document'}</span>\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex-1 flex gap-6 overflow-hidden\">\r\n                    {/* Editor Panel */}\r\n                    <div className=\"w-1/3 flex flex-col bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden\">\r\n                        <div className=\"p-4 bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between\">\r\n                            <h3 className=\"font-semibold text-gray-700 dark:text-gray-200 flex items-center\">\r\n                                <Type className=\"w-4 h-4 mr-2\" /> Content Editor\r\n                            </h3>\r\n                        </div>\r\n                        <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\r\n                            {/* Recipient */}\r\n                            <div className=\"space-y-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg\">\r\n                                <span className=\"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase\">Recipient Details</span>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"Recipient Name\"\r\n                                    value={recipient.name}\r\n                                    onChange={(e) => setRecipient({ ...recipient, name: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                />\r\n                                <textarea\r\n                                    placeholder=\"Address / Designation\"\r\n                                    value={recipient.address}\r\n                                    onChange={(e) => setRecipient({ ...recipient, address: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded text-sm h-16 resize-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Subject */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Subject</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"Subject of the letter...\"\r\n                                    value={subject}\r\n                                    onChange={(e) => setSubject(e.target.value)}\r\n                                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg font-medium bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Body */}\r\n                            <div className=\"flex-1 flex flex-col\">\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Body Content</label>\r\n                                <textarea\r\n                                    placeholder=\"Type your letter content here...\"\r\n                                    value={content}\r\n                                    onChange={(e) => setContent(e.target.value)}\r\n                                    className=\"w-full flex-1 p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-sm leading-relaxed resize-none min-h-[300px] bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                    style={{ fontFamily: config.fontFamily }}\r\n                                />\r\n                                <p className=\"text-xs text-gray-400 mt-2\">\r\n                                    HTML or Markdown not supported in this version. Plain text only.\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Preview Panel (A4) */}\r\n                    <div className=\"flex-1 bg-gray-200 dark:bg-gray-900 rounded-xl overflow-auto flex justify-center p-8 border border-gray-200 dark:border-gray-700\">\r\n                        <div className=\"printable-content bg-white shadow-2xl relative transition-all duration-300\"\r\n                            style={{\r\n                                width: '210mm',\r\n                                minHeight: '297mm',\r\n                                paddingTop: `${config.marginTop}mm`,\r\n                                paddingBottom: `${config.marginBottom}mm`,\r\n                                paddingLeft: `${config.marginLeft}mm`,\r\n                                paddingRight: `${config.marginRight}mm`,\r\n                                fontFamily: config.fontFamily || 'Inter',\r\n                                position: 'relative'\r\n                            }}\r\n                        >\r\n                            {/* Watermark */}\r\n                            {config.watermarkText && (\r\n                                <div className=\"absolute inset-0 flex items-center justify-center z-0 pointer-events-none overflow-hidden\">\r\n                                    <div\r\n                                        className=\"font-bold text-gray-900 transform -rotate-45 whitespace-nowrap select-none\"\r\n                                        style={{\r\n                                            opacity: config.watermarkOpacity,\r\n                                            fontSize: `${config.watermarkSize || 100}px`\r\n                                        }}\r\n                                    >\r\n                                        {config.watermarkText}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Header - Liceria Style */}\r\n                            <div className=\"relative z-10 flex justify-between items-start mb-4\">\r\n                                {/* Branding (Left) */}\r\n                                <div className=\"flex flex-col items-start\">\r\n                                    <div className=\"flex items-center gap-3 mb-2\">\r\n                                        {settings?.logo && (\r\n                                            <img src={settings.logo} className=\"h-16 w-auto object-contain\" alt=\"Logo\" />\r\n                                        )}\r\n                                        <div>\r\n                                            <h1 className=\"text-3xl font-bold text-gray-800 uppercase tracking-wide leading-none\">{settings.shopName || ''}</h1>\r\n                                            <p className=\"text-sm text-gray-500 tracking-[0.2em]\">{settings.tagline || ''}</p>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Contact Info (Right) */}\r\n                                <div className=\"text-right text-xs text-gray-600 leading-tight\">\r\n                                    <p className=\"font-semibold text-gray-800\">{settings.address?.split('\\n')[0]}</p>\r\n                                    <p>{settings.address?.split('\\n')[1]}</p>\r\n                                    {settings.phone && (\r\n                                        <p className=\"mt-2 flex items-center justify-end gap-2\">\r\n                                            {settings.phone} <span className=\"text-[10px] bg-red-500 text-white rounded-full p-1 w-5 h-5 flex items-center justify-center\"></span>\r\n                                        </p>\r\n                                    )}\r\n                                    {settings.email && (\r\n                                        <p className=\"flex items-center justify-end gap-2 mt-1\">\r\n                                            {settings.email} <span className=\"text-[10px] bg-red-500 text-white rounded-full p-1 w-5 h-5 flex items-center justify-center\"></span>\r\n                                        </p>\r\n                                    )}\r\n                                    {settings.website && (\r\n                                        <p className=\"flex items-center justify-end gap-2 mt-1\">\r\n                                            {settings.website} <span className=\"text-[10px] bg-red-500 text-white rounded-full p-1 w-5 h-5 flex items-center justify-center\"></span>\r\n                                        </p>\r\n                                    )}\r\n                                    {settings.gstNumber && (\r\n                                        <p className=\"flex items-center justify-end gap-2 mt-1 font-semibold\">\r\n                                            GSTIN: {settings.gstNumber}\r\n                                        </p>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Graphical Separator - Red/Black Line */}\r\n                            <div className=\"relative z-10 w-full flex h-2 mb-10\">\r\n                                <div className=\"w-1/3\" style={{ backgroundColor: settings.brandColor || '#EF4444' }}></div>\r\n                                <div className=\"flex-1 bg-gray-900\"></div>\r\n                            </div>\r\n\r\n                            {/* Letter Content */}\r\n                            <div className=\"relative z-10 text-gray-900 leading-relaxed whitespace-pre-wrap\">\r\n                                {/* Date */}\r\n                                <div className=\"mb-8 text-right font-medium\">\r\n                                    {new Date().toLocaleDateString('en-IN', { year: 'numeric', month: 'long', day: 'numeric' })}\r\n                                </div>\r\n\r\n                                {/* Recipient Block */}\r\n                                {(recipient.name || recipient.address) && (\r\n                                    <div className=\"mb-12\">\r\n                                        <p className=\"font-bold text-lg\">{recipient.name}</p>\r\n                                        <p className=\"whitespace-pre-line text-gray-600\">{recipient.address}</p>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* Subject */}\r\n                                {subject && (\r\n                                    <div className=\"mb-8 font-bold text-lg underline decoration-2 underline-offset-4 decoration-gray-400\">\r\n                                        Subject: {subject}\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* Body */}\r\n                                <div className=\"min-h-[300px] text-justify text-base\">\r\n                                    {content || <span className=\"text-gray-300 italic\">Start typing content...</span>}\r\n                                </div>\r\n\r\n                                {/* Signature Block */}\r\n                                <div className=\"mt-20 text-right\">\r\n                                    <p className=\"font-bold text-lg\">{settings.shopName}</p>\r\n                                    <div className=\"h-24\"></div>\r\n                                    <p className=\"text-sm text-gray-600 border-t inline-block pt-2 px-8 border-gray-400\">Authorized Signatory</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Footer - 4 Color Blocks */}\r\n                            <div className=\"absolute bottom-0 left-0 right-0 h-12 flex\">\r\n                                <div className=\"flex-1\" style={{ backgroundColor: settings.brandColor || '#EF4444' }}></div>\r\n                                <div className=\"flex-1\" style={{ backgroundColor: settings.brandColor || '#EF4444', filter: 'brightness(0.9)' }}></div>\r\n                                <div className=\"flex-1\" style={{ backgroundColor: settings.brandColor || '#EF4444', filter: 'brightness(0.8)' }}></div>\r\n                                <div className=\"flex-1\" style={{ backgroundColor: settings.brandColor || '#EF4444', filter: 'brightness(0.7)' }}></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Print Styles */}\r\n            <style>{`\r\n                @media print {\r\n                    @page { size: A4; margin: 0; }\r\n                    body { margin: 0; background: white; }\r\n                    .no-print { display: none !important; }\r\n                    .printable-content {\r\n                        box-shadow: none !important;\r\n                        margin: 0 !important;\r\n                        width: 210mm !important;\r\n                        height: 297mm !important;\r\n                        position: absolute !important;\r\n                        top: 0 !important;\r\n                        left: 0 !important;\r\n                        overflow: hidden !important;\r\n                    }\r\n                }\r\n            `}</style>\r\n        </Layout>\r\n    );\r\n};\r\n\r\nexport default LetterheadCreator;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\pages\\LetterheadList.jsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadLetterheads` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\n  14 |\n  15 |     useEffect(() => {\n> 16 |         loadLetterheads();\n     |         ^^^^^^^^^^^^^^^ `loadLetterheads` accessed before it is declared\n  17 |     }, [searchTerm]);\n  18 |\n  19 |     const loadLetterheads = async () => {\n\n  17 |     }, [searchTerm]);\n  18 |\n> 19 |     const loadLetterheads = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 20 |         try {\n     | ^^^^^^^^^^^^^\n> 21 |             setLoading(true);\n     \n     | ^^^^^^^^^^^^^\n> 29 |         }\n     | ^^^^^^^^^^^^^\n> 30 |     };\n     | ^^^^^^^ `loadLetterheads` is declared here\n  31 |\n  32 |     const handleDelete = async (id) => {\n  33 |         if (!window.confirm('Delete this letterhead document? This cannot be undone.')) return;","line":16,"column":9,"nodeType":null,"endLine":16,"endColumn":24},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadLetterheads'. Either include it or remove the dependency array.","line":17,"column":8,"nodeType":"ArrayExpression","endLine":17,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [loadLetterheads, searchTerm]","fix":{"range":[642,654],"text":"[loadLetterheads, searchTerm]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":38,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":38,"endColumn":23}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport Layout from '../components/Layout/Layout';\r\nimport api from '../utils/api';\r\nimport { Plus, Search, FileText, Trash2, Printer, Edit } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\nimport { formatDate } from '../utils/date';\r\n\r\nconst LetterheadList = () => {\r\n    const navigate = useNavigate();\r\n    const [letterheads, setLetterheads] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n\r\n    useEffect(() => {\r\n        loadLetterheads();\r\n    }, [searchTerm]);\r\n\r\n    const loadLetterheads = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const { data } = await api.get(`/letterheads?search=${searchTerm}`);\r\n            setLetterheads(data);\r\n            setLoading(false);\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error('Failed to load letterheads');\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDelete = async (id) => {\r\n        if (!window.confirm('Delete this letterhead document? This cannot be undone.')) return;\r\n        try {\r\n            await api.delete(`/letterheads/${id}`);\r\n            toast.success('Deleted successfully');\r\n            loadLetterheads();\r\n        } catch (error) {\r\n            toast.error('Failed to delete');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Layout>\r\n            <div className=\"p-6\">\r\n                <div className=\"flex justify-between items-center mb-6\">\r\n                    <div>\r\n                        <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Letterheads</h1>\r\n                        <p className=\"text-gray-600 dark:text-gray-400 mt-1\">Manage your official correspondence</p>\r\n                    </div>\r\n                    <button\r\n                        onClick={() => navigate('/letterheads/create')}\r\n                        className=\"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition\"\r\n                    >\r\n                        <Plus className=\"w-5 h-5\" />\r\n                        <span>Create New</span>\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Search */}\r\n                <div className=\"relative mb-6\">\r\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-500 w-5 h-5\" />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search by subject, recipient...\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                        className=\"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                    />\r\n                </div>\r\n\r\n                {/* Table */}\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden\">\r\n                    {loading ? (\r\n                        <div className=\"text-center py-12 text-gray-500 dark:text-gray-400\">Loading...</div>\r\n                    ) : letterheads.length === 0 ? (\r\n                        <div className=\"text-center py-12 text-gray-500 dark:text-gray-400\">\r\n                            <FileText className=\"w-12 h-12 mx-auto mb-3 opacity-30\" />\r\n                            <p>No letterheads found.</p>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"overflow-x-auto\">\r\n                            <table className=\"w-full\">\r\n                                <thead className=\"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-700\">\r\n                                    <tr>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase\">Number</th>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase\">Date</th>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase\">Recipient</th>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase\">Subject</th>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase\">Actions</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody className=\"divide-y divide-gray-200 dark:divide-gray-700\">\r\n                                    {letterheads.map((doc) => (\r\n                                        <tr key={doc._id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition\">\r\n                                            <td className=\"px-6 py-4 font-medium text-gray-900 dark:text-white\">{doc.letterheadNo}</td>\r\n                                            <td className=\"px-6 py-4 text-gray-500 dark:text-gray-400\">{formatDate(doc.date)}</td>\r\n                                            <td className=\"px-6 py-4 text-gray-900 dark:text-white font-medium\">\r\n                                                {doc.recipient?.name || 'Unknown'}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-gray-600 dark:text-gray-300 truncate max-w-xs\">{doc.subject}</td>\r\n                                            <td className=\"px-6 py-4 flex items-center space-x-3\">\r\n                                                <button\r\n                                                    onClick={() => navigate(`/letterheads/edit/${doc._id}`)}\r\n                                                    className=\"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300\" title=\"Edit\"\r\n                                                >\r\n                                                    <Edit className=\"w-4 h-4\" />\r\n                                                </button>\r\n                                                <button\r\n                                                    onClick={() => navigate(`/letterheads/view/${doc._id}`)}\r\n                                                    className=\"text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200\" title=\"Print\"\r\n                                                >\r\n                                                    <Printer className=\"w-4 h-4\" />\r\n                                                </button>\r\n                                                <button\r\n                                                    onClick={() => handleDelete(doc._id)}\r\n                                                    className=\"text-red-500 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300\" title=\"Delete\"\r\n                                                >\r\n                                                    <Trash2 className=\"w-4 h-4\" />\r\n                                                </button>\r\n                                            </td>\r\n                                        </tr>\r\n                                    ))}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </Layout>\r\n    );\r\n};\r\n\r\nexport default LetterheadList;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\pages\\Login.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\pages\\Register.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\pages\\Settings.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'isAdmin' and 'navigate'. Either include them or remove the dependency array.","line":76,"column":8,"nodeType":"ArrayExpression","endLine":76,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [currentSettings, isAdmin, navigate]","fix":{"range":[3145,3162],"text":"[currentSettings, isAdmin, navigate]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":89,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":89,"endColumn":23},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":109,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":109,"endColumn":23},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":121,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":121,"endColumn":23},{"ruleId":"no-constant-condition","severity":2,"message":"Unexpected constant condition.","line":1031,"column":38,"nodeType":"Literal","messageId":"unexpected","endLine":1031,"endColumn":43}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useSettings } from '../context/SettingsContext';\r\nimport Layout from '../components/Layout/Layout';\r\nimport api from '../utils/api';\r\nimport {\r\n    Store, CreditCard, FileText, Smartphone,\r\n    Save, Upload, Info, X, Image, Layout as LayoutIcon\r\n} from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\nimport { QRCodeSVG } from 'qrcode.react';\r\n\r\nconst Settings = () => {\r\n    const navigate = useNavigate();\r\n    const { isAdmin } = useAuth();\r\n    const { settings: currentSettings, refreshSettings, updateSettings } = useSettings();\r\n    const [loading, setLoading] = useState(false);\r\n    const [activeTab, setActiveTab] = useState('general');\r\n\r\n    const [formData, setFormData] = useState({\r\n        shopName: '',\r\n        tagline: '',\r\n        address: '',\r\n        phone: '',\r\n        email: '',\r\n        gstNumber: '',\r\n        bankName: '',\r\n        accountNumber: '',\r\n        ifscCode: '',\r\n        bankBranch: '',\r\n        upiId: '',\r\n        termsAndConditions: '',\r\n        brandColor: '#2563EB',\r\n        primaryTextColor: '#2563EB',\r\n        themeColor: '#2563EB',\r\n        loginCardTextColor: '#FFFFFF',\r\n        roleBadge: 'ADMIN',\r\n        footerFontSize: 12,\r\n        footerFontFamily: 'sans-serif',\r\n        footerAlignment: 'center',\r\n        invoiceFooterText: ''\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (!isAdmin()) {\r\n            navigate('/dashboard');\r\n            toast.error('Access denied. Admin only.');\r\n            return;\r\n        }\r\n        if (currentSettings) {\r\n            setFormData({\r\n                shopName: currentSettings.shopName || '',\r\n                tagline: currentSettings.tagline || '',\r\n                address: currentSettings.address || '',\r\n                phone: currentSettings.phone || '',\r\n                email: currentSettings.email || '',\r\n                gstNumber: currentSettings.gstNumber || '',\r\n                bankName: currentSettings.bankName || '',\r\n                accountNumber: currentSettings.accountNumber || '',\r\n                ifscCode: currentSettings.ifscCode || '',\r\n                bankBranch: currentSettings.bankBranch || '',\r\n                upiId: currentSettings.upiId || '',\r\n                termsAndConditions: currentSettings.termsAndConditions || '',\r\n                brandColor: currentSettings.brandColor || '#2563EB',\r\n                primaryTextColor: currentSettings.primaryTextColor || '#2563EB',\r\n                themeColor: currentSettings.themeColor || '#2563EB',\r\n                loginCardTextColor: currentSettings.loginCardTextColor || '#FFFFFF',\r\n                roleBadge: currentSettings.roleBadge || 'ADMIN',\r\n                footerFontSize: currentSettings.footerFontSize || 12,\r\n                footerFontFamily: currentSettings.footerFontFamily || 'sans-serif',\r\n                footerAlignment: currentSettings.footerAlignment || 'center',\r\n                invoiceFooterText: currentSettings.invoiceFooterText || ''\r\n            });\r\n        }\r\n    }, [currentSettings]);\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n\r\n        try {\r\n            const result = await updateSettings(formData);\r\n            if (result.success) {\r\n                toast.success('Settings updated successfully');\r\n            } else {\r\n                toast.error(result.error);\r\n            }\r\n        } catch (error) {\r\n            toast.error('Failed to update settings');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleFileUpload = async (e, field) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n\r\n        const formDataUpload = new FormData();\r\n        formDataUpload.append(field, file);\r\n\r\n        try {\r\n            await api.put('/settings', formDataUpload, {\r\n                headers: { 'Content-Type': 'multipart/form-data' },\r\n            });\r\n            toast.success(`${field} uploaded successfully`);\r\n            refreshSettings();\r\n        } catch (error) {\r\n            toast.error(`Failed to upload ${field}`);\r\n        }\r\n    };\r\n\r\n    const handleRemoveFile = async (field) => {\r\n        if (!window.confirm('Are you sure you want to remove this image?')) return;\r\n\r\n        try {\r\n            await api.put('/settings', { [field]: null });\r\n            toast.success('Image removed successfully');\r\n            refreshSettings();\r\n        } catch (error) {\r\n            toast.error('Failed to remove image');\r\n        }\r\n    };\r\n\r\n    const tabs = [\r\n        { id: 'general', name: 'General', icon: Store },\r\n        { id: 'banking', name: 'Banking & QR', icon: CreditCard },\r\n        { id: 'invoice', name: 'Invoice Design', icon: FileText },\r\n        { id: 'appearance', name: 'App Appearance', icon: Smartphone },\r\n        { id: 'letterheadTemplate', name: 'Letterhead Design', icon: LayoutIcon },\r\n    ];\r\n\r\n    const colorPresets = [\r\n        '#2563EB', '#10B981', '#EF4444', '#8B5CF6',\r\n        '#F59E0B', '#06B6D4', '#F97316', '#EC4899'\r\n    ];\r\n\r\n    const darkColorPresets = [\r\n        '#1F2937', '#374151', '#4B5563', '#6B7280',\r\n        '#1E40AF', '#047857', '#B91C1C', '#5B21B6'\r\n    ];\r\n\r\n    return (\r\n        <Layout>\r\n            <div className=\"p-6\">\r\n                {/* Header */}\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                    <div className=\"flex items-center space-x-3\">\r\n                        <Store className=\"w-8 h-8 text-blue-600 dark:text-blue-400\" />\r\n                        <div>\r\n                            <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">Store Settings & Branding</h1>\r\n                            <p className=\"text-gray-600 dark:text-gray-400 mt-1\">Customize your store information and app appearance</p>\r\n                        </div>\r\n                    </div>\r\n                    <button\r\n                        onClick={handleSubmit}\r\n                        disabled={loading}\r\n                        className=\"flex items-center space-x-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors\"\r\n                    >\r\n                        <Save className=\"w-5 h-5\" />\r\n                        <span>{loading ? 'Saving...' : 'Save All Changes'}</span>\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Demo Mode Indicator */}\r\n                <div className=\"bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-400 p-4 mb-6 rounded-lg hidden\">\r\n                    <div className=\"flex items-center space-x-2\">\r\n                        <Info className=\"w-5 h-5 text-orange-600 dark:text-orange-400\" />\r\n                        <p className=\"text-sm text-orange-800 dark:text-orange-200\">\r\n                            <strong>Demo Mode:</strong> Settings saved to browser localStorage\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n                    {/* Left Side - Tabs and Forms */}\r\n                    <div className={activeTab === 'letterheadTemplate' ? \"lg:col-span-3\" : \"lg:col-span-2\"}>\r\n                        {/* Tabs */}\r\n                        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm mb-4 border border-gray-100 dark:border-gray-700\">\r\n                            <div className=\"border-b border-gray-200 dark:border-gray-700\">\r\n                                <nav className=\"flex space-x-1 px-4 overflow-x-auto scrollbar-hide\" aria-label=\"Tabs\">\r\n                                    {tabs.map((tab) => {\r\n                                        const Icon = tab.icon;\r\n                                        return (\r\n                                            <button\r\n                                                key={tab.id}\r\n                                                onClick={() => setActiveTab(tab.id)}\r\n                                                className={`flex items-center space-x-2 py-4 px-4 border-b-2 font-medium text-sm transition-colors whitespace-nowrap ${activeTab === tab.id\r\n                                                    ? 'border-blue-500 text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20'\r\n                                                    : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700/50'\r\n                                                    }`}\r\n                                            >\r\n                                                <Icon className=\"w-5 h-5 flex-shrink-0\" />\r\n                                                <span>{tab.name}</span>\r\n                                            </button>\r\n                                        );\r\n                                    })}\r\n                                </nav>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Tab Content */}\r\n                        <form onSubmit={handleSubmit}>\r\n                            <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 border border-gray-100 dark:border-gray-700\">\r\n                                {/* General Tab */}\r\n                                {activeTab === 'general' && (\r\n                                    <div className=\"space-y-4\">\r\n                                        <div>\r\n                                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                Store Name *\r\n                                            </label>\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                value={formData.shopName}\r\n                                                onChange={(e) => setFormData({ ...formData, shopName: e.target.value })}\r\n                                                className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                                required\r\n                                            />\r\n                                        </div>\r\n\r\n                                        <div>\r\n                                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                Tagline (Optional)\r\n                                            </label>\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                value={formData.tagline}\r\n                                                onChange={(e) => setFormData({ ...formData, tagline: e.target.value })}\r\n                                                className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                                placeholder=\"e.g., Best Deals in Tech\"\r\n                                            />\r\n                                        </div>\r\n\r\n                                        <div>\r\n                                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                Address\r\n                                            </label>\r\n                                            <textarea\r\n                                                value={formData.address}\r\n                                                onChange={(e) => setFormData({ ...formData, address: e.target.value })}\r\n                                                className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                                rows={3}\r\n                                                placeholder=\"Shop No. 12, Ground Floor&#10;Tech Plaza, MG Road&#10;Indore - 452001, MP\"\r\n                                            />\r\n                                        </div>\r\n\r\n                                        <div className=\"grid grid-cols-2 gap-4\">\r\n                                            <div>\r\n                                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                    Mobile Number\r\n                                                </label>\r\n                                                <input\r\n                                                    type=\"tel\"\r\n                                                    value={formData.phone}\r\n                                                    onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\r\n                                                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                                    placeholder=\"+91 98765 43210\"\r\n                                                />\r\n                                            </div>\r\n\r\n                                            <div>\r\n                                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                    Email\r\n                                                </label>\r\n                                                <input\r\n                                                    type=\"email\"\r\n                                                    value={formData.email}\r\n                                                    onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                                                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                                    placeholder=\"contact@yourbusiness.com\"\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                            <div>\r\n                                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                    GSTIN (Optional)\r\n                                                </label>\r\n                                                <input\r\n                                                    type=\"text\"\r\n                                                    value={formData.gstNumber}\r\n                                                    onChange={(e) => setFormData({ ...formData, gstNumber: e.target.value })}\r\n                                                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                                    placeholder=\"e.g., 22AAAAA0000A1Z5\"\r\n                                                />\r\n                                            </div>\r\n                                            <div>\r\n                                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                    Website (Optional)\r\n                                                </label>\r\n                                                <input\r\n                                                    type=\"text\"\r\n                                                    value={formData.website || ''}\r\n                                                    onChange={(e) => setFormData({ ...formData, website: e.target.value })}\r\n                                                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                                    placeholder=\"www.yourbusiness.com\"\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* Banking & QR Tab */}\r\n                                {activeTab === 'banking' && (\r\n                                    <div className=\"space-y-4\">\r\n                                        <div>\r\n                                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                Bank Details (Multi-line)\r\n                                            </label>\r\n                                            <textarea\r\n                                                defaultValue={`Bank Name: ${formData.bankName}\\nAccount No.: ${formData.accountNumber}\\nIFSC Code: ${formData.ifscCode}\\nBranch: ${formData.bankBranch}`}\r\n                                                onBlur={(e) => {\r\n                                                    const lines = e.target.value.split('\\n');\r\n                                                    setFormData({\r\n                                                        ...formData,\r\n                                                        bankName: lines[0]?.replace(/^Bank Name:\\s*/, '').trim() || '',\r\n                                                        accountNumber: lines[1]?.replace(/^Account No\\.?:\\s*/, '').trim() || '',\r\n                                                        ifscCode: lines[2]?.replace(/^IFSC Code:\\s*/, '').trim() || '',\r\n                                                        bankBranch: lines[3]?.replace(/^Branch:\\s*/, '').trim() || ''\r\n                                                    });\r\n                                                }}\r\n                                                className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                                rows={4}\r\n                                                placeholder=\"Bank Name: HDFC Bank&#10;Account No.: 1234567890&#10;IFSC Code: HDFC0001234&#10;Branch: MG Road, Indore\"\r\n                                            />\r\n                                            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n                                                This will appear at the bottom of your invoices. Edit freely and click outside to save changes.\r\n                                            </p>\r\n                                        </div>\r\n\r\n                                        <div>\r\n                                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                UPI ID (for QR Code)\r\n                                            </label>\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                value={formData.upiId}\r\n                                                onChange={(e) => setFormData({ ...formData, upiId: e.target.value })}\r\n                                                className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                                placeholder=\"yourstore@okicici\"\r\n                                            />\r\n                                            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n                                                QR code will be automatically generated on invoices\r\n                                            </p>\r\n                                        </div>\r\n\r\n                                        {/* QR Code Preview */}\r\n                                        {formData.upiId && (\r\n                                            <div className=\"mt-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-700\">\r\n                                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3\">\r\n                                                    UPI QR Code Preview\r\n                                                </label>\r\n                                                <div className=\"flex items-start space-x-4\">\r\n                                                    <div className=\"bg-white p-3 rounded-lg shadow-sm\">\r\n                                                        <QRCodeSVG\r\n                                                            value={`upi://pay?pa=${formData.upiId}&pn=${encodeURIComponent(formData.shopName || 'Store')}`}\r\n                                                            size={128}\r\n                                                            level=\"M\"\r\n                                                            includeMargin={true}\r\n                                                        />\r\n                                                    </div>\r\n                                                    <div className=\"flex-1\">\r\n                                                        <p className=\"text-sm text-gray-700 dark:text-gray-200 font-medium mb-2\">\r\n                                                            Scan to Pay: {formData.shopName || 'Your Store'}\r\n                                                        </p>\r\n                                                        <p className=\"text-xs text-gray-600 dark:text-gray-400 mb-1\">\r\n                                                            UPI ID: <span className=\"font-mono\">{formData.upiId}</span>\r\n                                                        </p>\r\n                                                        <p className=\"text-xs text-green-600 dark:text-green-400 mt-3\">\r\n                                                             This QR code will appear on all invoices\r\n                                                        </p>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* Invoice Design Tab */}\r\n                                {activeTab === 'invoice' && (\r\n                                    <div className=\"space-y-6\">\r\n                                        <div className=\"bg-purple-50 dark:bg-purple-900/20 border-l-4 border-purple-400 dark:border-purple-500 p-4 rounded-lg\">\r\n                                            <p className=\"text-sm text-purple-800 dark:text-purple-300\">\r\n                                                <strong>Customize Your Invoice Design</strong>\r\n                                                <br />\r\n                                                Control colors and branding that appear on all invoices\r\n                                            </p>\r\n                                        </div>\r\n\r\n                                        {/* Brand Color */}\r\n                                        <div>\r\n                                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                Brand Color (Invoice Theme)\r\n                                            </label>\r\n                                            <div className=\"flex items-center space-x-3\">\r\n                                                <input\r\n                                                    type=\"color\"\r\n                                                    value={formData.brandColor}\r\n                                                    onChange={(e) => setFormData({ ...formData, brandColor: e.target.value })}\r\n                                                    className=\"w-16 h-10 rounded cursor-pointer\"\r\n                                                />\r\n                                                <input\r\n                                                    type=\"text\"\r\n                                                    value={formData.brandColor}\r\n                                                    onChange={(e) => setFormData({ ...formData, brandColor: e.target.value })}\r\n                                                    className=\"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg w-32 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                                                />\r\n                                            </div>\r\n                                            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n                                                Used for invoice header, table headers, and GRAND TOTAL badge\r\n                                            </p>\r\n                                            <div className=\"flex flex-wrap gap-2 mt-3\">\r\n                                                <p className=\"text-xs text-gray-600 dark:text-gray-400 w-full\">Quick picks:</p>\r\n                                                {colorPresets.map((color) => (\r\n                                                    <button\r\n                                                        key={color}\r\n                                                        type=\"button\"\r\n                                                        onClick={() => setFormData({ ...formData, brandColor: color })}\r\n                                                        className=\"w-8 h-8 rounded border-2 border-gray-300 dark:border-gray-600 hover:border-gray-500 dark:hover:border-gray-400 transition\"\r\n                                                        style={{ backgroundColor: color }}\r\n                                                    />\r\n                                                ))}\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {/* Company Logo */}\r\n                                        <div>\r\n                                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                Company Logo\r\n                                            </label>\r\n                                            <div className=\"flex items-center space-x-4\">\r\n                                                {currentSettings?.logo && (\r\n                                                    <img\r\n                                                        src={currentSettings.logo.startsWith('http') ? currentSettings.logo : `http://localhost:5000${currentSettings.logo}`}\r\n                                                        alt=\"Logo\"\r\n                                                        className=\"w-16 h-16 object-contain border border-gray-200 dark:border-gray-700 rounded-lg p-2 bg-gray-50 dark:bg-gray-800\"\r\n                                                    />\r\n                                                )}\r\n                                                <label className=\"flex items-center space-x-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 cursor-pointer transition-colors\">\r\n                                                    <Upload className=\"w-5 h-5\" />\r\n                                                    <span>Upload Logo</span>\r\n                                                    <input\r\n                                                        type=\"file\"\r\n                                                        onChange={(e) => handleFileUpload(e, 'logo')}\r\n                                                        accept=\"image/*\"\r\n                                                        className=\"hidden\"\r\n                                                    />\r\n                                                </label>\r\n                                                {currentSettings?.logo && (\r\n                                                    <button\r\n                                                        onClick={() => handleRemoveFile('logo')}\r\n                                                        className=\"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors border border-red-200 dark:border-red-800\"\r\n                                                        title=\"Remove Logo\"\r\n                                                    >\r\n                                                        <X className=\"w-5 h-5\" />\r\n                                                    </button>\r\n                                                )}\r\n                                            </div>\r\n                                            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n                                                PNG, JPG, WEBP (max 2MB). Appears in invoice header.\r\n                                            </p>\r\n                                        </div>\r\n\r\n                                        {/* Letterhead Upload */}\r\n\r\n\r\n                                        {/* Primary Text Color */}\r\n                                        <div>\r\n                                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                Primary Text Color (for Invoice)\r\n                                            </label>\r\n                                            <div className=\"flex items-center space-x-3\">\r\n                                                <input\r\n                                                    type=\"color\"\r\n                                                    value={formData.primaryTextColor}\r\n                                                    onChange={(e) => setFormData({ ...formData, primaryTextColor: e.target.value })}\r\n                                                    className=\"w-16 h-10 rounded cursor-pointer\"\r\n                                                />\r\n                                                <input\r\n                                                    type=\"text\"\r\n                                                    value={formData.primaryTextColor}\r\n                                                    onChange={(e) => setFormData({ ...formData, primaryTextColor: e.target.value })}\r\n                                                    className=\"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg w-32 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                                                />\r\n                                            </div>\r\n                                            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n                                                Applied to invoice text elements. Choose dark colors for better readability.\r\n                                            </p>\r\n                                            <div className=\"flex flex-wrap gap-2 mt-3\">\r\n                                                <p className=\"text-xs text-gray-600 dark:text-gray-400 w-full\">Quick picks:</p>\r\n                                                {darkColorPresets.map((color) => (\r\n                                                    <button\r\n                                                        key={color}\r\n                                                        type=\"button\"\r\n                                                        onClick={() => setFormData({ ...formData, primaryTextColor: color })}\r\n                                                        className=\"w-8 h-8 rounded border-2 border-gray-300 dark:border-gray-600 hover:border-gray-500 dark:hover:border-gray-400 transition\"\r\n                                                        style={{ backgroundColor: color }}\r\n                                                    />\r\n                                                ))}\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {/* Digital Signature */}\r\n                                        <div>\r\n                                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                Digital Signature / Stamp\r\n                                            </label>\r\n                                            <div className=\"flex items-center space-x-4\">\r\n                                                {currentSettings?.digitalSignature ? (\r\n                                                    <img\r\n                                                        src={currentSettings.digitalSignature.startsWith('http') ? currentSettings.digitalSignature : `http://localhost:5000${currentSettings.digitalSignature}`}\r\n                                                        alt=\"Signature\"\r\n                                                        className=\"w-24 h-16 object-contain border border-gray-200 dark:border-gray-700 rounded-lg p-2 bg-gray-50 dark:bg-gray-800\"\r\n                                                    />\r\n                                                ) : (\r\n                                                    <div className=\"w-24 h-16 border border-gray-200 dark:border-gray-700 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-gray-700/50 text-gray-400 dark:text-gray-500\">\r\n                                                        <span className=\"font-serif italic text-lg\">Signed</span>\r\n                                                    </div>\r\n                                                )}\r\n                                                <label className=\"flex items-center space-x-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 cursor-pointer transition-colors\">\r\n                                                    <Upload className=\"w-5 h-5\" />\r\n                                                    <span>Upload Signature</span>\r\n                                                    <input\r\n                                                        type=\"file\"\r\n                                                        onChange={(e) => handleFileUpload(e, 'digitalSignature')}\r\n                                                        accept=\"image/*\"\r\n                                                        className=\"hidden\"\r\n                                                    />\r\n                                                </label>\r\n                                                {currentSettings?.digitalSignature && (\r\n                                                    <button\r\n                                                        onClick={() => handleRemoveFile('digitalSignature')}\r\n                                                        className=\"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors border border-red-200 dark:border-red-800\"\r\n                                                        title=\"Remove Signature\"\r\n                                                    >\r\n                                                        <X className=\"w-5 h-5\" />\r\n                                                    </button>\r\n                                                )}\r\n                                            </div>\r\n                                            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n                                                PNG with transparency recommended. Appears in invoice footer.\r\n                                            </p>\r\n                                        </div>\r\n\r\n                                        {/* Invoice Text Configuration */}\r\n                                        <div className=\"border-t border-gray-200 dark:border-gray-700 pt-6 mt-6\">\r\n                                            <h4 className=\"text-md font-medium text-gray-800 dark:text-gray-100 mb-4\">Invoice Text & Labels</h4>\r\n\r\n                                            <div className=\"space-y-4\">\r\n                                                <div>\r\n                                                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                        Terms & Conditions\r\n                                                    </label>\r\n                                                    <textarea\r\n                                                        value={formData.termsAndConditions || ''}\r\n                                                        onChange={(e) => setFormData({ ...formData, termsAndConditions: e.target.value })}\r\n                                                        className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                                        rows={3}\r\n                                                        placeholder=\"e.g. Goods once sold will not be taken back.\"\r\n                                                    />\r\n                                                </div>\r\n\r\n                                                <div>\r\n                                                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                        Footer Note\r\n                                                    </label>\r\n                                                    <input\r\n                                                        type=\"text\"\r\n                                                        value={formData.invoiceFooterText || ''}\r\n                                                        onChange={(e) => setFormData({ ...formData, invoiceFooterText: e.target.value })}\r\n                                                        className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                                        placeholder=\"e.g. Thank you for your business!\"\r\n                                                    />\r\n                                                </div>\r\n\r\n                                                {/* Footer Styling Controls */}\r\n                                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 p-4 bg-gray-50 dark:bg-gray-700/30 rounded-xl border border-gray-100 dark:border-gray-600\">\r\n                                                    <div>\r\n                                                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                            Footer Font Size: <span className=\"text-blue-600 font-mono\">{formData.footerFontSize}px</span>\r\n                                                        </label>\r\n                                                        <input\r\n                                                            type=\"range\"\r\n                                                            min=\"8\"\r\n                                                            max=\"24\"\r\n                                                            value={formData.footerFontSize}\r\n                                                            onChange={(e) => setFormData({ ...formData, footerFontSize: parseInt(e.target.value) })}\r\n                                                            className=\"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600\"\r\n                                                        />\r\n                                                    </div>\r\n\r\n                                                    <div>\r\n                                                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                            Footer Alignment\r\n                                                        </label>\r\n                                                        <div className=\"flex bg-white dark:bg-gray-800 p-1 rounded-lg border border-gray-200 dark:border-gray-600\">\r\n                                                            {['left', 'center', 'right'].map((align) => (\r\n                                                                <button\r\n                                                                    key={align}\r\n                                                                    type=\"button\"\r\n                                                                    onClick={() => setFormData({ ...formData, footerAlignment: align })}\r\n                                                                    className={`flex-1 py-1 text-xs font-medium capitalize rounded-md transition-all ${formData.footerAlignment === align\r\n                                                                        ? 'bg-blue-600 text-white shadow-sm'\r\n                                                                        : 'text-gray-500 hover:text-gray-700 dark:hover:text-gray-200'\r\n                                                                        }`}\r\n                                                                >\r\n                                                                    {align}\r\n                                                                </button>\r\n                                                            ))}\r\n                                                        </div>\r\n                                                    </div>\r\n\r\n                                                    <div className=\"md:col-span-2\">\r\n                                                        <label className=\"flex items-center cursor-pointer group\">\r\n                                                            <div className=\"relative\">\r\n                                                                <input\r\n                                                                    type=\"checkbox\"\r\n                                                                    className=\"sr-only\"\r\n                                                                    checked={formData.footerFontFamily === 'handwritten'}\r\n                                                                    onChange={(e) => setFormData({\r\n                                                                        ...formData,\r\n                                                                        footerFontFamily: e.target.checked ? 'handwritten' : 'sans-serif'\r\n                                                                    })}\r\n                                                                />\r\n                                                                <div className={`block w-10 h-6 rounded-full transition-colors ${formData.footerFontFamily === 'handwritten' ? 'bg-blue-600' : 'bg-gray-300 dark:bg-gray-600'}`}></div>\r\n                                                                <div className={`absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition-transform ${formData.footerFontFamily === 'handwritten' ? 'translate-x-4' : ''}`}></div>\r\n                                                            </div>\r\n                                                            <div className=\"ml-3 text-gray-700 dark:text-gray-300 font-medium\">\r\n                                                                Use Handwritten Font Style\r\n                                                                <span className=\"ml-2 text-xs text-gray-500 italic font-handwritten\">(Thank you for your business!)</span>\r\n                                                            </div>\r\n                                                        </label>\r\n                                                    </div>\r\n                                                </div>\r\n\r\n                                                <div>\r\n                                                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                        Authorized Signatory Label\r\n                                                    </label>\r\n                                                    <input\r\n                                                        type=\"text\"\r\n                                                        value={formData.authSignLabel || ''}\r\n                                                        onChange={(e) => setFormData({ ...formData, authSignLabel: e.target.value })}\r\n                                                        className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                                        placeholder=\"e.g. Authorized Signatory\"\r\n                                                    />\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n\r\n                                {/* App Appearance Tab */}\r\n                                {activeTab === 'appearance' && (\r\n                                    <div className=\"space-y-6\">\r\n                                        <div className=\"bg-purple-50 dark:bg-purple-900/20 border-l-4 border-purple-400 dark:border-purple-500 p-4 rounded-lg\">\r\n                                            <p className=\"text-sm text-purple-800 dark:text-purple-300\">\r\n                                                <strong>Customize App Theme</strong>\r\n                                                <br />\r\n                                                Personalize the look and feel of your application\r\n                                            </p>\r\n                                        </div>\r\n\r\n                                        <div>\r\n                                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                Primary Theme Color\r\n                                            </label>\r\n                                            <div className=\"flex items-center space-x-3\">\r\n                                                <input\r\n                                                    type=\"color\"\r\n                                                    value={formData.themeColor}\r\n                                                    onChange={(e) => setFormData({ ...formData, themeColor: e.target.value })}\r\n                                                    className=\"w-16 h-10 rounded cursor-pointer bg-transparent\"\r\n                                                />\r\n                                                <input\r\n                                                    type=\"text\"\r\n                                                    value={formData.themeColor}\r\n                                                    onChange={(e) => setFormData({ ...formData, themeColor: e.target.value })}\r\n                                                    className=\"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg w-32 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                                                />\r\n                                            </div>\r\n                                            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n                                                Changes buttons, links, sidebar active state, and login button\r\n                                            </p>\r\n                                            <div className=\"flex flex-wrap gap-2 mt-3\">\r\n                                                <p className=\"text-xs text-gray-600 dark:text-gray-400 w-full\">Quick picks:</p>\r\n                                                {colorPresets.map((color) => (\r\n                                                    <button\r\n                                                        key={color}\r\n                                                        type=\"button\"\r\n                                                        onClick={() => setFormData({ ...formData, themeColor: color })}\r\n                                                        className=\"w-8 h-8 rounded border-2 border-gray-300 dark:border-gray-600 hover:border-gray-500 dark:hover:border-gray-400 transition\"\r\n                                                        style={{ backgroundColor: color }}\r\n                                                    />\r\n                                                ))}\r\n                                            </div>\r\n                                        </div>\r\n\r\n\r\n\r\n\r\n\r\n                                        <hr />\r\n\r\n                                        <div>\r\n                                            <h3 className=\"text-lg font-semibold text-purple-900 dark:text-purple-300 mb-3\">User Profile Customization</h3>\r\n                                            <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">Personalize your profile picture and role badge</p>\r\n\r\n                                            <div className=\"space-y-4\">\r\n                                                <div>\r\n                                                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                        Profile Picture (Avatar)\r\n                                                    </label>\r\n                                                    <div className=\"flex items-center space-x-4\">\r\n                                                        {currentSettings?.profilePicture ? (\r\n                                                            <img\r\n                                                                src={currentSettings.profilePicture.startsWith('http') ? currentSettings.profilePicture : `http://localhost:5000${currentSettings.profilePicture}`}\r\n                                                                alt=\"Profile\"\r\n                                                                className=\"w-16 h-16 rounded-full object-cover border-2 border-gray-300 dark:border-gray-600\"\r\n                                                            />\r\n                                                        ) : (\r\n                                                            <div className=\"w-16 h-16 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center border-2 border-white dark:border-gray-700 shadow-md\">\r\n                                                                <span className=\"text-white text-2xl\"></span>\r\n                                                            </div>\r\n                                                        )}\r\n                                                        <label className=\"flex items-center space-x-2 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 cursor-pointer transition-colors\">\r\n                                                            <Upload className=\"w-5 h-5\" />\r\n                                                            <span>Upload Picture</span>\r\n                                                            <input\r\n                                                                type=\"file\"\r\n                                                                onChange={(e) => handleFileUpload(e, 'profilePicture')}\r\n                                                                accept=\"image/*\"\r\n                                                                className=\"hidden\"\r\n                                                            />\r\n                                                        </label>\r\n                                                        {currentSettings?.profilePicture && (\r\n                                                            <button\r\n                                                                onClick={() => handleRemoveFile('profilePicture')}\r\n                                                                className=\"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors border border-red-200 dark:border-red-800\"\r\n                                                                title=\"Remove Picture\"\r\n                                                            >\r\n                                                                <X className=\"w-5 h-5\" />\r\n                                                            </button>\r\n                                                        )}\r\n                                                    </div>\r\n                                                    <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n                                                        Upload a custom profile picture to replace the default icon in the sidebar. PNG, JPG, WEBP (max 1MB). Compressed & cropped to fit\r\n                                                    </p>\r\n                                                </div>\r\n\r\n                                                <div>\r\n                                                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                                        Role Title (Badge Text)\r\n                                                    </label>\r\n                                                    <input\r\n                                                        type=\"text\"\r\n                                                        value={formData.roleBadge}\r\n                                                        onChange={(e) => setFormData({ ...formData, roleBadge: e.target.value })}\r\n                                                        className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                                        placeholder=\"ADMIN\"\r\n                                                    />\r\n                                                    <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n                                                        Customize the text shown in your role badge (e.g., OWNER, BOSS, MANAGER, STAFF)\r\n                                                    </p>\r\n                                                    <div className=\"flex flex-wrap gap-2 mt-3\">\r\n                                                        <p className=\"text-xs text-gray-600 dark:text-gray-400 w-full\">Quick picks:</p>\r\n                                                        {['ADMIN', 'OWNER', 'BOSS', 'MANAGER', 'STAFF'].map((role) => (\r\n                                                            <button\r\n                                                                key={role}\r\n                                                                type=\"button\"\r\n                                                                onClick={() => setFormData({ ...formData, roleBadge: role })}\r\n                                                                className=\"px-3 py-1 text-xs font-semibold bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300 rounded-full hover:bg-purple-200 dark:hover:bg-purple-900/50 transition\"\r\n                                                            >\r\n                                                                {role}\r\n                                                            </button>\r\n                                                        ))}\r\n                                                    </div>\r\n                                                </div>\r\n\r\n\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {activeTab === 'letterheadTemplate' && (\r\n                                    <div className=\"flex flex-col lg:flex-row gap-6\">\r\n                                        <div className=\"lg:w-1/2 space-y-6\">\r\n                                            <div className=\"bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm\">\r\n                                                <h3 className=\"text-lg font-semibold mb-4 text-gray-900 dark:text-white\">A4 Page Layout (Global Template)</h3>\r\n                                                <div className=\"grid grid-cols-2 gap-4\">\r\n                                                    {['Top', 'Bottom', 'Left', 'Right'].map(side => (\r\n                                                        <div key={side}>\r\n                                                            <label className=\"text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase\">Margin {side} (mm)</label>\r\n                                                            <input\r\n                                                                type=\"range\" min=\"0\" max=\"50\" step=\"1\"\r\n                                                                value={formData.letterheadConfig?.[`margin${side}`] || 20}\r\n                                                                onChange={(e) => setFormData({\r\n                                                                    ...formData,\r\n                                                                    letterheadConfig: { ...formData.letterheadConfig, [`margin${side}`]: parseInt(e.target.value) }\r\n                                                                })}\r\n                                                                className=\"w-full mt-1 accent-blue-600\"\r\n                                                            />\r\n                                                            <div className=\"text-right text-xs text-blue-600 dark:text-blue-400 font-mono\">{formData.letterheadConfig?.[`margin${side}`] || 20}mm</div>\r\n                                                        </div>\r\n                                                    ))}\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <div className=\"bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm\">\r\n                                                <h3 className=\"text-lg font-semibold mb-4 text-gray-900 dark:text-white\">Branding & Watermark</h3>\r\n                                                <div className=\"space-y-4\">\r\n                                                    <div>\r\n                                                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Logo Position</label>\r\n                                                        <div className=\"flex bg-gray-100 dark:bg-gray-700 p-1 rounded-lg\">\r\n                                                            {['left', 'center', 'right'].map(pos => (\r\n                                                                <button\r\n                                                                    key={pos}\r\n                                                                    type=\"button\"\r\n                                                                    onClick={() => setFormData({ ...formData, letterheadConfig: { ...formData.letterheadConfig, logoPosition: pos } })}\r\n                                                                    className={`flex-1 py-1.5 text-xs font-medium capitalize rounded-md transition-all ${(formData.letterheadConfig?.logoPosition || 'left') === pos\r\n                                                                        ? 'bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-300 shadow-sm'\r\n                                                                        : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200'\r\n                                                                        }`}\r\n                                                                >\r\n                                                                    {pos}\r\n                                                                </button>\r\n                                                            ))}\r\n                                                        </div>\r\n                                                    </div>\r\n\r\n                                                    <div>\r\n                                                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Watermark Text</label>\r\n                                                        <input\r\n                                                            type=\"text\"\r\n                                                            value={formData.letterheadConfig?.watermarkText || ''}\r\n                                                            onChange={(e) => {\r\n                                                                const newText = e.target.value;\r\n                                                                // Reset opacity and size when watermark text is cleared\r\n                                                                if (newText === '') {\r\n                                                                    setFormData({\r\n                                                                        ...formData,\r\n                                                                        letterheadConfig: {\r\n                                                                            ...formData.letterheadConfig,\r\n                                                                            watermarkText: '',\r\n                                                                            watermarkOpacity: 0.1,\r\n                                                                            watermarkSize: 100\r\n                                                                        }\r\n                                                                    });\r\n                                                                } else {\r\n                                                                    setFormData({\r\n                                                                        ...formData,\r\n                                                                        letterheadConfig: {\r\n                                                                            ...formData.letterheadConfig,\r\n                                                                            watermarkText: newText\r\n                                                                        }\r\n                                                                    });\r\n                                                                }\r\n                                                            }}\r\n                                                            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                                                            placeholder=\"e.g. OFFICIAL / DRAFT\"\r\n                                                        />\r\n                                                    </div>\r\n\r\n                                                    <div className=\"grid grid-cols-2 gap-4\">\r\n                                                        <div>\r\n                                                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Opacity</label>\r\n                                                            <input\r\n                                                                type=\"range\" min=\"0\" max=\"1\" step=\"0.05\"\r\n                                                                value={formData.letterheadConfig?.watermarkOpacity || 0.1}\r\n                                                                onChange={(e) => setFormData({ ...formData, letterheadConfig: { ...formData.letterheadConfig, watermarkOpacity: parseFloat(e.target.value) } })}\r\n                                                                className=\"w-full accent-blue-600\"\r\n                                                            />\r\n                                                            <div className=\"text-right text-xs text-gray-500 dark:text-gray-400\">{Math.round((formData.letterheadConfig?.watermarkOpacity || 0.1) * 100)}%</div>\r\n                                                        </div>\r\n                                                        <div>\r\n                                                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Size</label>\r\n                                                            <input\r\n                                                                type=\"range\" min=\"40\" max=\"250\" step=\"10\"\r\n                                                                value={formData.letterheadConfig?.watermarkSize || 100}\r\n                                                                onChange={(e) => setFormData({ ...formData, letterheadConfig: { ...formData.letterheadConfig, watermarkSize: parseInt(e.target.value) } })}\r\n                                                                className=\"w-full accent-blue-600\"\r\n                                                            />\r\n                                                            <div className=\"text-right text-xs text-gray-500 dark:text-gray-400\">{formData.letterheadConfig?.watermarkSize || 100}px</div>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        <div className=\"lg:w-1/2\">\r\n                                            <div className=\"sticky top-6\">\r\n                                                <div className=\"flex items-center space-x-2 mb-2\">\r\n                                                    <LayoutIcon className=\"w-4 h-4 text-blue-600 dark:text-blue-400\" />\r\n                                                    <h3 className=\"text-sm font-semibold text-gray-900 dark:text-white\">Live A4 Preview</h3>\r\n                                                </div>\r\n                                                <div className=\"bg-gray-200 dark:bg-gray-900 p-4 rounded-xl overflow-auto flex justify-center h-[600px] border border-gray-200 dark:border-gray-700\">\r\n                                                    <div\r\n                                                        className=\"bg-white shadow-lg relative transition-all duration-300 origin-top\"\r\n                                                        style={{\r\n                                                            width: '210mm',\r\n                                                            minHeight: '297mm',\r\n                                                            transform: 'scale(0.5)',\r\n                                                            border: formData.letterheadConfig?.showBorder ? `1px solid ${formData.letterheadConfig?.borderColor}` : 'none'\r\n                                                        }}\r\n                                                    >\r\n                                                        {formData.letterheadConfig?.watermarkText && (\r\n                                                            <div className=\"absolute inset-0 flex items-center justify-center z-0 pointer-events-none overflow-hidden\">\r\n                                                                <div\r\n                                                                    className=\"font-bold text-gray-900 transform -rotate-45 whitespace-nowrap select-none\"\r\n                                                                    style={{\r\n                                                                        opacity: formData.letterheadConfig?.watermarkOpacity || 0.1,\r\n                                                                        fontSize: `${formData.letterheadConfig?.watermarkSize || 100}px`\r\n                                                                    }}\r\n                                                                >\r\n                                                                    {formData.letterheadConfig.watermarkText}\r\n                                                                </div>\r\n                                                            </div>\r\n                                                        )}\r\n\r\n                                                        <div className=\"relative z-10 flex flex-col h-full\"\r\n                                                            style={{\r\n                                                                paddingTop: `${formData.letterheadConfig?.marginTop || 20}mm`,\r\n                                                                paddingBottom: `${formData.letterheadConfig?.marginBottom || 20}mm`,\r\n                                                                paddingLeft: `${formData.letterheadConfig?.marginLeft || 20}mm`,\r\n                                                                paddingRight: `${formData.letterheadConfig?.marginRight || 20}mm`,\r\n                                                            }}\r\n                                                        >\r\n                                                            {/* Liceria Header */}\r\n                                                            <div className=\"flex justify-between items-start mb-4\">\r\n                                                                {/* Branding (Left) */}\r\n                                                                <div className=\"flex flex-col items-start\">\r\n                                                                    <div className=\"flex items-center gap-3 mb-2\">\r\n                                                                        {/* Logo Icon (Reused from Invoice Preview if no real logo) */}\r\n                                                                        {currentSettings?.logo && (\r\n                                                                            <img src={currentSettings.logo} className=\"h-12 w-auto object-contain\" alt=\"Logo\" />\r\n                                                                        )}\r\n                                                                        <div>\r\n                                                                            <h1 className=\"text-2xl font-bold text-gray-800 uppercase tracking-wide leading-none\">{formData.shopName || ''}</h1>\r\n                                                                            <p className=\"text-xs text-gray-500 tracking-[0.2em]\">{formData.tagline || ''}</p>\r\n                                                                        </div>\r\n                                                                    </div>\r\n                                                                </div>\r\n\r\n                                                                {/* Contact Info (Right) */}\r\n                                                                <div className=\"text-right text-[10px] text-gray-600 leading-tight\">\r\n                                                                    <div className=\"font-semibold text-gray-800\">\r\n                                                                        {formData.address ? (\r\n                                                                            <>\r\n                                                                                <p>{formData.address.split('\\n')[0]}</p>\r\n                                                                                <p>{formData.address.split('\\n')[1]}</p>\r\n                                                                            </>\r\n                                                                        ) : null}\r\n                                                                    </div>\r\n                                                                    {formData.phone && (\r\n                                                                        <p className=\"mt-1 flex items-center justify-end gap-1\">\r\n                                                                            {formData.phone} <span className=\"text-[8px] bg-red-500 text-white rounded-full p-0.5\"></span>\r\n                                                                        </p>\r\n                                                                    )}\r\n                                                                    {formData.email && (\r\n                                                                        <p className=\"flex items-center justify-end gap-1\">\r\n                                                                            {formData.email} <span className=\"text-[8px] bg-red-500 text-white rounded-full p-0.5\"></span>\r\n                                                                        </p>\r\n                                                                    )}\r\n                                                                    {formData.website && (\r\n                                                                        <p className=\"flex items-center justify-end gap-1\">\r\n                                                                            {formData.website} <span className=\"text-[8px] bg-red-500 text-white rounded-full p-0.5\"></span>\r\n                                                                        </p>\r\n                                                                    )}\r\n                                                                    {formData.gstNumber && (\r\n                                                                        <p className=\"flex items-center justify-end gap-1 mt-1\">\r\n                                                                            GSTIN: {formData.gstNumber}\r\n                                                                        </p>\r\n                                                                    )}\r\n                                                                </div>\r\n                                                            </div>\r\n\r\n                                                            {/* Graphical Separator - Red/Black Line */}\r\n                                                            <div className=\"w-full flex h-1.5 mb-8\">\r\n                                                                <div className=\"w-1/3\" style={{ backgroundColor: formData.brandColor || '#EF4444' }}></div>\r\n                                                                <div className=\"flex-1 bg-gray-900\"></div>\r\n                                                            </div>\r\n\r\n                                                            {/* Content Placeholder */}\r\n                                                            <div className=\"space-y-4 flex-1\">\r\n                                                                <div className=\"h-4 bg-gray-100 w-1/3 mb-8\"></div>\r\n                                                                <div className=\"space-y-2\">\r\n                                                                    <div className=\"h-4 bg-gray-100 w-full\"></div>\r\n                                                                    <div className=\"h-4 bg-gray-100 w-full\"></div>\r\n                                                                    <div className=\"h-4 bg-gray-100 w-5/6\"></div>\r\n                                                                    <div className=\"h-4 bg-gray-100 w-full\"></div>\r\n                                                                </div>\r\n                                                            </div>\r\n\r\n                                                            {/* Footer - 4 Color Blocks */}\r\n                                                            <div className=\"absolute bottom-0 left-0 right-0 h-8 flex\">\r\n                                                                <div className=\"flex-1\" style={{ backgroundColor: formData.brandColor || '#EF4444' }}></div>\r\n                                                                <div className=\"flex-1\" style={{ backgroundColor: formData.brandColor || '#EF4444', filter: 'brightness(0.9)' }}></div>\r\n                                                                <div className=\"flex-1\" style={{ backgroundColor: formData.brandColor || '#EF4444', filter: 'brightness(0.8)' }}></div>\r\n                                                                <div className=\"flex-1\" style={{ backgroundColor: formData.brandColor || '#EF4444', filter: 'brightness(0.7)' }}></div>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n\r\n                    {/* Right Side - Live Invoice Preview */}\r\n                    {activeTab !== 'letterheadTemplate' && (\r\n                        <div className=\"lg:col-span-1\">\r\n                            <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sticky top-6 border border-gray-100 dark:border-gray-700\">\r\n                                <div className=\"flex items-center space-x-2 mb-2\">\r\n                                    <FileText className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\r\n                                    <h3 className=\"text-sm font-semibold text-gray-900 dark:text-white\">Live Invoice Preview</h3>\r\n                                </div>\r\n                                <p className=\"text-xs text-gray-600 dark:text-gray-400 mb-4\">See your design changes in real-time</p>\r\n\r\n                                {/* Mini Invoice Preview */}\r\n                                <div className=\"bg-white shadow-lg rounded-lg overflow-hidden border text-xs\">\r\n                                    {/* Header - Modern Design */}\r\n                                    {false ? (\r\n                                        <div className=\"w-full\">\r\n                                            <img\r\n                                                src={currentSettings.letterhead.startsWith('http') ? currentSettings.letterhead : `http://localhost:5000${currentSettings.letterhead}`}\r\n                                                alt=\"Letterhead\"\r\n                                                className=\"w-full h-auto object-contain\"\r\n                                            />\r\n                                        </div>\r\n                                    ) : (\r\n                                        <div className=\"p-4 bg-white\">\r\n                                            <div className=\"flex justify-between items-start mb-2\">\r\n                                                {/* Left: Branding */}\r\n                                                <div className=\"flex items-center gap-3\">\r\n                                                    {currentSettings?.logo && (\r\n                                                        <img src={currentSettings.logo.startsWith('http') ? currentSettings.logo : `http://localhost:5000${currentSettings.logo}`} className=\"h-10 w-auto object-contain\" alt=\"Logo\" />\r\n                                                    )}\r\n                                                    <div>\r\n                                                        <h4 className=\"text-sm font-bold uppercase tracking-wider text-gray-800 leading-tight\">\r\n                                                            {formData.shopName || ''}\r\n                                                        </h4>\r\n                                                        <p className=\"text-[9px] text-gray-500 tracking-[0.2em]\">\r\n                                                            {formData.tagline || ''}\r\n                                                        </p>\r\n                                                    </div>\r\n                                                </div>\r\n\r\n                                                {/* Right: Contact Info */}\r\n                                                <div className=\"text-right\">\r\n                                                    <div className=\"text-[9px] text-gray-600 space-y-0.5 font-medium\">\r\n                                                        {formData.address ? (\r\n                                                            <>\r\n                                                                <p>{formData.address.split(',')[0]}</p>\r\n                                                                <p>{formData.address.split(',')[1]}</p>\r\n                                                            </>\r\n                                                        ) : null}\r\n\r\n                                                        {formData.phone && (\r\n                                                            <div className=\"flex items-center justify-end gap-1.5 mt-1\">\r\n                                                                <span>{formData.phone}</span>\r\n                                                                <span className=\"text-[8px]\" style={{ color: formData.brandColor || '#EF4444' }}></span>\r\n                                                            </div>\r\n                                                        )}\r\n                                                        {formData.email && (\r\n                                                            <div className=\"flex items-center justify-end gap-1.5\">\r\n                                                                <span>{formData.email}</span>\r\n                                                                <span className=\"text-[8px]\" style={{ color: formData.brandColor || '#EF4444' }}></span>\r\n                                                            </div>\r\n                                                        )}\r\n                                                        {formData.website && (\r\n                                                            <div className=\"flex items-center justify-end gap-1.5\">\r\n                                                                <span>{formData.website}</span>\r\n                                                                <span className=\"text-[8px]\" style={{ color: formData.brandColor || '#EF4444' }}></span>\r\n                                                            </div>\r\n                                                        )}\r\n                                                        {formData.gstNumber && (\r\n                                                            <div className=\"flex items-center justify-end gap-1.5 mt-1\">\r\n                                                                <span className=\"text-[8px] text-gray-600\">GSTIN: {formData.gstNumber}</span>\r\n                                                            </div>\r\n                                                        )}\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            {/* Custom Divider Line */}\r\n                                            <div className=\"flex items-center mt-2 mb-1\">\r\n                                                <div className=\"h-1.5 rounded-l-full w-1/3\" style={{ backgroundColor: formData.brandColor || '#EF4444' }}></div>\r\n                                                <div className=\"h-0.5 bg-gray-800 w-2/3 rounded-r-full\"></div>\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n\r\n\r\n                                    {/* From/To Section */}\r\n                                    <div className=\"p-3 grid grid-cols-2 gap-3 border-b\">\r\n                                        <div>\r\n                                            <div className=\"text-[8px] font-semibold mb-1\" style={{ color: formData.primaryTextColor || '#1F2937' }}>From:</div>\r\n                                            <p className=\"text-[10px] font-semibold\" style={{ color: formData.primaryTextColor || '#1F2937' }}>{formData.shopName || 'Your Shop'}</p>\r\n                                            <p className=\"text-[9px] text-gray-700 leading-tight mt-0.5\">\r\n                                                {formData.address || 'Shop Address'}\r\n                                            </p>\r\n                                            <p className=\"text-[9px] text-gray-700\">{formData.phone || 'Phone Number'}</p>\r\n                                            {formData.gstin && (\r\n                                                <p className=\"text-[8px] text-gray-600 mt-0.5\">GSTIN: {formData.gstin}</p>\r\n                                            )}\r\n                                        </div>\r\n                                        <div>\r\n                                            <div className=\"text-[8px] font-semibold mb-1\" style={{ color: formData.primaryTextColor || '#1F2937' }}>To:</div>\r\n                                            <p className=\"text-[10px] font-semibold\" style={{ color: formData.primaryTextColor || '#1F2937' }}>Demo Customer</p>\r\n                                            <p className=\"text-[9px] text-gray-700\">9876543210</p>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Items Table */}\r\n                                    <div className=\"p-3\">\r\n                                        <table className=\"w-full text-[9px]\">\r\n                                            <thead style={{ backgroundColor: formData.brandColor || '#3B82F6' }}>\r\n                                                <tr className=\"text-white\">\r\n                                                    <th className=\"py-1.5 px-2 text-left font-semibold\">#</th>\r\n                                                    <th className=\"py-1.5 px-2 text-left font-semibold\">Item</th>\r\n                                                    <th className=\"py-1.5 px-2 text-center font-semibold\">Qty</th>\r\n                                                    <th className=\"py-1.5 px-2 text-right font-semibold\">Total</th>\r\n                                                </tr>\r\n                                            </thead>\r\n                                            <tbody className=\"divide-y divide-gray-200\">\r\n                                                <tr>\r\n                                                    <td className=\"py-2 px-2 text-gray-600\">1</td>\r\n                                                    <td className=\"py-2 px-2 font-medium\" style={{ color: formData.primaryTextColor || '#1F2937' }}>Sample Product 1</td>\r\n                                                    <td className=\"py-2 px-2 text-center text-gray-700\">2</td>\r\n                                                    <td className=\"py-2 px-2 text-right font-medium\" style={{ color: formData.primaryTextColor || '#1F2937' }}>2,000.00</td>\r\n                                                </tr>\r\n                                                <tr>\r\n                                                    <td className=\"py-2 px-2 text-gray-600\">2</td>\r\n                                                    <td className=\"py-2 px-2 font-medium\" style={{ color: formData.primaryTextColor || '#1F2937' }}>Sample Product 2</td>\r\n                                                    <td className=\"py-2 px-2 text-center text-gray-700\">1</td>\r\n                                                    <td className=\"py-2 px-2 text-right font-medium\" style={{ color: formData.primaryTextColor || '#1F2937' }}>500.00</td>\r\n                                                </tr>\r\n                                            </tbody>\r\n                                        </table>\r\n                                    </div>\r\n\r\n                                    {/* Totals Section - Right Aligned */}\r\n                                    <div className=\"p-3 border-t flex justify-end\">\r\n                                        <div className=\"w-48 space-y-0.5 text-[9px]\">\r\n                                            <div className=\"flex justify-between\" style={{ color: formData.primaryTextColor || '#374151' }}>\r\n                                                <span>Subtotal:</span>\r\n                                                <span className=\"font-medium\">2,500.00</span>\r\n                                            </div>\r\n                                            <div className=\"flex justify-between\" style={{ color: formData.primaryTextColor || '#374151' }}>\r\n                                                <span>Total GST:</span>\r\n                                                <span className=\"font-medium\">450.00</span>\r\n                                            </div>\r\n                                            <div className=\"flex justify-between font-bold text-white p-1.5 rounded mt-1.5\"\r\n                                                style={{ backgroundColor: formData.brandColor || '#3B82F6' }}>\r\n                                                <span className=\"text-[10px] uppercase tracking-wide\">GRAND TOTAL:</span>\r\n                                                <span className=\"text-[11px]\">2,950.00</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Footer Section */}\r\n                                    <div className=\"p-3 border-t bg-gray-50\">\r\n                                        <div className=\"grid grid-cols-2 gap-3\">\r\n                                            {/* Left: QR Code, Notes, Bank Details */}\r\n                                            <div className=\"space-y-2\">\r\n                                                {/* QR Code */}\r\n                                                {formData.upiId && (\r\n                                                    <div className=\"flex flex-col items-start\">\r\n                                                        <QRCodeSVG\r\n                                                            value={`upi://pay?pa=${formData.upiId}&pn=${encodeURIComponent(formData.shopName || 'Store')}`}\r\n                                                            size={60}\r\n                                                            level=\"M\"\r\n                                                        />\r\n                                                        <div className=\"text-[7px] text-gray-500 mt-0.5\">Scan to Pay</div>\r\n                                                    </div>\r\n                                                )}\r\n\r\n                                                {/* Notes */}\r\n                                                <div className=\"text-[8px] text-gray-700 leading-relaxed whitespace-pre-line\">\r\n                                                    <p className=\"font-semibold mb-0.5\" style={{ color: formData.primaryTextColor || '#1F2937' }}>Notes:</p>\r\n                                                    {formData.termsAndConditions || ' Goods once sold will not be taken back\\n Payment due within 30 days'}\r\n                                                </div>\r\n                                                {formData.invoiceFooterText && (\r\n                                                    <div\r\n                                                        className={`mt-1 ${formData.footerFontFamily === 'handwritten' ? 'font-handwritten' : 'font-medium'} ${formData.footerAlignment === 'center' ? 'text-center' : formData.footerAlignment === 'right' ? 'text-right' : 'text-left'}`}\r\n                                                        style={{ fontSize: `${formData.footerFontSize * 0.7}px`, color: '#6B7280' }}\r\n                                                    >\r\n                                                        {formData.invoiceFooterText}\r\n                                                    </div>\r\n                                                )}\r\n\r\n                                                {/* Bank Details */}\r\n                                                {(formData.bankName || formData.accountNumber) && (\r\n                                                    <div className=\"text-[8px]\">\r\n                                                        <p className=\"font-semibold mb-0.5\" style={{ color: formData.primaryTextColor || '#1F2937' }}>Bank Details:</p>\r\n                                                        <div className=\"text-gray-700 leading-tight\">\r\n                                                            {formData.bankName && <p>{formData.bankName}</p>}\r\n                                                            {formData.accountNumber && <p>A/C: {formData.accountNumber}</p>}\r\n                                                            {formData.ifscCode && <p>IFSC: {formData.ifscCode}</p>}\r\n                                                        </div>\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n\r\n                                            {/* Right: Signature */}\r\n                                            <div className=\"flex flex-col items-end justify-end\">\r\n                                                {currentSettings?.digitalSignature ? (\r\n                                                    <>\r\n                                                        <img\r\n                                                            src={currentSettings.digitalSignature.startsWith('http') ? currentSettings.digitalSignature : `http://localhost:5000${currentSettings.digitalSignature}`}\r\n                                                            alt=\"Signature\"\r\n                                                            className=\"w-24 h-12 object-contain mb-1\"\r\n                                                        />\r\n                                                        <div className=\"text-[8px] font-medium text-gray-800 border-t border-gray-400 pt-0.5\">\r\n                                                            {formData.authSignLabel || 'Authorized Signatory'}\r\n                                                        </div>\r\n                                                    </>\r\n                                                ) : (\r\n                                                    <div className=\"flex flex-col items-end opacity-50\">\r\n                                                        <div className=\"w-20 h-10 flex items-center justify-center border border-dashed border-gray-300 rounded mb-1 bg-gray-50\">\r\n                                                            <span className=\"font-serif italic text-[10px] text-gray-500\">Signed</span>\r\n                                                        </div>\r\n                                                        <div className=\"text-[8px] font-medium text-gray-800 border-t border-gray-400 pt-0.5 w-full text-right\">\r\n                                                            {formData.authSignLabel || 'Authorized Signatory'}\r\n                                                        </div>\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n\r\n                                    {/* Decorative Footer Bar */}\r\n                                    <div className=\"flex h-3 border-t border-white\">\r\n                                        <div className=\"w-1/4 h-full\" style={{ backgroundColor: formData.brandColor || '#EF4444' }}></div>\r\n                                        <div className=\"w-1/4 h-full opacity-80\" style={{ backgroundColor: formData.brandColor || '#EF4444' }}></div>\r\n                                        <div className=\"w-1/4 h-full opacity-60\" style={{ backgroundColor: formData.brandColor || '#EF4444' }}></div>\r\n                                        <div className=\"w-1/4 h-full opacity-40\" style={{ backgroundColor: formData.brandColor || '#EF4444' }}></div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Tip */}\r\n                                <div className=\"mt-4 text-xs text-blue-700 bg-blue-50 rounded p-2.5 border border-blue-200\">\r\n                                    <span className=\"font-semibold\"> Live Preview:</span> Changes to brand color and signature update instantly!\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </Layout>\r\n    );\r\n};\r\n\r\nexport default Settings;\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\pages\\SupplierLedger.jsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadData` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\n  29 |\n  30 |     useEffect(() => {\n> 31 |         loadData();\n     |         ^^^^^^^^ `loadData` accessed before it is declared\n  32 |     }, [id]);\n  33 |\n  34 |     const loadData = async () => {\n\n  32 |     }, [id]);\n  33 |\n> 34 |     const loadData = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 35 |         try {\n     | ^^^^^^^^^^^^^\n> 36 |             setLoading(true);\n     \n     | ^^^^^^^^^^^^^\n> 48 |         }\n     | ^^^^^^^^^^^^^\n> 49 |     };\n     | ^^^^^^^ `loadData` is declared here\n  50 |\n  51 |     const handleRecalculate = async () => {\n  52 |         try {","line":31,"column":9,"nodeType":null,"endLine":31,"endColumn":17},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":32,"column":8,"nodeType":"ArrayExpression","endLine":32,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [id, loadData]","fix":{"range":[1113,1117],"text":"[id, loadData]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":56,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":56,"endColumn":23}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport Layout from '../components/Layout/Layout';\r\nimport api from '../utils/api';\r\nimport { formatINR } from '../utils/currency';\r\nimport { formatDate } from '../utils/date';\r\nimport { ArrowLeft, RefreshCw, Printer, Plus, X } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst SupplierLedger = () => {\r\n    const { id } = useParams();\r\n    const navigate = useNavigate();\r\n    const [supplier, setSupplier] = useState(null);\r\n    const [ledger, setLedger] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [showPaymentModal, setShowPaymentModal] = useState(false);\r\n    const [showPurchaseModal, setShowPurchaseModal] = useState(false);\r\n    const [payment, setPayment] = useState({\r\n        amount: '',\r\n        method: 'Cash',\r\n        notes: ''\r\n    });\r\n    const [purchase, setPurchase] = useState({\r\n        amount: '',\r\n        billNo: '',\r\n        notes: '',\r\n        billFile: null\r\n    });\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, [id]);\r\n\r\n    const loadData = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const [supplierRes, ledgerRes] = await Promise.all([\r\n                api.get(`/suppliers/${id}`),\r\n                api.get(`/supplier-ledger/${id}`)\r\n            ]);\r\n            setSupplier(supplierRes.data);\r\n            setLedger(ledgerRes.data);\r\n            setLoading(false);\r\n        } catch (error) {\r\n            console.error('Error loading supplier ledger:', error);\r\n            toast.error('Failed to load supplier ledger');\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleRecalculate = async () => {\r\n        try {\r\n            await api.post(`/supplier-ledger/recalculate/${id}`);\r\n            toast.success('Ledger recalculated');\r\n            loadData();\r\n        } catch (error) {\r\n            toast.error('Recalculation failed');\r\n        }\r\n    };\r\n\r\n    const handleRecordPayment = async () => {\r\n        if (!payment.amount || payment.amount <= 0) {\r\n            return toast.error('Please enter a valid amount');\r\n        }\r\n\r\n        try {\r\n            await api.post('/payments/supplier', {\r\n                supplierId: id,\r\n                amount: parseFloat(payment.amount),\r\n                method: payment.method,\r\n                notes: payment.notes || 'Payment to supplier'\r\n            });\r\n\r\n            toast.success('Payment recorded successfully');\r\n            setShowPaymentModal(false);\r\n            setPayment({ amount: '', method: 'Cash', notes: '' });\r\n            loadData();\r\n        } catch (error) {\r\n            console.error('Payment error:', error);\r\n            toast.error(error.response?.data?.message || 'Failed to record payment');\r\n        }\r\n    };\r\n\r\n    const handleRecordPurchase = async () => {\r\n        if (!purchase.amount || purchase.amount <= 0) {\r\n            return toast.error('Please enter a valid amount');\r\n        }\r\n\r\n        try {\r\n            const formData = new FormData();\r\n            formData.append('supplierId', id);\r\n            formData.append('amount', parseFloat(purchase.amount));\r\n            formData.append('billNo', purchase.billNo || '');\r\n            formData.append('notes', purchase.notes || 'Purchase recorded');\r\n            if (purchase.billFile) {\r\n                formData.append('billFile', purchase.billFile);\r\n            }\r\n\r\n            await api.post('/supplier-ledger/record-purchase', formData, {\r\n                headers: {\r\n                    'Content-Type': 'multipart/form-data'\r\n                }\r\n            });\r\n\r\n            toast.success('Purchase recorded successfully');\r\n            setShowPurchaseModal(false);\r\n            setPurchase({ amount: '', billNo: '', notes: '', billFile: null });\r\n            loadData();\r\n        } catch (error) {\r\n            console.error('Purchase error:', error);\r\n            toast.error(error.response?.data?.message || 'Failed to record purchase');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Layout>\r\n            <div className=\"p-6\">\r\n                {/* Header */}\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                    <div className=\"flex items-center space-x-4\">\r\n                        <button\r\n                            onClick={() => navigate('/suppliers')}\r\n                            className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors\"\r\n                        >\r\n                            <ArrowLeft className=\"w-6 h-6 text-gray-600 dark:text-gray-400\" />\r\n                        </button>\r\n                        <div>\r\n                            <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n                                {loading ? 'Loading...' : `${supplier?.name} - Purchase Ledger`}\r\n                            </h1>\r\n                            <p className=\"text-gray-600 dark:text-gray-400\">\r\n                                {supplier?.phone} | {supplier?.address}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center space-x-3\">\r\n                        <button\r\n                            onClick={() => setShowPurchaseModal(true)}\r\n                            className=\"flex items-center space-x-2 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors\"\r\n                        >\r\n                            <Plus className=\"w-4 h-4\" />\r\n                            <span>Record Purchase</span>\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setShowPaymentModal(true)}\r\n                            className=\"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors\"\r\n                        >\r\n                            <Plus className=\"w-4 h-4\" />\r\n                            <span>Record Payment</span>\r\n                        </button>\r\n                        <button\r\n                            onClick={handleRecalculate}\r\n                            className=\"flex items-center space-x-2 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 transition-colors\"\r\n                        >\r\n                            <RefreshCw className=\"w-4 h-4\" />\r\n                            <span>Recalculate</span>\r\n                        </button>\r\n                        <button className=\"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\">\r\n                            <Printer className=\"w-4 h-4\" />\r\n                            <span>Print Statement</span>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Summary Cards */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\r\n                    <div className=\"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 transition-colors\">\r\n                        <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-1\">Total Credit (Purchases)</p>\r\n                        <p className=\"text-2xl font-bold text-red-600 dark:text-red-400 rupee\">\r\n                            {formatINR(ledger.reduce((sum, entry) => sum + (entry.credit || 0), 0))}\r\n                        </p>\r\n                    </div>\r\n                    <div className=\"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 transition-colors\">\r\n                        <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-1\">Total Debit (Paid)</p>\r\n                        <p className=\"text-2xl font-bold text-green-600 dark:text-green-400 rupee\">\r\n                            {formatINR(ledger.reduce((sum, entry) => sum + (entry.debit || 0), 0))}\r\n                        </p>\r\n                    </div>\r\n                    <div className=\"bg-orange-50 dark:bg-orange-900/30 p-6 rounded-xl shadow-sm border border-orange-100 dark:border-orange-800/50 transition-colors\">\r\n                        <p className=\"text-sm text-orange-800 dark:text-orange-300 mb-1\">Net Amount Owed</p>\r\n                        <p className=\"text-3xl font-bold text-orange-700 dark:text-orange-400 rupee\">\r\n                            {formatINR(supplier?.balance || 0)}\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Ledger Table */}\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden border border-gray-100 dark:border-gray-700 transition-colors\">\r\n                    <div className=\"overflow-x-auto\">\r\n                        <table className=\"w-full\">\r\n                            <thead>\r\n                                <tr className=\"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-700\">\r\n                                    <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">Date</th>\r\n                                    <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">Particulars</th>\r\n                                    <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">Ref No</th>\r\n                                    <th className=\"px-6 py-4 text-right text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider text-green-600 dark:text-green-400\">Debit (Dr)</th>\r\n                                    <th className=\"px-6 py-4 text-right text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider text-red-600 dark:text-red-400\">Credit (Cr)</th>\r\n                                    <th className=\"px-6 py-4 text-right text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">Balance</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody className=\"divide-y divide-gray-200 dark:divide-gray-700\">\r\n                                {loading ? (\r\n                                    <tr>\r\n                                        <td colSpan=\"6\" className=\"text-center py-8\">Loading ledger...</td>\r\n                                    </tr>\r\n                                ) : ledger.length === 0 ? (\r\n                                    <tr>\r\n                                        <td colSpan=\"6\" className=\"text-center py-8 text-gray-500\">No transactions found</td>\r\n                                    </tr>\r\n                                ) : (\r\n                                    ledger.map((entry) => (\r\n                                        <tr key={entry._id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\">\r\n                                            <td className=\"px-6 py-4 text-sm text-gray-900 dark:text-gray-100 whitespace-nowrap\">\r\n                                                {formatDate(entry.date)}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-sm text-gray-900 dark:text-gray-100\">\r\n                                                <div className=\"font-medium\">{entry.refType}</div>\r\n                                                <div className=\"text-gray-500 dark:text-gray-400 text-xs\">{entry.description}</div>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-sm text-gray-500 dark:text-gray-400 font-mono\">\r\n                                                {entry.refNo || '-'}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-sm text-right font-medium text-green-600 dark:text-green-400\">\r\n                                                {entry.debit > 0 ? formatINR(entry.debit) : '-'}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-sm text-right font-medium text-red-600 dark:text-red-400\">\r\n                                                {entry.credit > 0 ? formatINR(entry.credit) : '-'}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-sm text-right font-bold text-gray-900 dark:text-white rupee bg-gray-50 dark:bg-gray-700/30\">\r\n                                                {formatINR(entry.balance)}\r\n                                            </td>\r\n                                        </tr>\r\n                                    ))\r\n                                )}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Payment Recording Modal */}\r\n            {showPaymentModal && (\r\n                <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 backdrop-blur-sm\">\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6 shadow-2xl transition-colors\">\r\n                        <h3 className=\"text-xl font-bold text-gray-900 dark:text-white mb-4\">Record Payment to Supplier</h3>\r\n\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                    Amount *\r\n                                </label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={payment.amount}\r\n                                    onChange={(e) => setPayment({ ...payment, amount: e.target.value })}\r\n                                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors\"\r\n                                    placeholder=\"Enter amount paid\"\r\n                                    min=\"0\"\r\n                                    step=\"0.01\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                    Payment Method *\r\n                                </label>\r\n                                <select\r\n                                    value={payment.method}\r\n                                    onChange={(e) => setPayment({ ...payment, method: e.target.value })}\r\n                                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors\"\r\n                                >\r\n                                    <option value=\"Cash\">Cash</option>\r\n                                    <option value=\"Credit\">Credit</option>\r\n                                    <option value=\"UPI\">UPI</option>\r\n                                    <option value=\"Card\">Card</option>\r\n                                    <option value=\"Bank Transfer\">Bank Transfer</option>\r\n                                    <option value=\"Cheque\">Cheque</option>\r\n                                </select>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                    Notes (Optional)\r\n                                </label>\r\n                                <textarea\r\n                                    value={payment.notes}\r\n                                    onChange={(e) => setPayment({ ...payment, notes: e.target.value })}\r\n                                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors\"\r\n                                    rows=\"3\"\r\n                                    placeholder=\"e.g., Payment for Bill #123\"\r\n                                ></textarea>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex justify-end space-x-3 mt-6\">\r\n                            <button\r\n                                onClick={() => setShowPaymentModal(false)}\r\n                                className=\"px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors\"\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                            <button\r\n                                onClick={handleRecordPayment}\r\n                                className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium\"\r\n                            >\r\n                                Record Payment\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Purchase Recording Modal */}\r\n            {showPurchaseModal && (\r\n                <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 backdrop-blur-sm\">\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6 shadow-2xl transition-colors\">\r\n                        <h3 className=\"text-xl font-bold text-gray-900 dark:text-white mb-4\">Record Purchase</h3>\r\n\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                    Amount *\r\n                                </label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={purchase.amount}\r\n                                    onChange={(e) => setPurchase({ ...purchase, amount: e.target.value })}\r\n                                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors\"\r\n                                    placeholder=\"Enter purchase amount\"\r\n                                    min=\"0\"\r\n                                    step=\"0.01\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                    Bill Number (Optional)\r\n                                </label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={purchase.billNo}\r\n                                    onChange={(e) => setPurchase({ ...purchase, billNo: e.target.value })}\r\n                                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors\"\r\n                                    placeholder=\"e.g., BILL-123\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                    Notes (Optional)\r\n                                </label>\r\n                                <textarea\r\n                                    value={purchase.notes}\r\n                                    onChange={(e) => setPurchase({ ...purchase, notes: e.target.value })}\r\n                                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors\"\r\n                                    rows=\"3\"\r\n                                    placeholder=\"e.g., 10 boxes of LED bulbs\"\r\n                                ></textarea>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                        Bill Attachment (Optional)\r\n                                    </label>\r\n                                    {!purchase.billFile ? (\r\n                                        <>\r\n                                            <input\r\n                                                type=\"file\"\r\n                                                accept=\"image/*,.pdf\"\r\n                                                onChange={(e) => setPurchase({ ...purchase, billFile: e.target.files[0] })}\r\n                                                className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 bg-white dark:bg-gray-700 transition-colors\"\r\n                                            />\r\n                                            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">Upload bill image or PDF (max 5MB)</p>\r\n                                        </>\r\n                                    ) : (\r\n                                        <div className=\"flex items-center justify-between p-2 border border-orange-200 bg-orange-50 rounded-lg\">\r\n                                            <div className=\"flex items-center space-x-2 overflow-hidden\">\r\n                                                <span className=\"text-sm font-medium text-orange-800\">File selected:</span>\r\n                                                <span className=\"text-sm text-gray-700 truncate\">{purchase.billFile.name}</span>\r\n                                            </div>\r\n                                            <button\r\n                                                type=\"button\"\r\n                                                onClick={() => setPurchase({ ...purchase, billFile: null })}\r\n                                                className=\"text-red-500 hover:bg-red-50 p-1 rounded-full transition-colors\"\r\n                                                title=\"Remove File\"\r\n                                            >\r\n                                                <X className=\"w-5 h-5\" />\r\n                                            </button>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex justify-end space-x-3 mt-6\">\r\n                            <button\r\n                                onClick={() => setShowPurchaseModal(false)}\r\n                                className=\"px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors\"\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                            <button\r\n                                onClick={handleRecordPurchase}\r\n                                className=\"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 font-medium\"\r\n                            >\r\n                                Record Purchase\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </Layout>\r\n    );\r\n};\r\n\r\nexport default SupplierLedger;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\pages\\Suppliers.jsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadSuppliers` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\n  38 |             return;\n  39 |         }\n> 40 |         loadSuppliers();\n     |         ^^^^^^^^^^^^^ `loadSuppliers` accessed before it is declared\n  41 |     }, []);\n  42 |\n  43 |     useEffect(() => {\n\n  54 |     }, [searchQuery, suppliers]);\n  55 |\n> 56 |     const loadSuppliers = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 57 |         try {\n     | ^^^^^^^^^^^^^\n> 58 |             setLoading(true);\n     \n     | ^^^^^^^^^^^^^\n> 67 |         }\n     | ^^^^^^^^^^^^^\n> 68 |     };\n     | ^^^^^^^ `loadSuppliers` is declared here\n  69 |\n  70 |     const handleDeleteClick = (supplier) => {\n  71 |         setSupplierToDelete(supplier);","line":40,"column":9,"nodeType":null,"endLine":40,"endColumn":22},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'isAdmin' and 'navigate'. Either include them or remove the dependency array.","line":41,"column":8,"nodeType":"ArrayExpression","endLine":41,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [isAdmin, navigate]","fix":{"range":[1353,1355],"text":"[isAdmin, navigate]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":83,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":83,"endColumn":23}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport ConfirmationModal from '../components/ConfirmationModal';\r\nimport Layout from '../components/Layout/Layout';\r\nimport api from '../utils/api';\r\nimport { formatINR } from '../utils/currency';\r\nimport {\r\n    TruckIcon,\r\n    Search,\r\n    Plus,\r\n    Edit2,\r\n    Trash2,\r\n    X,\r\n    Phone,\r\n    Mail,\r\n    IndianRupee,\r\n    BookOpen\r\n} from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst Suppliers = () => {\r\n    const navigate = useNavigate();\r\n    const { isAdmin } = useAuth();\r\n    const [suppliers, setSuppliers] = useState([]);\r\n    const [filteredSuppliers, setFilteredSuppliers] = useState([]);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [loading, setLoading] = useState(true);\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [editingSupplier, setEditingSupplier] = useState(null);\r\n    const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n    const [supplierToDelete, setSupplierToDelete] = useState(null);\r\n\r\n    useEffect(() => {\r\n        if (!isAdmin()) {\r\n            navigate('/dashboard');\r\n            toast.error('Access denied. Admin only.');\r\n            return;\r\n        }\r\n        loadSuppliers();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (searchQuery) {\r\n            const filtered = suppliers.filter(s =>\r\n                s.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n                s.phone.includes(searchQuery) ||\r\n                s.email?.toLowerCase().includes(searchQuery.toLowerCase())\r\n            );\r\n            setFilteredSuppliers(filtered);\r\n        } else {\r\n            setFilteredSuppliers(suppliers);\r\n        }\r\n    }, [searchQuery, suppliers]);\r\n\r\n    const loadSuppliers = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const { data } = await api.get('/suppliers');\r\n            setSuppliers(data);\r\n            setFilteredSuppliers(data);\r\n            setLoading(false);\r\n        } catch (error) {\r\n            console.error('Failed to load suppliers:', error);\r\n            toast.error('Failed to load suppliers');\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDeleteClick = (supplier) => {\r\n        setSupplierToDelete(supplier);\r\n        setShowDeleteModal(true);\r\n    };\r\n\r\n    const confirmDelete = async () => {\r\n        if (!supplierToDelete) return;\r\n\r\n        try {\r\n            await api.delete(`/suppliers/${supplierToDelete._id}`);\r\n            toast.success('Supplier deleted successfully');\r\n            loadSuppliers();\r\n            setSupplierToDelete(null);\r\n        } catch (error) {\r\n            toast.error('Failed to delete supplier');\r\n        }\r\n    };\r\n\r\n    const handleEdit = (supplier) => {\r\n        setEditingSupplier(supplier);\r\n        setShowModal(true);\r\n    };\r\n\r\n    const handleAdd = () => {\r\n        setEditingSupplier(null);\r\n        setShowModal(true);\r\n    };\r\n\r\n    return (\r\n        <Layout>\r\n            <div className=\"p-6\">\r\n                {/* Header */}\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                    <div>\r\n                        <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">Suppliers</h1>\r\n                        <p className=\"text-gray-600 dark:text-gray-400 mt-1\">Manage supplier information and payments</p>\r\n                    </div>\r\n                    <button\r\n                        onClick={handleAdd}\r\n                        className=\"flex items-center space-x-2 px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 shadow-sm transition-all\"\r\n                    >\r\n                        <Plus className=\"w-5 h-5\" />\r\n                        <span>Add Supplier</span>\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Search */}\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 mb-6 border border-gray-100 dark:border-gray-700\">\r\n                    <div className=\"relative\">\r\n                        <Search className=\"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400\" />\r\n                        <input\r\n                            type=\"text\"\r\n                            value={searchQuery}\r\n                            onChange={(e) => setSearchQuery(e.target.value)}\r\n                            placeholder=\"Search by name, phone, or email...\"\r\n                            className=\"w-full pl-12 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Suppliers Grid */}\r\n                {loading ? (\r\n                    <div className=\"text-center py-12\">\r\n                        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto\"></div>\r\n                    </div>\r\n                ) : filteredSuppliers.length === 0 ? (\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-12 text-center text-gray-500 dark:text-gray-400 border border-gray-100 dark:border-gray-700\">\r\n                        <TruckIcon className=\"w-16 h-16 mx-auto mb-4 opacity-50\" />\r\n                        <p className=\"text-lg\">No suppliers found</p>\r\n                        <button\r\n                            onClick={handleAdd}\r\n                            className=\"mt-4 text-blue-500 hover:text-blue-600 font-medium\"\r\n                        >\r\n                            Add your first supplier\r\n                        </button>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                        {filteredSuppliers.map((supplier) => (\r\n                            <div\r\n                                key={supplier._id}\r\n                                className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 hover:shadow-md transition-shadow border border-gray-100 dark:border-gray-700\"\r\n                            >\r\n                                <div className=\"flex items-start justify-between mb-4\">\r\n                                    <div>\r\n                                        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">{supplier.name}</h3>\r\n                                        <div className=\"flex items-center space-x-2 mt-1 text-sm text-gray-600 dark:text-gray-400\">\r\n                                            <Phone className=\"w-4 h-4\" />\r\n                                            <span>{supplier.phone}</span>\r\n                                        </div>\r\n                                        {supplier.email && (\r\n                                            <div className=\"flex items-center space-x-2 mt-1 text-sm text-gray-600 dark:text-gray-400\">\r\n                                                <Mail className=\"w-4 h-4\" />\r\n                                                <span>{supplier.email}</span>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {supplier.address && (\r\n                                    <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2\">{supplier.address}</p>\r\n                                )}\r\n\r\n                                <div className=\"border-t border-gray-200 dark:border-gray-700 pt-4\">\r\n                                    <div className=\"flex items-center justify-between mb-2\">\r\n                                        <span className=\"text-sm text-gray-600 dark:text-gray-400\">Balance:</span>\r\n                                        <span className={`text-lg font-bold rupee ${supplier.balance > 0 ? 'text-green-600 dark:text-green-400' : supplier.balance < 0 ? 'text-red-600 dark:text-red-400' : 'text-gray-900 dark:text-white'\r\n                                            }`}>\r\n                                            {formatINR(Math.abs(supplier.balance))}\r\n                                        </span>\r\n                                    </div>\r\n                                    {supplier.balance > 0 && (\r\n                                        <p className=\"text-xs text-green-600 dark:text-green-400\">We owe supplier</p>\r\n                                    )}\r\n                                    {supplier.balance < 0 && (\r\n                                        <p className=\"text-xs text-red-600 dark:text-red-400\">Supplier owes us</p>\r\n                                    )}\r\n                                </div>\r\n\r\n                                <div className=\"flex items-center justify-end space-x-2 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\r\n                                    <button\r\n                                        onClick={() => navigate(`/suppliers/${supplier._id}/ledger`)}\r\n                                        className=\"p-2 text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-lg transition-colors\"\r\n                                        title=\"View Ledger\"\r\n                                    >\r\n                                        <BookOpen className=\"w-4 h-4\" />\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => handleEdit(supplier)}\r\n                                        className=\"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors\"\r\n                                        title=\"Edit\"\r\n                                    >\r\n                                        <Edit2 className=\"w-4 h-4\" />\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => handleDeleteClick(supplier)}\r\n                                        className=\"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors\"\r\n                                        title=\"Delete\"\r\n                                    >\r\n                                        <Trash2 className=\"w-4 h-4\" />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Add/Edit Supplier Modal */}\r\n            {showModal && (\r\n                <SupplierModal\r\n                    supplier={editingSupplier}\r\n                    onClose={() => {\r\n                        setShowModal(false);\r\n                        setEditingSupplier(null);\r\n                    }}\r\n                    onSuccess={() => {\r\n                        setShowModal(false);\r\n                        setEditingSupplier(null);\r\n                        loadSuppliers();\r\n                    }}\r\n                />\r\n            )}\r\n\r\n            <ConfirmationModal\r\n                isOpen={showDeleteModal}\r\n                onClose={() => {\r\n                    setShowDeleteModal(false);\r\n                    setSupplierToDelete(null);\r\n                }}\r\n                onConfirm={confirmDelete}\r\n                title=\"Delete Supplier\"\r\n                message={`Are you sure you want to delete \"${supplierToDelete?.name}\"? This action cannot be undone.`}\r\n                confirmText=\"Delete Supplier\"\r\n                isDangerous={true}\r\n            />\r\n        </Layout>\r\n    );\r\n};\r\n\r\n// Supplier Modal Component\r\nconst SupplierModal = ({ supplier, onClose, onSuccess }) => {\r\n    const [formData, setFormData] = useState({\r\n        name: supplier?.name || '',\r\n        phone: supplier?.phone || '',\r\n        email: supplier?.email || '',\r\n        address: supplier?.address || '',\r\n        gstin: supplier?.gstin || '',\r\n    });\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n\r\n        try {\r\n            if (supplier) {\r\n                await api.put(`/suppliers/${supplier._id}`, formData);\r\n                toast.success('Supplier updated successfully');\r\n            } else {\r\n                await api.post('/suppliers', formData);\r\n                toast.success('Supplier added successfully');\r\n            }\r\n            onSuccess();\r\n        } catch (error) {\r\n            toast.error(error.response?.data?.message || 'Failed to save supplier');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 backdrop-blur-sm\">\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full border border-gray-100 dark:border-gray-700\">\r\n                <div className=\"p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between\">\r\n                    <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n                        {supplier ? 'Edit Supplier' : 'Add New Supplier'}\r\n                    </h2>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors text-gray-500 dark:text-gray-400\"\r\n                    >\r\n                        <X className=\"w-6 h-6\" />\r\n                    </button>\r\n                </div>\r\n\r\n                <form onSubmit={handleSubmit} className=\"p-6 space-y-4\">\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                            Supplier Name *\r\n                        </label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={formData.name}\r\n                            onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                            className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                            required\r\n                        />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                            Phone *\r\n                        </label>\r\n                        <input\r\n                            type=\"tel\"\r\n                            value={formData.phone}\r\n                            onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\r\n                            className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                            required\r\n                        />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                            Email\r\n                        </label>\r\n                        <input\r\n                            type=\"email\"\r\n                            value={formData.email}\r\n                            onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                            className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                            Address\r\n                        </label>\r\n                        <textarea\r\n                            value={formData.address}\r\n                            onChange={(e) => setFormData({ ...formData, address: e.target.value })}\r\n                            className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                            rows={3}\r\n                        />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                            GSTIN (Optional)\r\n                        </label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={formData.gstin}\r\n                            onChange={(e) => setFormData({ ...formData, gstin: e.target.value })}\r\n                            className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400\"\r\n                            placeholder=\"22AAAAA0000A1Z5\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700\">\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={onClose}\r\n                            className=\"px-6 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-gray-700 dark:text-gray-300\"\r\n                        >\r\n                            Cancel\r\n                        </button>\r\n                        <button\r\n                            type=\"submit\"\r\n                            disabled={loading}\r\n                            className=\"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50\"\r\n                        >\r\n                            {loading ? 'Saving...' : supplier ? 'Update Supplier' : 'Add Supplier'}\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Suppliers;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\utils\\api.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\utils\\currency.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\utils\\date.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\utils\\gstCalculator.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\src\\utils\\whatsapp.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Software\\Create\\Shop\\frontend\\vite.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
